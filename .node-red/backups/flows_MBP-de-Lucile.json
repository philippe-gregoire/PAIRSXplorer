[{"id":"77ddf49d.9315dc","type":"tab","label":"Common JS Code","disabled":false,"info":"Here we have the common header code"},{"id":"1856e54.6882d1b","type":"tab","label":"PAIRS Queries tests","disabled":false,"info":"Query PAIRS over REST/HTTP"},{"id":"9693d392.5f9c5","type":"tab","label":"PAIRS Viti Map","disabled":false,"info":"PAIRS Map with Viti layers"},{"id":"bcc0b3a.aa2e95","type":"tab","label":"PAIRS Explorer","disabled":false,"info":""},{"id":"21c2f37a.1907fc","type":"tab","label":"Simple PAIRS","disabled":false,"info":""},{"id":"5fa738eb.f40408","type":"tab","label":"Map widget OSM","disabled":false,"info":"Example of MapWidget with OpenStreetMap background"},{"id":"287ecead.0df562","type":"tab","label":"Web WorldMap node test","disabled":false,"info":""},{"id":"a18853ad.01b3c","type":"tab","label":"Test BootStrap","disabled":false,"info":""},{"id":"5fed8ae7.8bb5a4","type":"tab","label":"UiBuilder-Vue","disabled":false,"info":""},{"id":"2d447360.3ff9fc","type":"tab","label":"query score save","disabled":false,"info":""},{"id":"fac93a33.099aa8","type":"subflow","name":"PAIRS Point Query","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"38f35b82.d1a314"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"9c19a3c6.e0c29","port":0}]},{"x":740,"y":360,"wires":[]},{"x":740,"y":420,"wires":[{"id":"c5bbd50a.eed5e8","port":1}]}],"env":[],"color":"#C0C0C0","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"6df36e9b.8f203","type":"subflow","name":"PAIRS Query Job","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"f0291164.cf42"}]}],"out":[{"x":780,"y":400,"wires":[{"id":"997a38a1.fb2ec8","port":0}]},{"x":780,"y":460,"wires":[{"id":"b3f5dcd.085522","port":1}]},{"x":760,"y":160,"wires":[{"id":"bdaf8767.c47d98","port":0}]},{"x":780,"y":340,"wires":[{"id":"dacc29d6.b8d258","port":0}]},{"x":760,"y":100,"wires":[{"id":"6df36e9b.8f203","port":0},{"id":"8d344825.1fd0e8","port":0}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#C0C0C0","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg"]},{"id":"22be0357.6ef6fc","type":"subflow","name":"PAIRS Request","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"276440b3.5fca6"}]}],"out":[{"x":960,"y":240,"wires":[{"id":"90e7e0f8.4b61c","port":0}]},{"x":960,"y":140,"wires":[{"id":"6b610517.1197cc","port":0}]},{"x":960,"y":300,"wires":[{"id":"263c6a33.2709d6","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#3FADB5","outputLabels":["result","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"e68fbd7c.0431a","type":"subflow","name":"PAIRS Min-Mean-Max","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":120,"y":240,"wires":[{"id":"3c01f6c1.eb661a"}]}],"out":[{"x":540,"y":200,"wires":[{"id":"3c865690.f7436a","port":0}]},{"x":540,"y":240,"wires":[{"id":"3c865690.f7436a","port":1}]},{"x":540,"y":280,"wires":[{"id":"3c865690.f7436a","port":2}]}],"env":[],"color":"#E9967A","outputLabels":["response","debug","error"]},{"id":"45272af4.690614","type":"subflow","name":"PAIRS Scoring Query Job","info":"Makes the scoring request to PAIRS","category":"","in":[{"x":40,"y":180,"wires":[{"id":"664e6cdb.72c354"}]}],"out":[{"x":880,"y":480,"wires":[{"id":"6552faee.7f79b4","port":"4"}]},{"x":880,"y":540,"wires":[{"id":"b81ba735.6c0288","port":2},{"id":"e4b5f6b5.ac7a98","port":2},{"id":"6552faee.7f79b4","port":"5"},{"id":"6552faee.7f79b4","port":"6"}]},{"x":880,"y":260,"wires":[{"id":"d51c34e7.201c88","port":0}]},{"x":880,"y":420,"wires":[{"id":"6552faee.7f79b4","port":0},{"id":"6552faee.7f79b4","port":1},{"id":"6552faee.7f79b4","port":2},{"id":"6552faee.7f79b4","port":3}]},{"x":880,"y":340,"wires":[{"id":"e4b5f6b5.ac7a98","port":0},{"id":"45272af4.690614","port":0},{"id":"b81ba735.6c0288","port":1},{"id":"e4b5f6b5.ac7a98","port":1}]},{"x":880,"y":180,"wires":[]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#0088EE","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg","queryJSON"]},{"id":"b14a35fc.a33548","type":"subflow","name":"PAIRS Layers Details","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"acda743b.735d48"}]}],"out":[{"x":920,"y":120,"wires":[{"id":"14fdbe57.397492","port":0}]},{"x":920,"y":220,"wires":[{"id":"7279cf64.23dc1","port":1},{"id":"aa73b87b.5f31b8","port":0}]},{"x":920,"y":280,"wires":[{"id":"7279cf64.23dc1","port":2},{"id":"acda743b.735d48","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#FFCC66","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"3aa70edc.b22322","type":"subflow","name":"Query colorTable - Subflow","info":"","category":"","in":[{"x":40,"y":120,"wires":[{"id":"cfce9bd3.401138"}]}],"out":[{"x":860,"y":300,"wires":[{"id":"1c3a2a7d.41e506","port":0}]},{"x":360,"y":340,"wires":[{"id":"38c775d2.44a38a","port":1}]},{"x":360,"y":380,"wires":[{"id":"38c775d2.44a38a","port":2}]}],"env":[],"color":"#E2D96E"},{"id":"a15ea8b9.f75a28","type":"subflow","name":"PAIRS Scoring Query Job","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"aa8f0cf6.29a0d"}]}],"out":[{"x":880,"y":380,"wires":[{"id":"653791b0.25ba5","port":"4"}]},{"x":880,"y":440,"wires":[{"id":"653791b0.25ba5","port":"5"},{"id":"653791b0.25ba5","port":"6"}]},{"x":880,"y":140,"wires":[{"id":"44611078.c536c","port":0}]},{"x":880,"y":320,"wires":[{"id":"653791b0.25ba5","port":0},{"id":"653791b0.25ba5","port":1},{"id":"653791b0.25ba5","port":2},{"id":"653791b0.25ba5","port":3}]},{"x":880,"y":240,"wires":[{"id":"a15ea8b9.f75a28","port":0}]},{"x":880,"y":60,"wires":[{"id":"5d87971e.94ea08","port":0},{"id":"137fcb7e.509335","port":0},{"id":"f82ca1ae.424aa","port":0}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#C0C0C0","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg","queryJSON"]},{"id":"8fba2998.b92f08","type":"subflow","name":"Pairs request - no conv","info":"Makes a request to PAIRS. Same subflow as PAIRS request without the JSON conversion. This subflow is useful is case you do not have JSON as a reult of your PAIRS call.","category":"","in":[{"x":40,"y":100,"wires":[{"id":"efdcc8ef.167488"}]}],"out":[{"x":820,"y":280,"wires":[{"id":"1bb33fa1.10779","port":0}]},{"x":820,"y":220,"wires":[{"id":"618b427e.bb241c","port":0}]},{"x":820,"y":340,"wires":[{"id":"1bb33fa1.10779","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#3FADB5","icon":"node-red/white-globe.svg"},{"id":"37b9e0f6.a85f2","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"7d72c7d6.9fede8","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"f06041.f45b7fc","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"6a90eb37.da57c4","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4249619f.7a6e4","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"7847f5a7.c7b48c","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"4bc43045.d5d3b","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"6e88f5e6.03c78c","type":"ui_tab","z":0,"name":"Entfeuchter","icon":"dashboard","order":4},{"id":"6a6ca1a6.b8e9b","type":"ui_tab","z":0,"name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"706fca83.cc29e4","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"77936f58.75b1e","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"a2af51d3.acb7a","type":"ui_tab","z":0,"name":"Entfeuchter","icon":"dashboard","order":4},{"id":"bacdc44a.3817e8","type":"ui_tab","z":0,"name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"6fa3d925.d65af8","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"2ead0958.941b96","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"b626bacc.d5b718","type":"ui_tab","z":0,"name":"Entfeuchter","icon":"dashboard","order":4},{"id":"fe08ed6d.c2841","type":"ui_tab","z":0,"name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"6a841abe.5ae404","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"3df39316.5282bc","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"99cc199c.5fa5c8","type":"ui_tab","z":0,"name":"Entfeuchter","icon":"dashboard","order":4},{"id":"29bbc9b4.3fa516","type":"ui_tab","z":0,"name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"60cdfa92.2a2024","type":"ui_tab","z":"bcc0b3a.aa2e95","name":"PAIRS Explorer","icon":"fa-search","order":2,"disabled":false,"hidden":false},{"id":"25e0b7.a00e6f4a","type":"ui_tab","z":"5fa738eb.f40408","name":"Map Widget","icon":"fa-map-o","order":3,"disabled":false,"hidden":false},{"id":"babd6fb4.efce5","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"8d6f3870.6264d8","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"ec7a6417.e663b8","type":"ui_tab","z":0,"name":"Entfeuchter","icon":"dashboard","order":4},{"id":"4443bd86.4770e4","type":"ui_tab","z":0,"name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"a2566f80.462b4","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"7847f5a7.c7b48c","order":1,"disp":true,"width":"16","collapse":false},{"id":"a67d045c.bb6038","type":"ui_group","z":0,"name":"Default","tab":"4bc43045.d5d3b","order":1,"disp":false,"width":24,"collapse":false},{"id":"4566001.f5bbd","type":"ui_group","z":0,"name":"Default","tab":"bacb64a8.5fc238","order":2,"disp":false,"width":"18","collapse":false},{"id":"d7f5a3c9.150a5","type":"ui_group","z":0,"name":"Entfeuchter Chart","tab":"6e88f5e6.03c78c","order":2,"disp":true,"width":"6","collapse":false},{"id":"c2ca8b8c.9af0b8","type":"ui_group","z":0,"name":"Default","tab":"6a6ca1a6.b8e9b","order":1,"disp":false,"width":"16","collapse":false},{"id":"61420303.59071c","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"706fca83.cc29e4","order":1,"disp":true,"width":"16","collapse":false},{"id":"2fad93a7.d54fec","type":"ui_group","z":0,"name":"Default","tab":"77936f58.75b1e","order":1,"disp":false,"width":24,"collapse":false},{"id":"82a4e999.141798","type":"ui_group","z":0,"name":"Default","tab":"9dfbf7d8.6582a8","order":2,"disp":false,"width":"18","collapse":false},{"id":"3c9ba877.9180d8","type":"ui_group","z":0,"name":"Entfeuchter Chart","tab":"a2af51d3.acb7a","order":2,"disp":true,"width":"6","collapse":false},{"id":"e5c6c1fb.62ea3","type":"ui_group","z":0,"name":"Default","tab":"bacdc44a.3817e8","order":1,"disp":false,"width":"16","collapse":false},{"id":"d3038d41.b467","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"6fa3d925.d65af8","order":1,"disp":true,"width":"16","collapse":false},{"id":"ee17d09c.5ac0b","type":"ui_group","z":0,"name":"Default","tab":"2ead0958.941b96","order":1,"disp":false,"width":24,"collapse":false},{"id":"8922bb68.e4cd48","type":"ui_group","z":0,"name":"Default","tab":"17eeae6f.037662","order":2,"disp":false,"width":"18","collapse":false},{"id":"fece357f.82bcc8","type":"ui_group","z":0,"name":"Entfeuchter Chart","tab":"b626bacc.d5b718","order":2,"disp":true,"width":"6","collapse":false},{"id":"52fc2436.51b34c","type":"ui_group","z":0,"name":"Default","tab":"fe08ed6d.c2841","order":1,"disp":false,"width":"16","collapse":false},{"id":"dee4eff9.a9c9","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"6a841abe.5ae404","order":1,"disp":true,"width":"16","collapse":false},{"id":"b231b249.18798","type":"ui_group","z":0,"name":"Default","tab":"3df39316.5282bc","order":1,"disp":false,"width":24,"collapse":false},{"id":"ec8c2300.c605c","type":"ui_group","z":0,"name":"Default","tab":"e9d95dab.d966b","order":2,"disp":false,"width":"18","collapse":false},{"id":"69c3187d.ffb1a8","type":"ui_group","z":0,"name":"Entfeuchter Chart","tab":"99cc199c.5fa5c8","order":2,"disp":true,"width":"6","collapse":false},{"id":"420affe5.b8e4f","type":"ui_group","z":0,"name":"Default","tab":"29bbc9b4.3fa516","order":1,"disp":false,"width":"16","collapse":false},{"id":"7f6d1bbc.b842f4","type":"ui_group","z":"5fa738eb.f40408","name":"Default","tab":"25e0b7.a00e6f4a","order":1,"disp":false,"width":"12","collapse":false},{"id":"d081afdb.7b153","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"babd6fb4.efce5","order":1,"disp":true,"width":"16","collapse":false},{"id":"9b16ec6a.5908a","type":"ui_group","z":0,"name":"Default","tab":"8d6f3870.6264d8","order":1,"disp":false,"width":24,"collapse":false},{"id":"7b72899.38e6578","type":"ui_group","z":0,"name":"Default","tab":"60cdfa92.2a2024","order":2,"disp":false,"width":"18","collapse":false},{"id":"6afc40ba.f11d1","type":"ui_group","z":0,"name":"Entfeuchter Chart","tab":"ec7a6417.e663b8","order":2,"disp":true,"width":"6","collapse":false},{"id":"eef6288d.b053f8","type":"ui_group","z":0,"name":"Default","tab":"4443bd86.4770e4","order":1,"disp":false,"width":"16","collapse":false},{"id":"d9f50cf7.e27e6","type":"ui_spacer","z":0,"name":"spacer","group":"2a1bc189.10202e","order":10,"width":1,"height":1},{"id":"5db89700.d97188","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"81eb560b.cb3438","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"9841fac.a5dd308","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"aaff1445.753488","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"54fc0fef.b9af1","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"a88186ad.5d4298","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"254be5b3.46d9da","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":3,"width":6,"height":1},{"id":"31c95578.d517ba","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":4,"width":1,"height":1},{"id":"dfd39396.c27e9","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":7,"width":1,"height":1},{"id":"71072f3e.ca36a","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":8,"width":6,"height":1},{"id":"9a228e6a.52a8d","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":13,"width":2,"height":1},{"id":"a47c069f.0f28e8","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":15,"width":2,"height":1},{"id":"6b611cab.13b594","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":17,"width":6,"height":1},{"id":"53922f39.cb13","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":18,"width":6,"height":1},{"id":"17534c60.2973f4","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":23,"width":6,"height":1},{"id":"f995197a.af1bd8","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":25,"width":3,"height":1},{"id":"4e644bce.3606b4","type":"ui_spacer","z":0,"name":"spacer","group":"a67d045c.bb6038","order":21,"width":10,"height":1},{"id":"836ae620.055548","type":"ui_spacer","z":0,"name":"spacer","group":"a67d045c.bb6038","order":23,"width":12,"height":1},{"id":"6f249f44.e583c","type":"ui_spacer","z":0,"name":"spacer","group":"a67d045c.bb6038","order":24,"width":12,"height":1},{"id":"5c6bb160.ef105","type":"ui_spacer","z":0,"name":"spacer","group":"a67d045c.bb6038","order":25,"width":12,"height":1},{"id":"6785ceaa.2e6ca","type":"ui_spacer","z":0,"name":"spacer","group":"a67d045c.bb6038","order":27,"width":10,"height":1},{"id":"4f1cb7c4.dc19f8","type":"ui_spacer","z":0,"name":"spacer","group":"9d6d906d.3b96f","order":10,"width":1,"height":1},{"id":"1bdb4fad.ab132","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"26a014e5.a8edbc","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"e60b89b6.fb8d08","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"5f4e0940.6c99f8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"93f2ea55.da79e8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"d6e15e34.e4d4e","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"dabbe73f.7627d8","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":3,"width":6,"height":1},{"id":"97cd2d37.97571","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":4,"width":1,"height":1},{"id":"e8c00f4b.8507a","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":7,"width":1,"height":1},{"id":"8914ddec.aa6b7","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":8,"width":6,"height":1},{"id":"9d4641f9.8800e","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":13,"width":2,"height":1},{"id":"ba8dfb5e.044c88","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":15,"width":2,"height":1},{"id":"b0120330.03428","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":17,"width":6,"height":1},{"id":"d193e10.006cf2","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":18,"width":6,"height":1},{"id":"e8a444ab.75a9c8","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":23,"width":6,"height":1},{"id":"995e34fa.2d1b38","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":25,"width":3,"height":1},{"id":"dc085b06.2ad9b8","type":"ui_spacer","z":0,"name":"spacer","group":"2fad93a7.d54fec","order":21,"width":10,"height":1},{"id":"85ea6f78.c3e83","type":"ui_spacer","z":0,"name":"spacer","group":"2fad93a7.d54fec","order":23,"width":12,"height":1},{"id":"10caa693.40b1c9","type":"ui_spacer","z":0,"name":"spacer","group":"2fad93a7.d54fec","order":24,"width":12,"height":1},{"id":"3ad05f60.a6e7e","type":"ui_spacer","z":0,"name":"spacer","group":"2fad93a7.d54fec","order":25,"width":12,"height":1},{"id":"787a76a5.48ba58","type":"ui_spacer","z":0,"name":"spacer","group":"2fad93a7.d54fec","order":27,"width":10,"height":1},{"id":"4c63c857.60bc68","type":"ui_spacer","z":0,"name":"spacer","group":"733061b4.6b0e8","order":10,"width":1,"height":1},{"id":"23aa63ce.b33a1c","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"ae22ef84.28c4f","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"c2f9be9f.1feeb","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"c7d2c756.4b6d58","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"45912c82.2f1ea4","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"3e96017a.6cc12e","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"f1743114.f4ce9","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":3,"width":6,"height":1},{"id":"76fc3372.c5cd6c","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":4,"width":1,"height":1},{"id":"5eabadb2.e92c64","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":7,"width":1,"height":1},{"id":"606bc891.181908","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":8,"width":6,"height":1},{"id":"e96cbbaf.701728","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":13,"width":2,"height":1},{"id":"e02982d2.7d412","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":15,"width":2,"height":1},{"id":"755940f8.c3a0f","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":17,"width":6,"height":1},{"id":"16320b07.6ed505","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":18,"width":6,"height":1},{"id":"6ee3161b.a1f588","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":23,"width":6,"height":1},{"id":"97bc77df.42f0e8","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":25,"width":3,"height":1},{"id":"3bd3c72f.12dc68","type":"ui_spacer","z":0,"name":"spacer","group":"ee17d09c.5ac0b","order":21,"width":10,"height":1},{"id":"5653407f.a2dcb","type":"ui_spacer","z":0,"name":"spacer","group":"ee17d09c.5ac0b","order":23,"width":12,"height":1},{"id":"f5c87730.9bc4e8","type":"ui_spacer","z":0,"name":"spacer","group":"ee17d09c.5ac0b","order":24,"width":12,"height":1},{"id":"fe0996bb.27d668","type":"ui_spacer","z":0,"name":"spacer","group":"ee17d09c.5ac0b","order":25,"width":12,"height":1},{"id":"8aa6f503.437ba8","type":"ui_spacer","z":0,"name":"spacer","group":"ee17d09c.5ac0b","order":27,"width":10,"height":1},{"id":"7d5d6c48.444764","type":"ui_spacer","z":0,"name":"spacer","group":"48b04330.d2a6cc","order":10,"width":1,"height":1},{"id":"d7ce5c8c.66e81","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"e52a0a9f.8db448","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"3901ec18.9244a4","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"efddba.87ba7248","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"51b8b6d1.5b7e58","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"5bd8ae15.c402d","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"56c906b9.fb6da8","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":3,"width":6,"height":1},{"id":"17f0b436.aa434c","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":4,"width":1,"height":1},{"id":"136ac0a5.933a9f","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":7,"width":1,"height":1},{"id":"28cf9059.82fd7","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":8,"width":6,"height":1},{"id":"27f68239.7fa7ae","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":13,"width":2,"height":1},{"id":"b7675171.0521b","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":15,"width":2,"height":1},{"id":"7c0b71d9.b9ca7","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":17,"width":6,"height":1},{"id":"7b750560.b70bbc","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":18,"width":6,"height":1},{"id":"8b6e3b18.9529c8","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":23,"width":6,"height":1},{"id":"b756d88e.e3e6d8","type":"ui_spacer","z":0,"name":"spacer","group":"ec8c2300.c605c","order":25,"width":3,"height":1},{"id":"6cd27c0f.5a2ca4","type":"ui_spacer","z":0,"name":"spacer","group":"b231b249.18798","order":21,"width":10,"height":1},{"id":"3e86b421.7dbabc","type":"ui_spacer","z":0,"name":"spacer","group":"b231b249.18798","order":23,"width":12,"height":1},{"id":"76ac6a4a.7a6a14","type":"ui_spacer","z":0,"name":"spacer","group":"b231b249.18798","order":24,"width":12,"height":1},{"id":"10c5c4b2.cdb7db","type":"ui_spacer","z":0,"name":"spacer","group":"b231b249.18798","order":25,"width":12,"height":1},{"id":"1a0c22f9.b1723d","type":"ui_spacer","z":0,"name":"spacer","group":"b231b249.18798","order":27,"width":10,"height":1},{"id":"d340869f.eed7e8","type":"ui_spacer","z":0,"name":"spacer","group":"7f6d1bbc.b842f4","order":10,"width":1,"height":1},{"id":"f328444f.cbd7b8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"f18605f.d24c9f8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"eab3a62d.1d4498","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"bf269dd.a7c816","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"146787eb.3809e8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"439ccab8.ceb9b4","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"bed9c3d2.86711","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":3,"width":6,"height":1},{"id":"ceba7868.2f6488","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":4,"width":1,"height":1},{"id":"a1818ba4.228e98","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":7,"width":1,"height":1},{"id":"108b6f00.50c9a1","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":8,"width":6,"height":1},{"id":"465a85ef.5a15dc","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":13,"width":2,"height":1},{"id":"74461845.bb6a38","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":15,"width":2,"height":1},{"id":"fed38999.9f46b8","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":17,"width":6,"height":1},{"id":"fc751aed.c52768","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":18,"width":6,"height":1},{"id":"13b0b423.189bbc","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":23,"width":6,"height":1},{"id":"3bb82da9.c030d2","type":"ui_spacer","z":0,"name":"spacer","group":"7b72899.38e6578","order":25,"width":3,"height":1},{"id":"9efca068.f3c36","type":"ui_spacer","z":0,"name":"spacer","group":"9b16ec6a.5908a","order":21,"width":10,"height":1},{"id":"61cb1024.2176b","type":"ui_spacer","z":0,"name":"spacer","group":"9b16ec6a.5908a","order":23,"width":12,"height":1},{"id":"7b009f08.f3a0e","type":"ui_spacer","z":0,"name":"spacer","group":"9b16ec6a.5908a","order":24,"width":12,"height":1},{"id":"cde735ae.8b88b8","type":"ui_spacer","z":0,"name":"spacer","group":"9b16ec6a.5908a","order":25,"width":12,"height":1},{"id":"56a8c9c1.47c778","type":"ui_spacer","z":0,"name":"spacer","group":"9b16ec6a.5908a","order":27,"width":10,"height":1},{"id":"19913a0d.121dd6","type":"inject","z":"6df36e9b.8f203","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":160,"y":120,"wires":[[]]},{"id":"c71a2497.674718","type":"change","z":"6df36e9b.8f203","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":200,"wires":[["c5517a27.0c2fe8"]]},{"id":"3ddc29ae.74e026","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":110,"y":180,"wires":[["c71a2497.674718","bdaf8767.c47d98"]]},{"id":"29e9b64f.d413da","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":650,"y":300,"wires":[["dacc29d6.b8d258"]]},{"id":"186c481f.e7cf48","type":"delay","z":"6df36e9b.8f203","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":300,"wires":[[]]},{"id":"dacc29d6.b8d258","type":"switch","z":"6df36e9b.8f203","name":"Test not ready","property":"payload.ready","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":140,"y":380,"wires":[["c71a2497.674718"],["b3f5dcd.085522"]],"outputLabels":["not ready","ready"]},{"id":"bcb9c3fa.d9096","type":"inject","z":"6df36e9b.8f203","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":140,"y":80,"wires":[[]]},{"id":"9c19a3c6.e0c29","type":"json","z":"fac93a33.099aa8","name":"","property":"payload","action":"","pretty":false,"x":630,"y":300,"wires":[[]]},{"id":"38f35b82.d1a314","type":"template","z":"fac93a33.099aa8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["cd6450aa.c06f6"]]},{"id":"a0d1aece.92c32","type":"json","z":"fac93a33.099aa8","name":"","property":"payload","action":"","pretty":false,"x":310,"y":300,"wires":[[]]},{"id":"cd6450aa.c06f6","type":"function","z":"fac93a33.099aa8","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":240,"wires":[["a0d1aece.92c32"]]},{"id":"c5517a27.0c2fe8","type":"change","z":"6df36e9b.8f203","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":300,"wires":[["186c481f.e7cf48"]]},{"id":"b3f5dcd.085522","type":"switch","z":"6df36e9b.8f203","name":"Test success","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":380,"wires":[["997a38a1.fb2ec8"],[]],"outputLabels":["Succeeded","Failed"]},{"id":"f0291164.cf42","type":"template","z":"6df36e9b.8f203","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"NodeRED_Ref {{payload.pos.lat}}-{{payload.pos.lng}}\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \"alias\": \"{{.}}_Mean\",\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": \"38662\"\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":180,"y":20,"wires":[["6f4b9477.d10bfc"]]},{"id":"6f4b9477.d10bfc","type":"function","z":"6df36e9b.8f203","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":20,"wires":[["8d344825.1fd0e8"]]},{"id":"8d344825.1fd0e8","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":450,"y":20,"wires":[[]]},{"id":"bdaf8767.c47d98","type":"change","z":"6df36e9b.8f203","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":160,"wires":[[]]},{"id":"997a38a1.fb2ec8","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":650,"y":380,"wires":[[]]},{"id":"35ebbce9.630e44","type":"comment","z":"fac93a33.099aa8","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"c5bbd50a.eed5e8","type":"switch","z":"fac93a33.099aa8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":320,"wires":[["9c19a3c6.e0c29"],[]],"outputLabels":["ok","error"]},{"id":"93ea5011.b7d94","type":"debug","z":"bcc0b3a.aa2e95","name":"","active":false,"console":"false","complete":"true","x":510,"y":40,"wires":[]},{"id":"11c5fda9.fc47f2","type":"json","z":"bcc0b3a.aa2e95","name":"","property":"payload","action":"str","pretty":false,"x":330,"y":40,"wires":[["8dc625dc.fc4788","93ea5011.b7d94"]]},{"id":"ed539edf.0b914","type":"inject","z":"5fa738eb.f40408","name":"","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"","payloadType":"str","x":160,"y":120,"wires":[["230d1bc0.130054"]]},{"id":"230d1bc0.130054","type":"function","z":"5fa738eb.f40408","name":"Generate Mike random movements","func":"// create random position\nvar lat = 51 + Math.random() * 0.2;\nvar lon = -1.45 + Math.random() * 0.2;\nmsg.payload={\n    lat:lat, \n    lon:lon, \n    name:\"Mike\", \n    icon:\"male\", \n    color:\"#000\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":180,"wires":[["16e3f4d8.e7b72b","aa6e5a4.70481a8"]]},{"id":"ffd22463.19ba18","type":"comment","z":"5fa738eb.f40408","name":"How to embed Map in Dashboard","info":"This example shows how to embed the Worldmap \ninto a template node within the `node-red-dashboard`\n\nThe first flow creates a dashboard button that \ngenerates a randon position, with the required \nicon, and passes that to the worldmap. The\nmap is configured to automatically pan to the\nposition of any point that arrives.\n\nThe second flow initialise the dashboard template\nwith the initial map and sets it to a more square shape\nby adjusting the height.","x":210,"y":60,"wires":[]},{"id":"9c513681.807cd8","type":"debug","z":"5fa738eb.f40408","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":720,"y":400,"wires":[]},{"id":"8dc625dc.fc4788","type":"switch","z":"bcc0b3a.aa2e95","name":"","property":"msg","propertyType":"jsonata","rules":[{"t":"hask","v":"mousePos","vt":"str"},{"t":"hask","v":"dimChange","vt":"str"},{"t":"hask","v":"initMap","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":330,"y":100,"wires":[["e9698323.93a47","3b470eb9.795912"],["fe7554ce.c702f8"],["cd07feba.0dba4"]]},{"id":"fe7554ce.c702f8","type":"change","z":"bcc0b3a.aa2e95","name":"","rules":[{"t":"set","p":"lastDim","pt":"flow","to":"dimChange","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":260,"wires":[["6674bdf9.4139b4","7a75ad1e.e4a494","b5c7e99c.850c08","409db326.26118c"]]},{"id":"aea4b0d1.4ae9a","type":"change","z":"bcc0b3a.aa2e95","name":"setDim from flow","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setDim\": $flowContext(\"lastDim\")\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":280,"wires":[["2943c3a3.b4661c","ccf04bf7.2562c8"]]},{"id":"5ff9f61e.f07a88","type":"debug","z":"bcc0b3a.aa2e95","name":"","active":true,"console":"false","complete":"true","x":250,"y":560,"wires":[]},{"id":"e782e02d.d839d","type":"catch","z":"bcc0b3a.aa2e95","name":"","scope":null,"uncaught":false,"x":100,"y":560,"wires":[["5ff9f61e.f07a88"]]},{"id":"5892bfc2.7b592","type":"change","z":"bcc0b3a.aa2e95","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Nitro\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":320,"wires":[["ccf04bf7.2562c8","2d58f7e0.b11f48"]]},{"id":"e53620b4.670b6","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"console":"false","complete":"true","x":450,"y":160,"wires":[]},{"id":"37da7715.c59298","type":"json","z":"9693d392.5f9c5","name":"","property":"payload","action":"str","pretty":false,"x":290,"y":160,"wires":[["833190a4.382b6","e53620b4.670b6"]]},{"id":"833190a4.382b6","type":"switch","z":"9693d392.5f9c5","name":"","property":"msg","propertyType":"jsonata","rules":[{"t":"hask","v":"mousePos","vt":"str"},{"t":"hask","v":"dimChange","vt":"str"},{"t":"hask","v":"initMap","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":220,"wires":[["3700ea1c.eeeb86","e2fbc2d1.27c67","429702fb.2e24bc"],["7c38ef92.2a6bf"],["2fdae5f1.d8d30a","b9839bb.5f08968"]]},{"id":"7c38ef92.2a6bf","type":"change","z":"9693d392.5f9c5","name":"","rules":[{"t":"set","p":"lastDim","pt":"flow","to":"dimChange","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":200,"wires":[["2f71c409.eeb9dc","4c6564b5.7dde7c","679ba08f.aed32"]]},{"id":"65208b34.edf6a4","type":"change","z":"9693d392.5f9c5","name":"setDim from flow","rules":[{"t":"set","p":"payload.setDim","pt":"msg","to":"lastDim","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":440,"wires":[["6faf65d0.090d7c","56789bab.654a24"]]},{"id":"5431ec9a.fed764","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"console":"false","complete":"true","x":250,"y":780,"wires":[]},{"id":"8c9f017b.905d9","type":"catch","z":"9693d392.5f9c5","name":"","scope":null,"uncaught":false,"x":80,"y":780,"wires":[["5431ec9a.fed764"]]},{"id":"d1ae3e12.2fd0c","type":"change","z":"9693d392.5f9c5","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Nitro\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":380,"wires":[["56789bab.654a24"]]},{"id":"6f0e6b8.7cfdf94","type":"change","z":"9693d392.5f9c5","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Popul\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":340,"wires":[["56789bab.654a24"]]},{"id":"2fdae5f1.d8d30a","type":"change","z":"9693d392.5f9c5","name":"SetRefPoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"setDim\": {\t        \"zoom\": \"14\",\t        \"pos\": $flowContext(\"refData\").pos,\t        \"type\": \"initMap\",\t        \"mapId\": msg.payload.mapId\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":110,"y":80,"wires":[["6faf65d0.090d7c","56789bab.654a24","ab824edc.9e12b"]]},{"id":"50ca1cf4.6f4c34","type":"change","z":"9693d392.5f9c5","name":"En Nitro","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["3f0be585.dd31ca"]]},{"id":"c4a2ff77.9fd0d","type":"change","z":"9693d392.5f9c5","name":"En Popul","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":340,"wires":[["dd97bc8b.db774"]]},{"id":"f9d424db.7f4688","type":"inject","z":"9693d392.5f9c5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0.4","payloadType":"num","x":90,"y":300,"wires":[["dd97bc8b.db774","3f0be585.dd31ca"]]},{"id":"9cb4bf43.e8401","type":"change","z":"bcc0b3a.aa2e95","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Popul\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":380,"wires":[["ccf04bf7.2562c8"]]},{"id":"7e058a37.4c40e4","type":"change","z":"bcc0b3a.aa2e95","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["a74092a5.c28e3"]]},{"id":"bcb220bc.4a16f","type":"change","z":"bcc0b3a.aa2e95","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["47b09b4b.11b5d4"]]},{"id":"2d58f7e0.b11f48","type":"debug","z":"bcc0b3a.aa2e95","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":440,"wires":[]},{"id":"cd07feba.0dba4","type":"change","z":"bcc0b3a.aa2e95","name":"SetRefPoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"setDim\": {\t        \"zoom\": \"13\",\t        \"pos\": {\t            \"lat\": \"48.204550\",\t            \"lng\": \"16.364333\"\t        },\t        \"type\": \"initMap\",\t        \"mapId\": msg.payload.mapId\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":110,"y":20,"wires":[["ccf04bf7.2562c8"]]},{"id":"6b610517.1197cc","type":"http request","z":"22be0357.6ef6fc","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":470,"y":260,"wires":[["263c6a33.2709d6"]]},{"id":"d51c34e7.201c88","type":"change","z":"45272af4.690614","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":280,"wires":[["b81ba735.6c0288"]]},{"id":"e4b5f6b5.ac7a98","type":"subflow:22be0357.6ef6fc","z":"45272af4.690614","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":170,"y":300,"wires":[["d51c34e7.201c88"],[],[]]},{"id":"c63c4fef.64ee5","type":"change","z":"22be0357.6ef6fc","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":40,"wires":[["a5d11332.53ac8"]]},{"id":"b81ba735.6c0288","type":"subflow:22be0357.6ef6fc","z":"45272af4.690614","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":580,"y":380,"wires":[["6552faee.7f79b4"],[],[]]},{"id":"276440b3.5fca6","type":"switch","z":"22be0357.6ef6fc","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"POST","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":60,"wires":[["c63c4fef.64ee5"],["c4faa10f.99ded"]]},{"id":"9e97f404.322068","type":"change","z":"22be0357.6ef6fc","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":100,"wires":[["a5d11332.53ac8"]]},{"id":"9d0b864a.53d0b8","type":"delay","z":"45272af4.690614","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":380,"wires":[["b81ba735.6c0288"]]},{"id":"d78059a8.60d3b8","type":"subflow:22be0357.6ef6fc","z":"1856e54.6882d1b","name":"GET queryjobs/download/","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/download/","type":"str"}],"x":470,"y":420,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"b49291fc.7e444","type":"change","z":"1856e54.6882d1b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":100,"y":400,"wires":[["d78059a8.60d3b8"]]},{"id":"3de156be.a97d3a","type":"inject","z":"1856e54.6882d1b","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"lastQuery","payloadType":"flow","x":110,"y":440,"wires":[["d78059a8.60d3b8"]]},{"id":"3c865690.f7436a","type":"subflow:22be0357.6ef6fc","z":"e68fbd7c.0431a","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":410,"y":240,"wires":[[],[],[]]},{"id":"7fd3ba94.6651b4","type":"debug","z":"1856e54.6882d1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":850,"y":200,"wires":[]},{"id":"c4faa10f.99ded","type":"switch","z":"22be0357.6ef6fc","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":80,"wires":[["c63c4fef.64ee5"],["9e97f404.322068"]]},{"id":"69f422.32d27be","type":"subflow:e68fbd7c.0431a","z":"1856e54.6882d1b","name":"","env":[],"x":460,"y":200,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"8b5cacc2.3cf7c","type":"inject","z":"1856e54.6882d1b","name":"Test Layer 49058","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"49058\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":120,"y":160,"wires":[["69f422.32d27be"]]},{"id":"ff902ae9.4adf38","type":"inject","z":"9693d392.5f9c5","name":"SetRefData","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49432\",\"49433\",\"49441\",\"49454\"],\"layers_old\":[\"50450\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":100,"y":40,"wires":[["356f8f0.3132372"]]},{"id":"356f8f0.3132372","type":"change","z":"9693d392.5f9c5","name":"set flow.refData","rules":[{"t":"set","p":"refData","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"mousePos","pt":"msg","to":"payload.pos","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":40,"wires":[["3700ea1c.eeeb86","e2fbc2d1.27c67","3392ed2d.06e162","cf4aaa8f.18bb98"]]},{"id":"68941929.3cd678","type":"subflow:e68fbd7c.0431a","z":"9693d392.5f9c5","name":"","env":[],"x":670,"y":260,"wires":[["9552e9fd.8b2898","ff8dfbd3.ac67c8"],["38ad4065.f331d"],["38ad4065.f331d"]]},{"id":"5f58df45.dd49c","type":"subflow:22be0357.6ef6fc","z":"1856e54.6882d1b","name":"GET queryjobs/{payload}/layers","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"},{"name":"urlSuffix","value":"/layers","type":"str"}],"x":490,"y":480,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"fce50e6d.e1d67","type":"inject","z":"1856e54.6882d1b","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"lastQuery","payloadType":"flow","x":110,"y":480,"wires":[["5f58df45.dd49c"]]},{"id":"4a41dfd4.ae7c5","type":"change","z":"45272af4.690614","name":"setDelay","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":380,"wires":[["9d0b864a.53d0b8"]]},{"id":"3700ea1c.eeeb86","type":"change","z":"9693d392.5f9c5","name":"Set Lat","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.pos.lat","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"mousePos.lat","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":40,"wires":[["bd7e0ce6.e9f2b"]]},{"id":"e2fbc2d1.27c67","type":"change","z":"9693d392.5f9c5","name":"Set Lng","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.pos.lng","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"mousePos.lng","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":80,"wires":[["6ac52f7f.1215b"]]},{"id":"429702fb.2e24bc","type":"change","z":"9693d392.5f9c5","name":"","rules":[{"t":"set","p":"lastPos","pt":"flow","to":"mousePos","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":120,"wires":[[]]},{"id":"650f3657.e66cd8","type":"change","z":"9693d392.5f9c5","name":"init lastPos","rules":[{"t":"set","p":"payload","pt":"msg","to":"refData","tot":"flow"},{"t":"set","p":"payload.text","pt":"msg","to":"Loading Layers","tot":"str"},{"t":"set","p":"payload.pos","pt":"msg","to":"lastPos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":280,"wires":[["68941929.3cd678","9552e9fd.8b2898","a1bae403.9fcb98"]]},{"id":"6b7bc43.587eb3c","type":"change","z":"9693d392.5f9c5","name":"setDim from flow","rules":[{"t":"set","p":"payload.setDim","pt":"msg","to":"lastDim","tot":"flow"},{"t":"set","p":"payload.setDim.pos","pt":"msg","to":"refData.pos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":440,"wires":[["6faf65d0.090d7c"]]},{"id":"2f90c9e0.758cb6","type":"subflow:45272af4.690614","z":"9693d392.5f9c5","name":"","env":[],"x":500,"y":500,"wires":[["60108c4.632b074","c3458231.5a736"],["60108c4.632b074"],[],["60108c4.632b074"],["60108c4.632b074"],[]]},{"id":"c9741a40.5904b8","type":"change","z":"9693d392.5f9c5","name":"Set refData&lastPos","rules":[{"t":"set","p":"payload","pt":"msg","to":"refData","tot":"flow"},{"t":"set","p":"payload.pos","pt":"msg","to":"lastPos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":500,"wires":[["2f90c9e0.758cb6"]]},{"id":"60108c4.632b074","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":870,"y":500,"wires":[]},{"id":"50362239.b9c8cc","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":580,"wires":[]},{"id":"8bfd11bc.08238","type":"subflow:22be0357.6ef6fc","z":"9693d392.5f9c5","name":"GET queryjobs/{payload}/layers","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"},{"name":"urlSuffix","value":"/layers","type":"str"}],"x":530,"y":600,"wires":[["50362239.b9c8cc","ce3edf37.6556e"],["50362239.b9c8cc"],[]]},{"id":"c3458231.5a736","type":"change","z":"9693d392.5f9c5","name":"Extract QueryID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":560,"wires":[["8bfd11bc.08238"]]},{"id":"51c9108.83280f","type":"inject","z":"9693d392.5f9c5","name":"SampleQueryResult","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"id\":\"1599796800_20179116\",\"status\":\"Succeeded\",\"start\":1599816979116,\"folder\":\"1599816979104\",\"swLat\":47.576553,\"swLon\":3.3840909,\"neLat\":50.16917,\"neLon\":5.8905783,\"nickname\":\"NodeRED_Ref 49.087126542584954-3.9402723312377934\",\"exPercent\":0,\"flag\":false,\"hadoopId\":\"1591579541500_1159378\",\"ready\":true,\"rtStatus\":\"Succeeded\",\"statusCode\":20}","payloadType":"json","x":130,"y":600,"wires":[["c3458231.5a736"]]},{"id":"a54d400a.28733","type":"change","z":"9693d392.5f9c5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"addLayers\" : payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":660,"wires":[["56789bab.654a24"]]},{"id":"ce3edf37.6556e","type":"json","z":"9693d392.5f9c5","name":"","property":"payload","action":"","pretty":false,"x":450,"y":660,"wires":[["a54d400a.28733"]]},{"id":"b9839bb.5f08968","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":140,"wires":[]},{"id":"ab824edc.9e12b","type":"debug","z":"9693d392.5f9c5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":310,"y":80,"wires":[]},{"id":"a1bae403.9fcb98","type":"debug","z":"9693d392.5f9c5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":420,"wires":[]},{"id":"38ad4065.f331d","type":"debug","z":"9693d392.5f9c5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":380,"wires":[]},{"id":"ff8dfbd3.ac67c8","type":"debug","z":"9693d392.5f9c5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":340,"wires":[]},{"id":"f782f8ad.570d28","type":"inject","z":"1856e54.6882d1b","name":"Test 11 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\",\"49252\",\"49257\",\"49304\",\"49313\",\"50453\",\"49310\",\"49311\",\"49250\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":200,"wires":[["69f422.32d27be"]]},{"id":"cb6efb86.f88a88","type":"inject","z":"1856e54.6882d1b","name":"Test 2 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":240,"wires":[["69f422.32d27be"]]},{"id":"b19d6d1b.31437","type":"debug","z":"1856e54.6882d1b","name":"debug msg","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":300,"wires":[]},{"id":"261f38ba.b307a8","type":"inject","z":"1856e54.6882d1b","name":"Test Point Query","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Max\"}],\"spatial\":{\"type\":\"point\",\"coordinates\":[\"49.080609\",\"3.961231\"]},\"temporal\":{\"intervals\":[{\"start\":\"2018-06-30T00:00:00Z\",\"end\":\"2018-10-31T00:00:00Z\"}]}}","payloadType":"json","x":120,"y":280,"wires":[["dd598095.d9e47"]]},{"id":"dd598095.d9e47","type":"subflow:22be0357.6ef6fc","z":"1856e54.6882d1b","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":430,"y":280,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"e2435632.28e3b8","type":"comment","z":"e68fbd7c.0431a","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":240,"y":60,"wires":[]},{"id":"263c6a33.2709d6","type":"switch","z":"22be0357.6ef6fc","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":260,"wires":[["90e7e0f8.4b61c"],[]],"outputLabels":["ok","error"]},{"id":"e58eee43.fdd1f","type":"debug","z":"1856e54.6882d1b","name":"error msg","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":840,"y":400,"wires":[]},{"id":"7279cf64.23dc1","type":"subflow:22be0357.6ef6fc","z":"b14a35fc.a33548","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":620,"y":140,"wires":[["14fdbe57.397492"],[],[]]},{"id":"aa73b87b.5f31b8","type":"split","z":"b14a35fc.a33548","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":450,"y":180,"wires":[["7279cf64.23dc1"]]},{"id":"2d219b6.ad32e64","type":"inject","z":"1856e54.6882d1b","name":"Test 2 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":60,"wires":[["2c573e79.93cb62"]]},{"id":"3d08812c.15e0de","type":"change","z":"b14a35fc.a33548","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":140,"wires":[["aa73b87b.5f31b8"]]},{"id":"14fdbe57.397492","type":"join","z":"b14a35fc.a33548","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":810,"y":120,"wires":[["a40ebdd0.de77a"]]},{"id":"9488717b.662d8","type":"inject","z":"1856e54.6882d1b","name":"Test 11 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\",\"49252\",\"49257\",\"49304\",\"49313\",\"50453\",\"49310\",\"49311\",\"49250\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":100,"wires":[["2c573e79.93cb62"]]},{"id":"8d2a2e1b.32182","type":"inject","z":"1856e54.6882d1b","name":"Test Layer 16100,49058,49296","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49058\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":170,"y":20,"wires":[["2c573e79.93cb62"]]},{"id":"2c573e79.93cb62","type":"subflow:b14a35fc.a33548","z":"1856e54.6882d1b","name":"","env":[],"x":460,"y":60,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"acda743b.735d48","type":"switch","z":"b14a35fc.a33548","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["3d08812c.15e0de"],["aa73b87b.5f31b8"],[]]},{"id":"47d3c58f.75cb7c","type":"comment","z":"b14a35fc.a33548","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"90e7e0f8.4b61c","type":"json","z":"22be0357.6ef6fc","name":"","property":"payload","action":"obj","pretty":false,"x":850,"y":240,"wires":[[]]},{"id":"a83e9bae.8c9a68","type":"debug","z":"5fed8ae7.8bb5a4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":320,"wires":[]},{"id":"80a88b8f.298e78","type":"debug","z":"5fed8ae7.8bb5a4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":790,"y":220,"wires":[]},{"id":"4167b0d4.a2018","type":"comment","z":"5fed8ae7.8bb5a4","name":"README!! WinSCP","info":"This flow uses the `uibuilder` from `node-red-contrib-uibuilder` package\n\nTo use with IBMCloud, keep in mind that the filesystem on the cloud is *NOT* persistent. So edits done here are not retained across restarts/restages of the IBMCloud application.\n\nTo remediate this, the idea is to edit the files in the gitlab repository associated with this Node-RED app, and to facilitate developments, to sunchronize the local git clone and the current instance file system using WinSCP over CloudFoundry SSH connection.\n\nTo do this, get WinSCP, get the ibmcloud commandline, and use the following commands:\n - `ibmcloud cf -q curl /v2/info` to get the host and port for the remote app\n - `ibmcloud cf -q app %APP_NAME% --guid` to get the APP_GUID\n - `ibmcloud cf -q ssh-code` to get a password.\nThe WinSCP command will then be:\n```\nwinscp scp://cf%%3A%APP_GUID%%%2F0:%SSH_CODE%@%SSH_HOST%:%SSH_PORT%/home/vcap/app/.node-red/uibuilder/uibuilder/src/\n```\nIf the authentication fails, use `ibmcloud cf -q ssh-code` to get a renewed password","x":690,"y":140,"wires":[]},{"id":"c0f22802.b9f528","type":"change","z":"5fed8ae7.8bb5a4","name":"RefData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"layers\":[\"49296\",\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49304\",\"50463\",\"49252\",\"50450\",\"50509\",\"50511\",\"50497\",\"50496\",\"50498\",\"50449\",\"50447\",\"50453\",\"50456\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","tot":"json"},{"t":"set","p":"payload.zoom","pt":"msg","to":"12","tot":"num"},{"t":"set","p":"payload.duration","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":120,"y":200,"wires":[["efc32871.ff0a38"]]},{"id":"e57dd0c9.ea93f","type":"switch","z":"5fed8ae7.8bb5a4","name":"switch topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"initLayers","vt":"str"},{"t":"eq","v":"loadLayers","vt":"str"},{"t":"eq","v":"loadAOIs","vt":"str"},{"t":"eq","v":"scoringQuery","vt":"str"},{"t":"eq","v":"scoringLayers","vt":"str"},{"t":"eq","v":"listQueryJobs","vt":"str"},{"t":"eq","v":"deleteQueryJob","vt":"str"},{"t":"eq","v":"mapClick","vt":"str"},{"t":"eq","v":"mapMove","vt":"str"},{"t":"eq","v":"mapMoveend","vt":"str"},{"t":"eq","v":"mapZoomend","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":12,"x":150,"y":440,"wires":[["a5bfb3db.d933d"],["6a3160f6.b8e73"],["bbcfcde3.fb03c"],["34297c82.3e0c04"],["627c085a.b13dd8"],["be1041fc.81f6c"],["2ae93902.04ff96"],["3e5705db.ca5e9a"],[],[],[],["8f1f4081.886b1"]]},{"id":"36aee627.0b693a","type":"debug","z":"5fed8ae7.8bb5a4","name":"trace UI Command","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":270,"y":260,"wires":[]},{"id":"3e5705db.ca5e9a","type":"change","z":"5fed8ae7.8bb5a4","name":"setRefPointMarker","rules":[{"t":"set","p":"topic","pt":"msg","to":"setRefPointMarker","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":840,"wires":[["2704965f.c8c6fa"]]},{"id":"3624727e.85076e","type":"link in","z":"5fed8ae7.8bb5a4","name":"toFront","links":["2704965f.c8c6fa"],"x":75,"y":240,"wires":[["efc32871.ff0a38","36aee627.0b693a"]]},{"id":"2704965f.c8c6fa","type":"link out","z":"5fed8ae7.8bb5a4","name":"PAIRS ok","links":["3624727e.85076e"],"x":995,"y":400,"wires":[]},{"id":"6a3160f6.b8e73","type":"subflow:e68fbd7c.0431a","z":"5fed8ae7.8bb5a4","name":"","env":[],"x":500,"y":420,"wires":[["2704965f.c8c6fa","559eecc0.9adae4"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]]},{"id":"6a2b5197.2396f","type":"subflow:b14a35fc.a33548","z":"5fed8ae7.8bb5a4","name":"","env":[],"x":500,"y":360,"wires":[["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]],"icon":"node-red/subflow.svg"},{"id":"a5bfb3db.d933d","type":"change","z":"5fed8ae7.8bb5a4","name":"set Layers","rules":[{"t":"set","p":"payload.layers","pt":"msg","to":"layers","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":360,"wires":[["6a2b5197.2396f"]]},{"id":"8f1f4081.886b1","type":"change","z":"5fed8ae7.8bb5a4","name":"Set pairsError","rules":[{"t":"set","p":"pairsError","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":520,"wires":[["2704965f.c8c6fa","ec54685c.664f98"]]},{"id":"7adeb8a1.81de58","type":"switch","z":"5fed8ae7.8bb5a4","name":"","property":"uibuilderCtrl","propertyType":"msg","rules":[{"t":"eq","v":"ready for content","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":480,"y":260,"wires":[["80a88b8f.298e78","30ca398a.e6ac66"],[]]},{"id":"30ca398a.e6ac66","type":"change","z":"5fed8ae7.8bb5a4","name":"","rules":[{"t":"delete","p":"uibuilderCtrl","pt":"msg"},{"t":"delete","p":"from","pt":"msg"},{"t":"delete","p":"cacheControl","pt":"msg"},{"t":"set","p":"topic","pt":"msg","to":"init","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":280,"wires":[["80a88b8f.298e78","2704965f.c8c6fa"]]},{"id":"bbcfcde3.fb03c","type":"subflow:22be0357.6ef6fc","z":"5fed8ae7.8bb5a4","name":"Get AOIs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/ws/queryaois/repository/search?name=","type":"str"},{"name":"urlSuffix","value":"%5C%5F","type":"str"}],"x":460,"y":480,"wires":[["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]]},{"id":"4bf6ab82.9a3dd4","type":"subflow:22be0357.6ef6fc","z":"1856e54.6882d1b","name":"Get AOIs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/ws/queryaois/repository/search?name=","type":"str"},{"name":"urlSuffix","value":"%5C%5F","type":"str"}],"x":420,"y":340,"wires":[["7fd3ba94.6651b4"],["b19d6d1b.31437"],["e58eee43.fdd1f"]]},{"id":"3fd1a3a0.91aa3c","type":"inject","z":"1856e54.6882d1b","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"FRA","payloadType":"str","x":90,"y":320,"wires":[["4bf6ab82.9a3dd4"]]},{"id":"dc7c2150.d9aa8","type":"inject","z":"1856e54.6882d1b","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"county","payloadType":"str","x":90,"y":360,"wires":[["4bf6ab82.9a3dd4"]]},{"id":"e1519206.1770c","type":"debug","z":"5fed8ae7.8bb5a4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":780,"y":180,"wires":[]},{"id":"a5d11332.53ac8","type":"change","z":"22be0357.6ef6fc","name":"AuthHeaders","rules":[{"t":"set","p":"headers","pt":"msg","to":"{\t  \"Authorization\":\t    \"Basic \" & $base64encode(\t       $globalContext(\"PAIRS\").user &\t':' & $globalContext(\"PAIRS\").apikey),\t\"Content-Type\" : \"application/json\",\t\"Accept\": \"application/json\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":60,"wires":[["6b610517.1197cc"]]},{"id":"8d218993.b53408","type":"inject","z":"22be0357.6ef6fc","name":"Init PAIRS Cred","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\t   \"user\":$env(\"PAIRS_USER\"),\t   \"apikey\": $env(\"PAIRS_APIKEY\")\t}","payloadType":"jsonata","x":130,"y":380,"wires":[["f9b1d5a2.8904d8"]]},{"id":"f9b1d5a2.8904d8","type":"change","z":"22be0357.6ef6fc","name":"","rules":[{"t":"set","p":"PAIRS","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":340,"wires":[[]]},{"id":"34297c82.3e0c04","type":"subflow:45272af4.690614","z":"5fed8ae7.8bb5a4","name":"","env":[],"x":510,"y":560,"wires":[["2704965f.c8c6fa"],["8f1f4081.886b1"],[],["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["f086ba1f.eb71a8"]]},{"id":"69895948.b9a3f8","type":"inject","z":"1856e54.6882d1b","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":120,"y":540,"wires":[["607d8f0.89a3b7"]]},{"id":"18496c8c.ba85a3","type":"inject","z":"1856e54.6882d1b","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":140,"y":580,"wires":[["607d8f0.89a3b7"]]},{"id":"607d8f0.89a3b7","type":"subflow:45272af4.690614","z":"1856e54.6882d1b","name":"","env":[],"x":450,"y":560,"wires":[["4097e2be.721c0c","7fd3ba94.6651b4"],["e58eee43.fdd1f"],["b0612bee.320498"],["7fd3ba94.6651b4"],["b19d6d1b.31437"],["417b784d.bafed8"]]},{"id":"4097e2be.721c0c","type":"switch","z":"1856e54.6882d1b","name":"","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":520,"wires":[[],[]],"outputLabels":["Succeeded","Failed"]},{"id":"b0612bee.320498","type":"change","z":"1856e54.6882d1b","name":"","rules":[{"t":"set","p":"lastQuery","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":560,"wires":[[]]},{"id":"a3c1bea6.ca5d8","type":"inject","z":"1856e54.6882d1b","name":"UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"pos\":{\"lat\":47.45,\"lng\":3.5},\"aoi\":38593,\"startDay\":\"2020-09-05\",\"endDay\":\"2020-10-06\",\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49257\",\"49310\",\"49311\",\"49313\",\"49432\",\"49433\",\"49441\",\"49454\"],\"UDF\":\"(( $16100 >= 14.2 && $16100 <= 19.77) ? 1 : 0 ) + (( $16200 >= 58.79 && $16200 <= 74.87) ? 1 : 0 ) + (( $16700 >= 0.15 && $16700 <= 0.9) ? 1 : 0 ) + (( $49250 >= 2.1 && $49250 <= 8.28) ? 1 : 0 ) + (( $49257 >= 14.58 && $49257 <= 20.26) ? 1 : 0 ) + (( $49310 >= 13.5 && $49310 <= 19.78) ? 1 : 0 ) + (( $49311 >= 0.72 && $49311 <= 1.92) ? 1 : 0 ) + (( $49313 >= 2.38 && $49313 <= 4.08) ? 1 : 0 ) + (( $49432 >= 0.01 && $49432 <= 0.14) ? 1 : 0 ) + (( $49433 >= 0.04 && $49433 <= 0.38) ? 1 : 0 ) + (( $49441 >= 0.59 && $49441 <= 1.13) ? 1 : 0 ) + (( $49454 >= 0.39 && $49454 <= 0.59) ? 1 : 0 ) + \"}","payloadType":"json","x":90,"y":620,"wires":[["607d8f0.89a3b7"]]},{"id":"6552faee.7f79b4","type":"switch","z":"45272af4.690614","name":"Test Status","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Initializing","vt":"str"},{"t":"eq","v":"Queued","vt":"str"},{"t":"eq","v":"Running","vt":"str"},{"t":"eq","v":"Writing","vt":"str"},{"t":"eq","v":"Succeeded","vt":"str"},{"t":"eq","v":"Failed","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":170,"y":540,"wires":[["7383d76a.ae5d08"],["7383d76a.ae5d08","288e21d8.0ec36e"],["7383d76a.ae5d08","8e96b9c0.ef1d68"],["7383d76a.ae5d08"],[],["8d584588.626178"],["23ff7bd5.465224"]]},{"id":"7383d76a.ae5d08","type":"change","z":"45272af4.690614","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":440,"wires":[["4a41dfd4.ae7c5"]]},{"id":"78a136dd.677f18","type":"inject","z":"1856e54.6882d1b","name":"Working Query","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\",\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"50509\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}],\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"50509\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}],\"output\":\"false\"},{\"type\":\"raster\",\"id\":\"50509\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}],\"output\":\"false\"},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":38662},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":120,"y":660,"wires":[["607d8f0.89a3b7"]]},{"id":"664e6cdb.72c354","type":"switch","z":"45272af4.690614","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"id","vt":"str"},{"t":"hask","v":"name","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":150,"y":160,"wires":[["d51c34e7.201c88"],["e4b5f6b5.ac7a98"],["5b5c0afb.53b1b4","771a35b3.68008c"]]},{"id":"417b784d.bafed8","type":"debug","z":"1856e54.6882d1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":720,"y":620,"wires":[]},{"id":"be1041fc.81f6c","type":"subflow:22be0357.6ef6fc","z":"5fed8ae7.8bb5a4","name":"List QueryJobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/list?flag=0&page=1&size=2147483647","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":480,"y":700,"wires":[["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]]},{"id":"f086ba1f.eb71a8","type":"debug","z":"5fed8ae7.8bb5a4","name":"quryJSON","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":580,"wires":[]},{"id":"1ecaba12.38e9e6","type":"inject","z":"1856e54.6882d1b","name":"VitiXplore query","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"VitXplore_38593_[47.45;3.5]_[2020-09-06/2020-10-06]\",\"layers\":[{\"alias\":\"Mean_16100\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"16100\"},{\"alias\":\"Mean_16200\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"16200\"},{\"alias\":\"Mean_16700\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"16700\"},{\"alias\":\"Mean_49250\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49250\"},{\"alias\":\"Mean_49257\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49257\"},{\"alias\":\"Mean_49310\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49310\"},{\"alias\":\"Mean_49311\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49311\"},{\"alias\":\"Mean_49313\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49313\"},{\"alias\":\"Mean_49432\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49432\"},{\"alias\":\"Mean_49433\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49433\"},{\"alias\":\"Mean_49441\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49441\"},{\"alias\":\"Mean_49454\",\"type\":\"raster\",\"aggregation\":\"Mean\",\"output\":\"false\",\"id\":\"49454\"},{\"alias\":\"scoring\",\"expression\":\"(( $Mean_16100 >= 14.22 && $Mean_16100 <= 19.79) ? 1 : 0 ) + (( $Mean_16200 >= 58.76 && $Mean_16200 <= 74.84) ? 1 : 0 ) + (( $Mean_16700 >= 0.16 && $Mean_16700 <= 0.9) ? 1 : 0 ) + (( $Mean_49250 >= 2.17 && $Mean_49250 <= 8.35) ? 1 : 0 ) + (( $Mean_49257 >= 14.57 && $Mean_49257 <= 20.25) ? 1 : 0 ) + (( $Mean_49310 >= 13.48 && $Mean_49310 <= 19.76) ? 1 : 0 ) + (( $Mean_49311 >= 0.71 && $Mean_49311 <= 1.91) ? 1 : 0 ) + (( $Mean_49313 >= 2.4 && $Mean_49313 <= 4.1) ? 1 : 0 ) + (( $Mean_49432 >= 0.01 && $Mean_49432 <= 0.14) ? 1 : 0 ) + (( $Mean_49433 >= 0.04 && $Mean_49433 <= 0.38) ? 1 : 0 ) + (( $Mean_49441 >= 0.59 && $Mean_49441 <= 1.13) ? 1 : 0 ) + (( $Mean_49454 >= 0.39 && $Mean_49454 <= 0.59) ? 1 : 0 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":38593},\"temporal\":{\"intervals\":[{\"start\":\"2020-09-06T00:00:00Z\",\"end\":\"2020-10-06T00:00:00Z\"}]}}","payloadType":"json","x":130,"y":720,"wires":[["607d8f0.89a3b7"]]},{"id":"2ae93902.04ff96","type":"subflow:22be0357.6ef6fc","z":"5fed8ae7.8bb5a4","name":"Del Query Job","env":[{"name":"method","value":"DELETE","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":480,"y":760,"wires":[["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]]},{"id":"ec54685c.664f98","type":"link out","z":"5fed8ae7.8bb5a4","name":"PAIRS Error","links":["75f5d767.1bd4d8"],"x":1015,"y":520,"wires":[]},{"id":"75f5d767.1bd4d8","type":"link in","z":"5fed8ae7.8bb5a4","name":"errorUI","links":["ec54685c.664f98"],"x":75,"y":280,"wires":[["efc32871.ff0a38","50194394.21477c"]]},{"id":"50194394.21477c","type":"debug","z":"5fed8ae7.8bb5a4","name":"trace UI Errors","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":260,"y":300,"wires":[]},{"id":"efc32871.ff0a38","type":"uibuilder","z":"5fed8ae7.8bb5a4","name":"","topic":"","url":"uibuilder","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"showfolder":false,"x":340,"y":200,"wires":[["e57dd0c9.ea93f","e1519206.1770c"],["7adeb8a1.81de58"]]},{"id":"a539fe9f.ca7b","type":"worldmap","z":"287ecead.0df562","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":380,"y":160,"wires":[]},{"id":"16e3f4d8.e7b72b","type":"worldmap","z":"5fa738eb.f40408","name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"hide","layers":"show","panit":"true","hiderightclick":"false","coords":"deg","showgrid":"true","path":"osmbase","x":620,"y":320,"wires":[]},{"id":"a522922e.4c608","type":"worldmap in","z":"287ecead.0df562","name":"","path":"/worldmap","events":"all","x":660,"y":160,"wires":[[]]},{"id":"7e396d9c.726be4","type":"worldmap in","z":"5fa738eb.f40408","name":"","path":"/osmbase","events":"all","x":530,"y":460,"wires":[["9c513681.807cd8"]]},{"id":"aa6e5a4.70481a8","type":"worldmap-tracks","z":"5fa738eb.f40408","name":"","depth":"5","layer":"combined","x":530,"y":80,"wires":[["16e3f4d8.e7b72b"]]},{"id":"e4b650db.a6f","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":5,"width":6,"height":1,"passthru":false,"label":"Move Mike","tooltip":"","color":"","bgcolor":"","icon":"fa-male","payload":"","payloadType":"str","topic":"","x":160,"y":180,"wires":[["230d1bc0.130054"]]},{"id":"be21b4.d1d85e5","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":4,"width":2,"height":1,"passthru":false,"label":"Hide all","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"layer\":\"none\"}}","payloadType":"json","topic":"","x":170,"y":320,"wires":[["16e3f4d8.e7b72b"]]},{"id":"f20fc42c.1d7eb8","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":3,"width":2,"height":1,"passthru":false,"label":"Delete","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"delete\":[\"Watercolor\",\"ship nav\",\"heatmap\",\"Terrain\",\"UK OS 1900\",\"UK OS 1919-47\"]}}}","payloadType":"json","topic":"","x":180,"y":420,"wires":[["16e3f4d8.e7b72b"]]},{"id":"bc04969d.ae1028","type":"ui_button","z":"bcc0b3a.aa2e95","name":"","group":"7b72899.38e6578","order":14,"width":2,"height":1,"passthru":false,"label":"Align coords","tooltip":"","color":"","bgcolor":"","icon":"","payload":"lastDim","payloadType":"flow","topic":"","x":730,"y":280,"wires":[["aea4b0d1.4ae9a"]]},{"id":"2bd8c9a.6b34736","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":7,"width":3,"height":1,"passthru":false,"label":"NowCoast","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"NowCoast\",\"url\":\"https://nowcoast.noaa.gov/arcgis/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer/WmsServer?\",\"opt\":{\"layers\":\"1\",\"format\":\"image/png\",\"transparent\":true,\"attribution\":\"NOAA/NWS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":160,"y":500,"wires":[["16e3f4d8.e7b72b"]]},{"id":"684b11ae.7c5ed","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":8,"width":3,"height":1,"passthru":false,"label":"PAIRS Population","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"Population\",\"url\":\"https://pairs.res.ibm.com:8080/geoserver06/pairs/wms?styles=&sld=https%3A%2F%2Fpairs.res.ibm.com%3A443%2Fmap%2Fsld%3Ftype%3Draster%26min%3D0%26max%3D655350%26colorTableId%3D92%26no_data%3D-1%26property%3Dvalue%26layer%3Dpairs%3A1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000&authorization=jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I\",\"opt\":{\"layers\":\"1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000\",\"format\":\"image/png\",\"transparent\":true,\"transitionEffect\":\"resize\",\"attribution\":\"PAIRS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":190,"y":540,"wires":[["16e3f4d8.e7b72b"]]},{"id":"189732e5.aa9e2d","type":"ui_button","z":"5fa738eb.f40408","name":"","group":"7f6d1bbc.b842f4","order":9,"width":3,"height":1,"passthru":false,"label":"PAIRS Nitro","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"Nitro\",\"url\":\"https://pairs.res.ibm.com:8080/geoserver1/pairs/wms?styles=&sld=https%3A%2F%2Fpairs.res.ibm.com%3A443%2Fmap%2Fsld%3Ftype%3Draster%26min%3D0%26max%3D0.0001%26colorTableId%3D4%26no_data%3D-1%26property%3Dvalue%26layer%3Dpairs%3A1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean&authorization=jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I\",\"opt\":{\"layers\":\"1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean\",\"format\":\"image/png\",\"transparent\":true,\"transitionEffect\":\"resize\",\"attribution\":\"PAIRS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":170,"y":580,"wires":[["16e3f4d8.e7b72b"]]},{"id":"cd9efb7a.b821b8","type":"ui_button","z":"9693d392.5f9c5","name":"","group":"9b16ec6a.5908a","order":14,"width":2,"height":1,"passthru":false,"label":"Align coords","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":90,"y":440,"wires":[["65208b34.edf6a4"]]},{"id":"bd010cd0.545ee","type":"ui_button","z":"bcc0b3a.aa2e95","name":"","group":"7b72899.38e6578","order":24,"width":3,"height":1,"passthru":false,"label":"Test","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"test\":true}","payloadType":"json","topic":"","x":100,"y":460,"wires":[["ccf04bf7.2562c8"]]},{"id":"846c0c66.0ca12","type":"ui_button","z":"9693d392.5f9c5","name":"","group":"9b16ec6a.5908a","order":7,"width":2,"height":1,"passthru":false,"label":"Get Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"","x":890,"y":40,"wires":[["650f3657.e66cd8"]]},{"id":"c3dade2.beea92","type":"ui_button","z":"9693d392.5f9c5","name":"","group":"9b16ec6a.5908a","order":4,"width":1,"height":1,"passthru":false,"label":"Center","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":470,"y":440,"wires":[["6b7bc43.587eb3c"]]},{"id":"c6f59b4a.d34b68","type":"ui_button","z":"9693d392.5f9c5","name":"","group":"9b16ec6a.5908a","order":20,"width":2,"height":1,"passthru":false,"label":"Gen Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":90,"y":500,"wires":[["c9741a40.5904b8"]]},{"id":"a4b761c8.c88dc","type":"ui_button","z":"9693d392.5f9c5","name":"","group":"9b16ec6a.5908a","order":22,"width":2,"height":1,"passthru":false,"label":"Add Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"id\":\"1599796800_20179116\",\"status\":\"Succeeded\",\"start\":1599816979116,\"folder\":\"1599816979104\",\"swLat\":47.576553,\"swLon\":3.3840909,\"neLat\":50.16917,\"neLon\":5.8905783,\"nickname\":\"NodeRED_Ref 49.087126542584954-3.9402723312377934\",\"exPercent\":0,\"flag\":false,\"hadoopId\":\"1591579541500_1159378\",\"ready\":true,\"rtStatus\":\"Succeeded\",\"statusCode\":20}","payloadType":"json","topic":"","x":90,"y":540,"wires":[["c3458231.5a736"]]},{"id":"6674bdf9.4139b4","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":9,"width":6,"height":1,"name":"","label":"Last Dimensions","format":"","layout":"col-center","x":740,"y":140,"wires":[]},{"id":"f6a3d7ae.d91fe8","type":"ui_text","z":"5fa738eb.f40408","group":"7f6d1bbc.b842f4","order":2,"width":2,"height":1,"name":"","label":"Layers","format":"","layout":"row-left","x":710,"y":100,"wires":[]},{"id":"8e74ee3d.b9238","type":"ui_text","z":"5fa738eb.f40408","group":"7f6d1bbc.b842f4","order":6,"width":2,"height":1,"name":"","label":"Add","format":"","layout":"row-spread","x":710,"y":140,"wires":[]},{"id":"e9698323.93a47","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":11,"width":2,"height":1,"name":"Map Lat","label":"Lat","format":"{{msg.mousePos.lat | number:3}}","layout":"row-left","x":840,"y":200,"wires":[]},{"id":"3b470eb9.795912","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":12,"width":2,"height":1,"name":"Map Lng","label":"Lng","format":"{{msg.mousePos.lng | number:3}}","layout":"row-left","x":980,"y":200,"wires":[]},{"id":"409db326.26118c","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":6,"width":2,"height":1,"name":"Point Lng","label":"Lng","format":"{{msg.dimChange.pos.lng | number:5}}","layout":"row-left","x":880,"y":60,"wires":[]},{"id":"b5c7e99c.850c08","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":5,"width":2,"height":1,"name":"Point Lat","label":"Lat","format":" {{msg.dimChange.pos.lat | number:5}}","layout":"row-left","x":720,"y":60,"wires":[]},{"id":"7a75ad1e.e4a494","type":"ui_text","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","order":10,"width":2,"height":1,"name":"","label":"zoom","format":"{{msg.dimChange.z | number:0}}","layout":"row-left","x":710,"y":200,"wires":[]},{"id":"6c75e348.230a1c","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":10,"width":4,"height":1,"name":"","label":"Map Center","format":"","layout":"row-right","x":870,"y":120,"wires":[]},{"id":"4c6564b5.7dde7c","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":12,"width":2,"height":1,"name":"","label":"Lng","format":"{{msg.dimChange.pos.lng | number:5}}","layout":"row-left","x":850,"y":240,"wires":[]},{"id":"679ba08f.aed32","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":11,"width":2,"height":1,"name":"","label":"Lat","format":" {{msg.dimChange.pos.lat | number:5}}","layout":"row-left","x":850,"y":200,"wires":[]},{"id":"2f71c409.eeb9dc","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":13,"width":2,"height":1,"name":"","label":"Zoom","format":"{{msg.dimChange.z | number:0}}","layout":"row-left","x":850,"y":160,"wires":[]},{"id":"332e24f8.5599ec","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":1,"width":1,"height":1,"name":"Ref Point","label":"Ref Point","format":"","layout":"row-right","x":740,"y":40,"wires":[]},{"id":"cf4aaa8f.18bb98","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":3,"width":2,"height":1,"name":"Ref Lng","label":"Lng","format":"{{msg.mousePos.lng | number:5}}","layout":"col-center","x":880,"y":80,"wires":[]},{"id":"3392ed2d.06e162","type":"ui_text","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","order":2,"width":2,"height":1,"name":"Ref Lat","label":"Lat","format":"{{msg.mousePos.lat | number:5}}","layout":"col-center","x":740,"y":80,"wires":[]},{"id":"cfd5937e.c4e3d","type":"ui_switch","z":"9693d392.5f9c5","name":"Show Popul","label":"Show","tooltip":"","group":"9b16ec6a.5908a","order":19,"width":1,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":510,"y":340,"wires":[["c4a2ff77.9fd0d"]]},{"id":"7c701a1d.cd09b4","type":"ui_switch","z":"9693d392.5f9c5","name":"Show Nitro","label":"Show","tooltip":"","group":"9b16ec6a.5908a","order":17,"width":1,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":510,"y":380,"wires":[["50ca1cf4.6f4c34"]]},{"id":"af311839.7a6008","type":"ui_switch","z":"bcc0b3a.aa2e95","name":"Switch Nitro","label":"","tooltip":"","group":"7b72899.38e6578","order":20,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":490,"y":320,"wires":[["7e058a37.4c40e4"]]},{"id":"5ac51713.ae3458","type":"ui_switch","z":"bcc0b3a.aa2e95","name":"Switch popul","label":"","tooltip":"","group":"7b72899.38e6578","order":22,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":490,"y":380,"wires":[["bcb220bc.4a16f"]]},{"id":"a74092a5.c28e3","type":"ui_slider","z":"bcc0b3a.aa2e95","name":"","label":"Nitro Opacity","tooltip":"","group":"7b72899.38e6578","order":19,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":110,"y":320,"wires":[["5892bfc2.7b592"]]},{"id":"3f0be585.dd31ca","type":"ui_slider","z":"9693d392.5f9c5","name":"","label":"Nitro Opacity","tooltip":"","group":"9b16ec6a.5908a","order":18,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":130,"y":380,"wires":[["d1ae3e12.2fd0c"]]},{"id":"dd97bc8b.db774","type":"ui_slider","z":"9693d392.5f9c5","name":"","label":"Popul Opacity","tooltip":"","group":"9b16ec6a.5908a","order":16,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":140,"y":340,"wires":[["6f0e6b8.7cfdf94"]]},{"id":"47b09b4b.11b5d4","type":"ui_slider","z":"bcc0b3a.aa2e95","name":"","label":"Popul Opacity","tooltip":"","group":"7b72899.38e6578","order":21,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":120,"y":380,"wires":[["9cb4bf43.e8401"]]},{"id":"2943c3a3.b4661c","type":"ui_template","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","name":"OpenStreetMap","order":2,"width":12,"height":6,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n    (function() {\n\n        const cScope = this.scope;\n        setTimeout(function () {\n            const mapid='osmapid'\n\n        \tconst map = L.map(mapid).setView([48.204550, 16.364333], 13);\n\n            //const urlPattern='https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png'\n            const urlPattern='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n            \n        \tosmLayer=L.tileLayer(urlPattern,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]})\n        \tosmLayer.addTo(map);\n        \t\n        \taddMapClick(cScope,map,mapid,{OSM:osmLayer})\n        \t\n        \taddMapWatch(cScope,map,mapid)\n\n            setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n        }, 300);\n    })();\n</script>\n\n<div id=\"osmapid\" style=\"width: 100%; height: 400px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":120,"y":80,"wires":[["11c5fda9.fc47f2"]]},{"id":"ccf04bf7.2562c8","type":"ui_template","z":"bcc0b3a.aa2e95","group":"7b72899.38e6578","name":"PAIRS","order":16,"width":12,"height":6,"format":"<script>\n(function() {\n    const cScope = this.scope;\n    \n    setTimeout(function () {\n        const mapid='pairsmapid'\n        \n        initPAIRS(L)\n        \n        nitroLayer=newPAIRSLayer(L,'geoserver1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n\n        populLayer=newPAIRSLayer(L,'geoserver06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n        \n        var overlayMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n\n        const map=createOSMMap(L,mapid,overlayMaps)\n\n    \taddMapClick(cScope,map,mapid)\n    \t\n        addMapWatch(cScope,map,mapid,overlayMaps,function(msg){\n            if(\"test\" in msg.payload) {\n                console.log(\"Test called: \",msg.payload.test)\n                console.log(\"Opacity: \",osmLayer.opacity)\n            }\n        })\n\n        setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"pairsmapid\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":110,"y":140,"wires":[["11c5fda9.fc47f2"]]},{"id":"64992102.f11e5","type":"ui_template","z":"5fa738eb.f40408","group":"7f6d1bbc.b842f4","name":"MapWidget","order":1,"width":12,"height":6,"format":"<!--\n<div ng-bind-html=\"msg.payload | trusted\"></div>\n-->\n<iframe src=\"../osmbase\" height=300px ></iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":730,"y":60,"wires":[[]]},{"id":"ec8a5e89.da364","type":"ui_template","z":"21c2f37a.1907fc","group":"d081afdb.7b153","name":"PAIRS","order":0,"width":"16","height":"7","format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n(function() {\n    const cScope = this.scope;\n\n    const PAIRS_HOST='pairs.res.ibm.com'\n    const PAIRS_PORT=8080\n    const auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\n    const EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\n\n\n    setTimeout(function () {\n        pairsFuncs= {\n            setPairsData: function(seqId,minColor,maxColor,colorTableId,layerName) {\n                console.log('Setting pairs data to ',seqId,minColor,maxColor,colorTableId,layerName)\n                this.seqId=seqId\n                this.minColor=minColor\n                this.maxColor=maxColor\n                this.colorTableId=colorTableId\n                this.layerName=layerName\n            },\n            makePairsURL: function(z,x,y,seqId,minColor,maxColor,colorTableId,layerName) {\n                const proj='EPSG:3857'\n                const imageFormat='png'\n                const wpels=256\n                const hpels=256\n                \n                //console.log('Get PAIRS tile for coords zoom=',z,' x=',x,' y=',y)\n                    \n                EPSG_3857=[20026376.39,20048966.10]\n                \n                zpow=2**z/2\n                \n                bbox_l=(x-zpow)*EPSG_3857[0]/zpow\n                bbox_t=(zpow-y-1)*EPSG_3857[1]/zpow\n                bbox_r=(x-zpow+1)*EPSG_3857[0]/zpow\n                bbox_b=(zpow-y)*EPSG_3857[1]/zpow\n                var baseURL=`https://${PAIRS_HOST}:${PAIRS_PORT}/geoserver${seqId}/pairs/wms?service=WMS&version=1.3.0&request=GetMap&format=image/${imageFormat}&transparent=true&transitionEffect=resize&width=${wpels}&height=${hpels}&crs=${proj}&styles=&bbox=${bbox_l},${bbox_t},${bbox_r},${bbox_b}`\n                \n                var sld=`https://${PAIRS_HOST}:443/map/sld?type=raster&min=${minColor}&max=${maxColor}&colorTableId=${colorTableId}&no_data=-1&property=value&layer=pairs:${layerName}`\n                \n                sldEnc=encodeURIComponent(sld)\n                var fullURL=`${baseURL}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`\n                \n                //var fullURL=`${baseURL}&layers=${layerName}&authorization=${auth}`\n        \n                return fullURL\n            },\n            getTileUrl: function(coords) {\n                //console.log('Get PAIRS tile for coords ',coords)\n\n                return this.makePairsURL(coords['z'],coords['x'],coords['y'],this.seqId,this.minColor,this.maxColor,this.colorTableId,this.layerName)\n            }\n        }\n        \n        L.TileLayer.Pairs = L.TileLayer.extend(pairsFuncs)\n        \n        nitroLayer=new L.TileLayer.Pairs()\n        nitroLayer.setPairsData('1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n        //nitroLayer.addTo(map)\n        \n        populLayer=new L.TileLayer.Pairs()\n        populLayer.setPairsData('06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n        //populLayer.addTo(map)\n        \n    \tconst map = L.map('pairsmapid2',{\n    \t    center: [48.204550, 16.364333],\n    \t    zoom: 4,\n    \t    layers: [nitroLayer,populLayer]\n    \t})\n    \t\n    \tvar baseMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n\n        var overlayMaps = {\n            //\"Cities\": cities\n        }\n    \tL.control.layers(baseMaps, overlayMaps).addTo(map);\n    \t\n        let marker\n    \tmap.on('click', function(e) {\n            cScope.send(e.latlng);\n            if (marker) {\n                map.removeLayer(marker);\n            };\n            marker = L.circleMarker(e.latlng).addTo(map);\n        });\n            \n        setTimeout(function () {\n            map.invalidateSize();\n        }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"pairsmapid2\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":320,"y":240,"wires":[[]]},{"id":"6faf65d0.090d7c","type":"ui_template","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","name":"OpenStreetMap","order":8,"width":12,"height":8,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n    (function() {\n\n        const cScope = this.scope;\n        setTimeout(function () {\n            const mapid='osmapid'\n\n        \t//const map = L.map(mapid).setView([48.204550, 16.364333], 13);\n        \tconst map = L.map(mapid)\n\n            //const urlPattern='https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png'\n            const urlPattern='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n            \n        \tosmLayer=L.tileLayer(urlPattern,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]})\n        \tosmLayer.addTo(map);\n\n        \taddMapClick(cScope,map,mapid,{OSM:osmLayer})\n        \t\n        \taddMapWatch(cScope,map,mapid)\n\n            setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n        }, 300);\n    })();\n</script>\n\n<div id=\"osmapid\" style=\"width: 100%; height: 400px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":120,"y":140,"wires":[["37da7715.c59298"]]},{"id":"56789bab.654a24","type":"ui_template","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","name":"PAIRS Map","order":15,"width":12,"height":7,"format":"<script>\n(function() {\n    const cScope = this.scope;\n    \n    const PAIRS_HOST='pairs.res.ibm.com'\n    const PAIRS_PORT=8080\n    const auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\n    // ESPG bounding box coordinates\n    const EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\n\n    setTimeout(function () {\n        const mapid='vitimapid'\n\n        initPAIRS(L)\n\n        nitroLayer=newPAIRSLayer(L,'geoserver1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n        populLayer=newPAIRSLayer(L,'geoserver06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n\n        var overlayMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n        \n        const map=createOSMMap(L,mapid,overlayMaps)\n        \n    \taddMapClick(cScope,map,mapid)\n    \t\n        addMapWatch(cScope,map,mapid,overlayMaps,function(payload){\n            if('addLayers' in payload) {\n                wmsLayers=payload.addLayers\n                console.log('Adding WMS layers from ',wmsLayers)\n                wmsOverlays={}\n                \n                wmsLayers.forEach(function(layer) {\n                    wmsOverlays[layer.datalayer]=newPAIRSLayer(L,layer.geoserverUrl,layer.min,layer.max,layer.colorTableId,layer.name)\n                })\n                \n                console.log(\"Adding WMS overlays \",wmsOverlays)\n                L.control.layers(null, wmsOverlays).addTo(map);\n                \n            } else {\n                console.log('Unhandled message payload',payload)\n            }\n        })\n\n        setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"vitimapid\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":110,"y":200,"wires":[["37da7715.c59298"]]},{"id":"9552e9fd.8b2898","type":"ui_template","z":"9693d392.5f9c5","group":"9b16ec6a.5908a","name":"LayersList","order":9,"width":12,"height":7,"format":"<!--\n<svg viewBox=\"0 0 200 200\"><path d=\"M100 100 L100 0 A100 100 0 0 1 187 50 Z\" style=\"fill: rgba(255, 0, 0, 0); background: rgba(255, 0, 0, 0);\"></path><path d=\"M100 100 L187 50 A100 100 0 0 1 187 150 Z\" style=\"fill: rgba(255, 0, 0, 0.168627); background: rgba(255, 0, 0, 0.168627);\"></path><path d=\"M100 100 L187 150 A100 100 0 0 1 100 200 Z\" style=\"fill: rgba(255, 0, 0, 0.329412); background: rgba(255, 0, 0, 0.329412);\"></path><path d=\"M100 100 L100 200 A100 100 0 0 1 14 150 Z\" style=\"fill: rgba(255, 0, 0, 0.498039); background: rgba(255, 0, 0, 0.498039);\"></path><path d=\"M100 100 L14 150 A100 100 0 0 1 14 50 Z\" style=\"fill: rgba(255, 0, 0, 0.670588); background: rgba(255, 0, 0, 0.670588);\"></path><path d=\"M100 100 L14 50 A100 100 0 0 1 100 0 Z\" style=\"fill: rgba(255, 0, 0, 0.831373); background: rgba(255, 0, 0, 0.831373);\"></path></svg>\n-->\n<div id=\"{{'my_'+$id}}\" style=\"{{'color:'+theme.base_color}}\"></div>\n\n<script>\n/* Generate HTML code to display layers list or text\n*/\nfunction genLayersHTML(layers) {\n    var lat\n    var lng\n    \n    // first group all the layers by layer ID and flatten Min-Mean-Max\n    let layersFlat=layers.reduce(function(acc,layer) {\n      if(!(layer.layerId in acc)) {\n      \tacc[layer.layerId]={name: layer.layerName, id:layer.layerId, dataset: layer.dataset}\n      }\n      lat=layer.latitude\n      lng=layer.longitude\n      acc[layer.layerId][layer.aggregation]=parseFloat(layer.value)\n      return acc\n    },{})\n    \n    console.log(layersFlat)\n    console.log(Object.keys(layersFlat))\n    \n    return `Lat: ${lat} Lng: ${lng}<BR>`+Object.keys(layersFlat).map(function(layerId) {\n        layer=layersFlat[layerId]\n        console.log(layer)\n        return `<tr><td>${layer.name}</td><td>${layer.Min.toFixed(2)}</td><td>${layer.Mean.toFixed(2)}</td><td>${layer.Max.toFixed(2)}</td><td> <input type=\"range\" min=\"${layer.Min}\" value=\"${layer.Mean}\" max=\"${layer.Max}\" class=\"slider\" id=\"layer_${layer.layerId}\"></td></tr>`\n    }).join('')\n}\n\n/* Just sets the div's HTML content*/\nfunction setHTML(scope,html) {\n    $(\"#my_\"+scope.$id).html(html)\n}\n\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    if (msg && 'payload' in msg) {\n      // Do something when msg arrives\n      if('data' in msg.payload) {\n        layerList=genLayersHTML(msg.payload.data)\n        setHTML(scope,`<table style=\"color:green;line-height: 80%;\">${layerList}</table>`);\n      } else if('text' in msg.payload) {\n        setHTML(scope,`${msg.payload.text}`)\n      } else if('progress' in msg.payload) {\n        setHTML(scope,'...')\n      } else {\n        setHTML(scope,`Unknown payload keys=${Object.keys(msg.payload)}`)\n      }\n    } else {\n        setHTML(scope,`No payload in msg keys=${Object.keys(msg)}`)\n    }\n  });\n})(scope);\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":910,"y":300,"wires":[[]]},{"id":"459d721b.05ee7c","type":"ui_template","z":"a18853ad.01b3c","group":"eef6288d.b053f8","name":"Bootstrap Page","order":0,"width":0,"height":0,"format":"<!--<div ng-bind-html=\"msg.payload\"></div>-->\n<style type=\"text/css\">\n\ndiv#colonne1 {\n\tfloat: left;\n\twidth: 160px;\n\tmargin-right: 10px;\n\tpadding: 1px 0;\n\tbackground: lightblue;\n}\ndiv#colonne2 {\n\tfloat: left;\n\twidth: 220px;\n\tmargin-left: 0px;\n\tpadding: 0px 0;\n\tbackground: lightblue;\n}\ndiv#map {\n\toverflow: hidden;\n\tpadding: 1px 20px;\n\tmargin-left: 10px;\n\tbackground: burlywood;\n}\n#ex16c .slider-selection {\n\tbackground: red;\n}\n</style>\n\n\n<div>\n\t<h2>Slider test page</h2>\n\t<p>Code from <a href=\"http://seiyria.com/bootstrap-slider\" target=\"_blank\">http://seiyria.com/bootstrap-slider</a></p>\n\t\n\t<div id=\"colonne1\">\n    \t<h4>Criteria</h4>\n    \t<input type=\"checkbox\" id=\"humidity\" checked=\"checked\" />&nbsp;&nbsp;Ground humidity <br><br>\n        <input type=\"checkbox\" id=\"temperature\" checked=\"checked\" />&nbsp;&nbsp;Temp&eacute;rature <br><br>\n        <input type=\"checkbox\" id=\"sunshine\" checked=\"checked\" />&nbsp;&nbsp;Sunshine (%)<br><br>\n        <input type=\"checkbox\" id=\"Soil\" checked=\"checked\" />&nbsp;&nbsp;Soil quality<br><br>\n\t</div><!-- fin de div#colonne1 -->\n\t\n\t<div id=\"colonne2\">\n    \t<h4>Adjustment</h4>\n    \t<input id=\"ex16a\" type=\"text\"/><br/><br/>\n        <input id=\"ex16b\" type=\"text\"/><br/><br/>\n     \t<input id=\"ex16c\" type=\"text\"/><br/><br/>\n      \t<input id=\"ex16d\" type=\"text\"\n            data-provide=\"slider\"\n            data-slider-ticks=\"[1, 2, 3]\"\n            data-slider-ticks-labels='[\"Low\", \"medium\", \"Intense\"]'\n            data-slider-min=\"1\"\n            data-slider-max=\"3\"\n            data-slider-step=\"1\"\n            data-slider-value=\"3\"\n            data-slider-tooltip=\"hide\" /><br/><br/>\n        <input id=\"ex16e\" type=\"text\" /><br/><br/>\n\t</div><!-- fin de div#colonne2 -->\n\t\n\t<div id=\"map\" style='margin-left:2rem;'>\n\t\t<h4>result map</h4>\n\t\t <img src=\"data:image/jpeg;base64,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\">\n\t</div><!-- fin de div#centre -->\n\t\n    <script src=\"https://code.jquery.com/jquery-3.2.1.slim.min.js\" integrity=\"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js\" integrity=\"sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js\" integrity=\"sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js\" integrity=\"sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA==\" crossorigin=\"anonymous\"></script>\n    <script type=\"text/javascript\">\n        var sliderA = new Slider(\"#ex16a\", { min: 0, max: 10, value: 5, focus: true });\n        var sliderB = new Slider(\"#ex16b\", { min: 0, max: 10, value: [4, 6], focus: true });\n        var sliderC = new Slider(\"#ex16c\", { min: 0, max: 100, value: 70, focus: true });\n        var sliderE = new Slider(\"#ex16e\", { min: 1, max: 3, step:1, value: 3, focus: true, ticks: [1,2,3], ticks_labels: [\"Low\", \"medium\", \"Intense\"]});\n    </script>\n\n</div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":180,"y":280,"wires":[[]]},{"id":"9d1d0909.e19828","type":"ui_template","z":"a18853ad.01b3c","group":"eef6288d.b053f8","name":"Bootstrap HEAD","order":1,"width":0,"height":0,"format":"<!-- Load bootstrap CSS -->\n<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\" integrity=\"sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm\" crossorigin=\"anonymous\">\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css\" integrity=\"sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ==\" crossorigin=\"anonymous\" />\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"global","x":180,"y":220,"wires":[[]]},{"id":"bd7e0ce6.e9f2b","type":"ui_text_input","z":"9693d392.5f9c5","name":"Ref Lat","label":"Lat","tooltip":"","group":"9b16ec6a.5908a","order":5,"width":2,"height":1,"passthru":false,"mode":"text","delay":300,"topic":"","x":580,"y":40,"wires":[[]]},{"id":"6ac52f7f.1215b","type":"ui_text_input","z":"9693d392.5f9c5","name":"Ref Lng","label":"Lng","tooltip":"","group":"9b16ec6a.5908a","order":6,"width":2,"height":1,"passthru":false,"mode":"text","delay":300,"topic":"","x":580,"y":80,"wires":[[]]},{"id":"627c085a.b13dd8","type":"subflow:3aa70edc.b22322","z":"5fed8ae7.8bb5a4","name":"Query color map","env":[],"x":490,"y":640,"wires":[["2704965f.c8c6fa"],["a83e9bae.8c9a68"],["8f1f4081.886b1"]]},{"id":"dc4aae9a.dbb9f","type":"function","z":"3aa70edc.b22322","name":"Format URL & save data","func":"msg.name = msg.payload.name; \n\nif ( msg.payload.colorTableId) {\n    msg.colorTableId = msg.payload.colorTableId; \n    msg.payload = \"sld?type=raster&min=\" + msg.payload.min + \"&max=\" + msg.payload.max + \"&colorTableId=\" + msg.colorTableId + \"&no_data=-1\"\n\n} else {\n    msg.colorTableId = 4\n    msg.payload = \"sld?type=raster&min=\" + msg.payload.min + \"&max=\" + msg.payload.max + \"&colorTableId=\" + msg.colorTableId + \"&no_data=-1\"\n\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":220,"wires":[["38c775d2.44a38a"]]},{"id":"e23f2ca9.c543b","type":"xml","z":"3aa70edc.b22322","name":"","property":"payload","attr":"","chr":"","x":530,"y":300,"wires":[["44dd28e1.7f76b8"]],"info":"Convert XML result to an object"},{"id":"44dd28e1.7f76b8","type":"change","z":"3aa70edc.b22322","name":"get colorMap","rules":[{"t":"set","p":"payload.colorTableId","pt":"msg","to":"colorTableId","tot":"msg"},{"t":"move","p":"payload.sld:StyledLayerDescriptor.sld:NamedLayer[0].sld:UserStyle[0].sld:FeatureTypeStyle[0].sld:Rule[0].sld:RasterSymbolizer[0].sld:ColorMap[0].sld:ColorMapEntry","pt":"msg","to":"payload.colorMap","tot":"msg"},{"t":"set","p":"payload.name","pt":"msg","to":"name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":300,"wires":[["1c3a2a7d.41e506"]],"info":"Get the array of color from the object result"},{"id":"7231e4fa.613cfc","type":"split","z":"3aa70edc.b22322","name":"Get ColorMapId for each layer","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"payload.layer","x":370,"y":220,"wires":[["dc4aae9a.dbb9f"]],"info":"Split result to make an action per layer"},{"id":"3523cf98.89d7d","type":"change","z":"3aa70edc.b22322","name":"save layers","rules":[{"t":"set","p":"layers","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":220,"wires":[["7231e4fa.613cfc"]]},{"id":"1c3a2a7d.41e506","type":"join","z":"3aa70edc.b22322","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":"false","timeout":"","count":"","reduceRight":false,"x":770,"y":300,"wires":[["c8312c14.c31e"]]},{"id":"1d1ae444.99db7c","type":"batch","z":"3aa70edc.b22322","name":"","mode":"interval","count":10,"overlap":0,"interval":"10","allowEmptySequence":false,"topics":[],"x":430,"y":300,"wires":[["e23f2ca9.c543b"]],"info":"Creates a batch to be able to use the join flow"},{"id":"cfce9bd3.401138","type":"subflow:22be0357.6ef6fc","z":"3aa70edc.b22322","name":"Query Job Layers","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"},{"name":"urlSuffix","value":"/layers","type":"str"}],"x":190,"y":120,"wires":[["3523cf98.89d7d","82e5589e.f08648"],[],[]]},{"id":"44611078.c536c","type":"change","z":"a15ea8b9.f75a28","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":140,"wires":[[]]},{"id":"d05133e4.26615","type":"delay","z":"a15ea8b9.f75a28","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":280,"wires":[[]]},{"id":"b8684da8.b7a4e","type":"change","z":"a15ea8b9.f75a28","name":"setDelay","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":280,"wires":[["d05133e4.26615"]]},{"id":"5d87971e.94ea08","type":"template","z":"a15ea8b9.f75a28","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"VitXplore_{{payload.aoi.name}}_[{{payload.pos.lat}};{{payload.pos.lng}}]_[{{payload.startDay}}/{{payload.endDay}}]\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \n            \"alias\": \"Mean_{{id}}\",\n            \"type\": \"raster\",\n            \"aggregation\": \"Mean\",\n            {{#low}}\n            {{#up}}\n            \"output\":\"false\",\n            {{/up}}\n            {{/low}}\n            \"id\": \"{{id}}\",\n            \"type\": \"raster\"\n        },\n    {{/payload.layers}}\n        {\n            \"alias\": \"scoring\",\n            \"expression\": \"{{payload.udf}}\",\n        }\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": {{payload.aoi.id}}\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":280,"y":20,"wires":[["137fcb7e.509335"]]},{"id":"137fcb7e.509335","type":"function","z":"a15ea8b9.f75a28","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":20,"wires":[["d3e7b53a.6bb488"]]},{"id":"d3e7b53a.6bb488","type":"json","z":"a15ea8b9.f75a28","name":"","property":"payload","action":"obj","pretty":false,"x":430,"y":80,"wires":[["f82ca1ae.424aa"]]},{"id":"653791b0.25ba5","type":"switch","z":"a15ea8b9.f75a28","name":"Test Status","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Initializing","vt":"str"},{"t":"eq","v":"Queued","vt":"str"},{"t":"eq","v":"Running","vt":"str"},{"t":"eq","v":"Writing","vt":"str"},{"t":"eq","v":"Succeeded","vt":"str"},{"t":"eq","v":"Failed","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":170,"y":440,"wires":[["54bbd87d.19b778"],["54bbd87d.19b778"],["54bbd87d.19b778"],["54bbd87d.19b778"],[],[],[]]},{"id":"54bbd87d.19b778","type":"change","z":"a15ea8b9.f75a28","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":340,"wires":[["b8684da8.b7a4e"]]},{"id":"aa8f0cf6.29a0d","type":"switch","z":"a15ea8b9.f75a28","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"id","vt":"str"},{"t":"hask","v":"name","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":130,"y":80,"wires":[["44611078.c536c"],[],["5d87971e.94ea08"]]},{"id":"f82ca1ae.424aa","type":"function","z":"a15ea8b9.f75a28","name":"FixHTMLEntities","func":"msg.payload.layers=msg.payload.layers.map(function(layer) {\n    if('expression' in layer) {\n        layer.expression=layer.expression.replace(/&gt;/g,'>')\n        layer.expression=layer.expression.replace(/&lt;/g,'<')\n        layer.expression=layer.expression.replace(/&#x3D;/g,'=')\n        layer.expression=layer.expression.replace(/&amp;/g,'&')\n    }\n    return layer\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":80,"wires":[[]]},{"id":"a48b6e69.2a126","type":"template","z":"a15ea8b9.f75a28","name":"temlpate gives FailedConversion somehow....","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"VitXplore_{{payload.aoi.name}}_[{{payload.pos.lat}};{{payload.pos.lng}}]_[{{payload.startDay}}/{{payload.endDay}}]\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \n            \"alias\": \"Mean_{{id}}\",\n            \"type\": \"raster\",\n            \"aggregation\": \"Mean\",\n            {{#low}}\n            {{#up}}\n            \"output\":\"false\",\n            {{/up}}\n            {{/low}}\n            \"id\": \"{{id}}\",\n            \"type\": \"raster\"\n        },\n    {{/payload.layers}}\n        {\n            \"alias\": \"{{payload.aoi.name}} vs [{{payload.pos.lat}};{{payload.pos.lng}}] [{{payload.startDay}}/{{payload.endDay}}]\",\n            \"id\": \"0\",\n            \"expression\": \"{{payload.udf}}\",\n        }\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": {{payload.aoi.id}}\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":850,"y":20,"wires":[[]]},{"id":"b6a05ef.a204fa","type":"debug","z":"a15ea8b9.f75a28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":650,"y":540,"wires":[]},{"id":"618b427e.bb241c","type":"http request","z":"8fba2998.b92f08","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":490,"y":300,"wires":[["1bb33fa1.10779"]]},{"id":"f9d4ee2f.d210a","type":"change","z":"8fba2998.b92f08","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":80,"wires":[["4fc88e26.735e"]]},{"id":"efdcc8ef.167488","type":"switch","z":"8fba2998.b92f08","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"POST","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":150,"y":100,"wires":[["f9d4ee2f.d210a"],["7a579e49.78fa"]]},{"id":"b1f2d150.44069","type":"change","z":"8fba2998.b92f08","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":140,"wires":[["4fc88e26.735e"]]},{"id":"7a579e49.78fa","type":"switch","z":"8fba2998.b92f08","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":120,"wires":[["f9d4ee2f.d210a"],["b1f2d150.44069"]]},{"id":"1bb33fa1.10779","type":"switch","z":"8fba2998.b92f08","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":300,"wires":[[],[]],"outputLabels":["ok","error"]},{"id":"4fc88e26.735e","type":"change","z":"8fba2998.b92f08","name":"AuthHeaders","rules":[{"t":"set","p":"headers","pt":"msg","to":"{\t  \"Authorization\":\t    \"Basic \" & $base64encode(\t       $globalContext(\"PAIRS\").user &\t':' & $globalContext(\"PAIRS\").apikey),\t\"Content-Type\" : \"application/json\",\t\"Accept\": \"application/json\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":100,"wires":[["618b427e.bb241c"]]},{"id":"bc7ded6a.a2598","type":"inject","z":"8fba2998.b92f08","name":"Init PAIRS Cred","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\t   \"user\":$env(\"PAIRS_USER\"),\t   \"apikey\": $env(\"PAIRS_APIKEY\")\t}","payloadType":"jsonata","x":150,"y":420,"wires":[["43183162.173f8"]]},{"id":"43183162.173f8","type":"change","z":"8fba2998.b92f08","name":"","rules":[{"t":"set","p":"PAIRS","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":380,"wires":[[]]},{"id":"38c775d2.44a38a","type":"subflow:8fba2998.b92f08","z":"3aa70edc.b22322","name":"Get ColorMap","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/map/","type":"str"}],"x":210,"y":320,"wires":[["1d1ae444.99db7c"],[],[]]},{"id":"60920ec3.6fcd9","type":"http in","z":"77ddf49d.9315dc","name":"plugin","url":"/leaflet/plugin/:filename","method":"get","upload":false,"swaggerDoc":"","x":110,"y":460,"wires":[["9740a6b1.b07d88"]]},{"id":"54b6ed23.7ecb44","type":"http response","z":"77ddf49d.9315dc","name":"","statusCode":"","headers":{"content-type":"text/css"},"x":510,"y":460,"wires":[]},{"id":"9b55f35f.46bf8","type":"change","z":"77ddf49d.9315dc","name":"css","rules":[{"t":"set","p":"payload","pt":"msg","to":"input[type=range]{-webkit-appearance:none;-webkit-tap-highlight-color:rgba(255,255,255,0);width:110px;height:10px;margin:0;border:none;padding:1px 2px;border-radius:30px;background:#F1F0EE;outline:0}input[type=range]::-ms-track{border:inherit;color:transparent;background:0 0}input[type=range]::-ms-fill-lower,input[type=range]::-ms-fill-upper{background:0 0}input[type=range]::-ms-tooltip{display:none}input[type=range]::-ms-thumb{width:15px;height:18px;border-radius:12px;border:0;background-image:linear-gradient(to bottom,#1253A4 0,#1253A4 100%)}.leaflet-control-layers-label{margin:0 0 8px 1px}","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":460,"wires":[["54b6ed23.7ecb44"]]},{"id":"9740a6b1.b07d88","type":"switch","z":"77ddf49d.9315dc","name":"","property":"req.params.filename","propertyType":"msg","rules":[{"t":"eq","v":"L.Control.Opacity.css","vt":"str"},{"t":"eq","v":"L.Control.Opacity.js","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":500,"wires":[["9b55f35f.46bf8"],["4d34e282.f62d9c"]],"inputLabels":["filename"],"outputLabels":["css","js"]},{"id":"4d34e282.f62d9c","type":"change","z":"77ddf49d.9315dc","name":"js","rules":[{"t":"set","p":"payload","pt":"msg","to":"L.Control.Opacity=L.Control.extend({options:{collapsed:!1,position:\"topright\",label:null},initialize:function(t,e){for(var i in L.Util.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._container},expand:function(){L.DomUtil.addClass(this._container,\"leaflet-control-layers-expanded\"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(L.DomUtil.addClass(this._form,\"leaflet-control-layers-scrollbar\"),this._form.style.height=t+\"px\"):L.DomUtil.removeClass(this._form,\"leaflet-control-layers-scrollbar\"),this},collapse:function(){return L.DomUtil.removeClass(this._container,\"leaflet-control-layers-expanded\"),this},_initLayout:function(){var t=\"leaflet-control-layers\",e=this._container=L.DomUtil.create(\"div\",t),i=this.options.collapsed;if(e.setAttribute(\"aria-haspopup\",!0),L.DomEvent.disableClickPropagation(e),L.DomEvent.disableScrollPropagation(e),this.options.label){var a=L.DomUtil.create(\"p\",t+\"-label\");a.innerHTML=this.options.label,e.appendChild(a)}var s=this._form=L.DomUtil.create(\"form\",t+\"-list\");i&&(this._map.on(\"click\",this.collapse,this),L.Browser.android||L.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var l=this._layersLink=L.DomUtil.create(\"a\",t+\"-toggle\",e);l.href=\"#\",l.title=\"Layers\",L.Browser.touch?(L.DomEvent.on(l,\"click\",L.DomEvent.stop),L.DomEvent.on(l,\"click\",this.expand,this)):L.DomEvent.on(l,\"focus\",this.expand,this),i||this.expand(),this._baseLayersList=L.DomUtil.create(\"div\",t+\"-base\",s),this._separator=L.DomUtil.create(\"div\",t+\"-separator\",s),this._overlaysList=L.DomUtil.create(\"div\",t+\"-overlays\",s),e.appendChild(s)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&L.Util.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._layers.push({layer:t,name:e,overlay:i})},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList),this._layerControlInputs=[];var t,e,i,a,s=0;for(i=0;i<this._layers.length;i++)a=this._layers[i],this._addItem(a),e=e||a.overlay,t=t||!a.overlay,s+=a.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?\"\":\"none\"),this._separator.style.display=e&&t?\"\":\"none\",this},_addItem:function(t){var e,i=document.createElement(\"label\");t.overlay?((e=document.createElement(\"input\")).type=\"range\",e.className=\"leaflet-control-layers-range\",e.min=0,e.max=100,e.value=100):e=this._createRadioElement(\"leaflet-base-layers\",checked),this._layerControlInputs.push(e),e.layerId=L.Util.stamp(t.layer),L.DomEvent.on(e,\"click\",this._onInputClick,this),L.DomEvent.on(e,\"touchend\",this._onInputClick,this);var a=document.createElement(\"span\");a.innerHTML=\" \"+t.name;var s=document.createElement(\"div\"),l=document.createElement(\"div\");return i.appendChild(s),s.appendChild(a),i.appendChild(l),l.appendChild(e),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),i},_onInputClick:function(){var t,e,i=this._layerControlInputs;this._handlingClick=!0;for(var a=i.length-1;a>=0;a--)t=i[a],void 0===(e=this._getLayer(t.layerId).layer)._url||e.setOpacity(t.value/100);this._handlingClick=!1,this._refocusOnMap()}}),L.control.opacity=function(t,e){return new L.Control.Opacity(t,e)};","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":500,"wires":[["1893dd86.b75552"]]},{"id":"1893dd86.b75552","type":"http response","z":"77ddf49d.9315dc","name":"","statusCode":"","headers":{"content-type":"text/javascript"},"x":510,"y":500,"wires":[]},{"id":"32ab2817.c6e9e8","type":"ui_template","z":"77ddf49d.9315dc","group":"7b72899.38e6578","name":"Common Map JS","order":1,"width":0,"height":0,"format":"\n<script>\n// Common functions used to deal with leaflet maps\n\n/* Set up the map watching to communicate with Node-RED */    \nfunction addMapWatch(cScope,map,mapid,layers,fallBack) {\n    sendMapDimensions=function(evt) {\n        cScope.send({\"dimChange\" : {'type': evt.type, 'fromMapId': mapid, 'zoom': map.getZoom(), 'pos': map.getCenter()}})\n    }\n    \n    map.on('moveend',sendMapDimensions)\n    map.on('zoomend',sendMapDimensions)\n    map.on('move',sendMapDimensions)\n    \n    // Debug layers names\n    if(layers) {\n        for (const [key, value] of Object.entries(layers)) {\n            console.log(\"layer key \",key,\" val=\", value);\n        }\n        \n        for (var key in layers) {\n            // check if the property/key is defined in the object itself, not in parent\n            if (layers.hasOwnProperty(key)) {\n                console.log(\"layer key \",key,\" val=\", layers[key]);\n            }\n        }\n    }\n    \n    cScope.$watch('msg',function(msg) {\n        let refPointMarker\n        \n        function setRefPointMarker(pos) {\n            if (refPointMarker) {\n                map.removeLayer(refPointMarker);\n            }\n\n            let svgPin = '<svg width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><metadata id=\"metadata1\">image/svg+xml</metadata><circle fill=\"#fe2244\" cx=\"10\" cy=\"10\" r=\"9\"/><circle fill=\"#ffffbf\" cx=\"10\" cy=\"10\" r=\"5\"/></svg>'\n            refPointMarker=L.marker([pos.lat,pos.lng], {icon: L.icon({iconUrl: encodeURI(`data:image/svg+xml,${svgPin}`).replace(/\\#/g,'%23'), iconSize: 20})}).bindPopup(\"Ref Point\").addTo(map);\n        }\n        \n        if(msg) {\n            if(\"payload\" in msg) {\n                if(\"setDim\" in msg.payload) {\n                    console.log('setDim',msg.payload.setDim)\n                    if(map.getZoom()!=msg.payload.setDim.zoom || map.getCenter()!=msg.payload.setDim.pos) {\n                        map.setView(msg.payload.setDim.pos,msg.payload.setDim.zoom)\n                    }\n                    if(\"type\" in msg.payload.setDim && msg.payload.setDim.type=='initMap') {\n                        setRefPointMarker(msg.payload.setDim.pos)\n                    }\n                } else if(\"setOpacity\" in msg.payload) {\n                    console.log(\"Setting opcacity\",msg.payload.setOpacity)\n                    for (var name in layers) {\n                        if (layers.hasOwnProperty(name)) {\n                            if(name==msg.payload.setOpacity.layer) {\n                                console.log(\"Setting layer \",name,\" opacity to  \",msg.payload.setOpacity.opacity)\n                                layers[name].setOpacity(msg.payload.setOpacity.opacity)\n                            }\n                        }\n                    }\n                } else if(\"setRefPoint\" in msg.payload) {\n                    // Set the reference point with a marker    \n                    setRefPointMarker(msg.payload.setRefPoint.pos)\n                    map.setView(msg.payload.setRefPoint.pos,map.getZoom())\n                } else if(fallBack) {\n                    fallBack(msg.payload,cScope,map,mapid,layers)\n                }\n            } else {\n                console.log(`${mapid} unhandled msg, no payload: `,msg)\n            }\n        }\n    });\n    \n    // Notify of init complete\n    cScope.send({\"initMap\":mapid});\n}\n\n/* Function added to generate an event when the map is clicked\n    This will also add a marker\n*/\nfunction addMapClick(cScope,map,mapid) {\n    let marker\n\tmap.on('click', function(evt) {\n        cScope.send({\"mousePos\" :evt.latlng, \"fromMapId\":mapid});\n        if (marker) {\n            map.removeLayer(marker);\n        };\n        marker = L.circleMarker(evt.latlng).addTo(map);\n    });\n}\n\nfunction createOSMMap(L,mapid,overlayMaps) {\n    var map=L.map(mapid)\n\n\tconst osmURL='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n    osmLayer=L.tileLayer(osmURL,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]}).addTo(map);\n\n    L.control.layers({\"OSM\": osmLayer}, overlayMaps,{\"hideSingleBase\":true}).addTo(map);\n    \n    return map\n}\n\n/* Function to setup opacity on a map layer \n*/\nfunction defineOpacity() {\n    console.log(\"Start define Opacity\")\n    \n    L.Control.Opacity = L.Control.extend({\n        options: {\n            collapsed: !1,\n            position: \"topright\",\n            label: null\n        },\n        initialize: function(t, e) {\n            for (var i in L.Util.setOptions(this, e),\n            this._layerControlInputs = [],\n            this._layers = [],\n            this._lastZIndex = 0,\n            this._handlingClick = !1,\n            t)\n                this._addLayer(t[i], i, !0)\n        },\n        onAdd: function(t) {\n            return this._initLayout(),\n            this._update(),\n            this._container\n        },\n        expand: function() {\n            L.DomUtil.addClass(this._container, \"leaflet-control-layers-expanded\"),\n            this._form.style.height = null;\n            var t = this._map.getSize().y - (this._container.offsetTop + 50);\n            return t < this._form.clientHeight ? (L.DomUtil.addClass(this._form, \"leaflet-control-layers-scrollbar\"),\n            this._form.style.height = t + \"px\") : L.DomUtil.removeClass(this._form, \"leaflet-control-layers-scrollbar\"),\n            this\n        },\n        collapse: function() {\n            return L.DomUtil.removeClass(this._container, \"leaflet-control-layers-expanded\"),\n            this\n        },\n        _initLayout: function() {\n            var t = \"leaflet-control-layers\"\n              , e = this._container = L.DomUtil.create(\"div\", t)\n              , i = this.options.collapsed;\n            if (e.setAttribute(\"aria-haspopup\", !0),\n            L.DomEvent.disableClickPropagation(e),\n            L.DomEvent.disableScrollPropagation(e),\n            this.options.label) {\n                var a = L.DomUtil.create(\"p\", t + \"-label\");\n                a.innerHTML = this.options.label,\n                e.appendChild(a)\n            }\n            var s = this._form = L.DomUtil.create(\"form\", t + \"-list\");\n            i && (this._map.on(\"click\", this.collapse, this),\n            L.Browser.android || L.DomEvent.on(e, {\n                mouseenter: this.expand,\n                mouseleave: this.collapse\n            }, this));\n            var l = this._layersLink = L.DomUtil.create(\"a\", t + \"-toggle\", e);\n            l.href = \"#\",\n            l.title = \"Layers\",\n            L.Browser.touch ? (L.DomEvent.on(l, \"click\", L.DomEvent.stop),\n            L.DomEvent.on(l, \"click\", this.expand, this)) : L.DomEvent.on(l, \"focus\", this.expand, this),\n            i || this.expand(),\n            this._baseLayersList = L.DomUtil.create(\"div\", t + \"-base\", s),\n            this._separator = L.DomUtil.create(\"div\", t + \"-separator\", s),\n            this._overlaysList = L.DomUtil.create(\"div\", t + \"-overlays\", s),\n            e.appendChild(s)\n        },\n        _getLayer: function(t) {\n            for (var e = 0; e < this._layers.length; e++)\n                if (this._layers[e] && L.Util.stamp(this._layers[e].layer) === t)\n                    return this._layers[e]\n        },\n        _addLayer: function(t, e, i) {\n            this._layers.push({\n                layer: t,\n                name: e,\n                overlay: i\n            })\n        },\n        _update: function() {\n            if (!this._container)\n                return this;\n            L.DomUtil.empty(this._baseLayersList),\n            L.DomUtil.empty(this._overlaysList),\n            this._layerControlInputs = [];\n            var t, e, i, a, s = 0;\n            for (i = 0; i < this._layers.length; i++)\n                a = this._layers[i],\n                this._addItem(a),\n                e = e || a.overlay,\n                t = t || !a.overlay,\n                s += a.overlay ? 0 : 1;\n            return this.options.hideSingleBase && (t = t && s > 1,\n            this._baseLayersList.style.display = t ? \"\" : \"none\"),\n            this._separator.style.display = e && t ? \"\" : \"none\",\n            this\n        },\n        _addItem: function(t) {\n            var e, i = document.createElement(\"label\");\n            t.overlay ? ((e = document.createElement(\"input\")).type = \"range\",\n            e.className = \"leaflet-control-layers-range\",\n            e.min = 0,\n            e.max = 100,\n            e.value = 100) : e = this._createRadioElement(\"leaflet-base-layers\", checked),\n            this._layerControlInputs.push(e),\n            e.layerId = L.Util.stamp(t.layer),\n            L.DomEvent.on(e, \"click\", this._onInputClick, this),\n            L.DomEvent.on(e, \"touchend\", this._onInputClick, this);\n            var a = document.createElement(\"span\");\n            a.innerHTML = \" \" + t.name;\n            var s = document.createElement(\"div\")\n              , l = document.createElement(\"div\");\n            return i.appendChild(s),\n            s.appendChild(a),\n            i.appendChild(l),\n            l.appendChild(e),\n            (t.overlay ? this._overlaysList : this._baseLayersList).appendChild(i),\n            i\n        },\n        _onInputClick: function() {\n            var t, e, i = this._layerControlInputs;\n            this._handlingClick = !0;\n            for (var a = i.length - 1; a >= 0; a--)\n                t = i[a],\n                void 0 === (e = this._getLayer(t.layerId).layer)._url || e.setOpacity(t.value / 100);\n            this._handlingClick = !1,\n            this._refocusOnMap()\n        }\n    })\n\n    L.control.opacity = function(t, e) {\n        return new L.Control.Opacity(t,e)\n    }\n    \n    console.log(\"End defined opacity\")\n}\n</script>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","x":110,"y":40,"wires":[[]]},{"id":"d825797a.15cbc8","type":"ui_template","z":"77ddf49d.9315dc","group":"9b16ec6a.5908a","name":"Common PAIRS","order":26,"width":2,"height":1,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\">\n</script>\n   \n<script>\n\nconst PAIRS_HOST='pairs.res.ibm.com'\nconst PAIRS_PORT=8080\nconst auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\nconst EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\nconst INIT_OPACITY=0.4\n\npairsFuncs= {\n    setPairsData: function(geoServerURLOrID,minColor,maxColor,colorTableId,layerName) {\n        // console.log('Setting pairs data to ',geoServerId,minColor,maxColor,colorTableId,layerName)\n        this.geoServerURL=geoServerURLOrID.startsWith('http')?geoServerURLOrID:`https://${PAIRS_HOST}:${PAIRS_PORT}/${geoServerURLOrID}`\n        this.minColor=minColor\n        this.maxColor=maxColor\n        this.colorTableId=colorTableId\n        this.layerName=layerName\n    },\n    makePairsURL: function(z,x,y,geoServerURL,minColor,maxColor,colorTableId,layerName) {\n        const proj='EPSG:3857'\n        const imageFormat='png'\n        const wpels=256\n        const hpels=256\n\n        // So, this should be the main WMS URL base\n        var baseURL=`${geoServerURL}/pairs/wms?service=WMS&version=1.3.0&request=GetMap&format=image/${imageFormat}&transparent=true&transitionEffect=resize&width=${wpels}&height=${hpels}&crs=${proj}&styles=`\n\n        zpow=2**z/2\n        bbox_l=(x-zpow)*EPSG[proj]['dx']/zpow\n        bbox_t=(zpow-y-1)*EPSG[proj]['dy']/zpow\n        bbox_r=(x-zpow+1)*EPSG[proj]['dx']/zpow\n        bbox_b=(zpow-y)*EPSG[proj]['dy']/zpow\n        \n        // Make-up the style layer descriptor and encode it    \n        var sld=`https://${PAIRS_HOST}:443/map/sld?type=raster&min=${minColor}&max=${maxColor}&colorTableId=${colorTableId}&no_data=-1&property=value&layer=pairs:${layerName}`\n        sldEnc=encodeURIComponent(sld)\n        \n        // Finally build the full URL\n        var fullURL=`${baseURL}&bbox=${bbox_l},${bbox_t},${bbox_r},${bbox_b}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`\n\n        console.log(`WMS URL without bbox: ${baseURL}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`)                \n        return fullURL\n    },\n    getTileUrl: function(coords) {\n        //console.log('Get PAIRS tile for coords ',coords)\n        return this.makePairsURL(coords['z'],coords['x'],coords['y'],this.geoServerURL,this.minColor,this.maxColor,this.colorTableId,this.layerName)\n    }\n}\n\nfunction initPAIRS(L) {\n    L.TileLayer.Pairs = L.TileLayer.extend(pairsFuncs)\n}\n\nfunction newPAIRSLayer(L,geoServerURLOrId,minColor,maxColor,colorTableId,layerName,opacity) {\n    newLayer=new L.TileLayer.Pairs()\n    newLayer.setPairsData(geoServerURLOrId,minColor,maxColor,colorTableId,layerName)\n    newLayer.setOpacity(opacity?opacity:INIT_OPACITY)\n    \n    return newLayer\n}\n\n</script>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","x":100,"y":80,"wires":[[]]},{"id":"5b5c0afb.53b1b4","type":"switch","z":"45272af4.690614","name":"","property":"payload.aoi","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":180,"wires":[["5c397cc3.a01284"],["babf9321.715a8"]]},{"id":"a25a5118.5e051","type":"change","z":"5fed8ae7.8bb5a4","name":"RefData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49432\",\"49433\",\"49441\",\"49454\",\"50450\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","tot":"json"},{"t":"set","p":"payload.zoom","pt":"msg","to":"12","tot":"num"},{"t":"set","p":"payload.duration","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":120,"y":700,"wires":[[]]},{"id":"6aa75b73.a33b54","type":"change","z":"5fed8ae7.8bb5a4","name":"RefData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49432\",\"49433\",\"49441\",\"49454\",\"50450\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","tot":"json"},{"t":"set","p":"payload.zoom","pt":"msg","to":"12","tot":"num"},{"t":"set","p":"payload.duration","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":600,"wires":[[]]},{"id":"c0d37d4c.fe0a2","type":"inject","z":"5fed8ae7.8bb5a4","name":"initAllLayers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49296\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49304\",\"50463\",\"49252\",\"50450\",\"50509\",\"50511\",\"50497\",\"50496\",\"50453\",\"50456\"]}","payloadType":"json","x":150,"y":100,"wires":[["e3100a9.ca94df8"]],"info":"Créer un bug pour la fonction\n\n**Layers :** \n\n16100 : Ground temperature\n16200 : Ground relative humidity\n16700 : Average precipitation\n\n49250 : Precip past 24 h\n49252 : Relative humidity surface\n49257 : Temperature above ground\n49296 : Global elevation\n49304 : Dew point\n49310 : Temperature feels like\n49313 : Wind speed\n49441 : solar radiation\n\n50453 : Standard deviation of orography\n50450 : Soil type \n50456 : Slope of sub grid scale orography \n50463 : Wind Direction\n50496 : pH\n50497 : Soil organic carbon\n50509 : Nitrogen\n50511 : Soil classification most probable class\n\n\n**Non utilisés :**\n49311 : UV index \n49432 : Minimum precipitation rate\n49433 : Maximum precipitation rate\n\n50447 : High vegetation cover\n50498 : Organic carbon density\n50449 : Type of high vegetation\n"},{"id":"e3100a9.ca94df8","type":"change","z":"5fed8ae7.8bb5a4","name":"","rules":[{"t":"set","p":"layers","pt":"flow","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":100,"wires":[[]]},{"id":"559eecc0.9adae4","type":"debug","z":"5fed8ae7.8bb5a4","name":"result requete","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":880,"y":680,"wires":[]},{"id":"3c01f6c1.eb661a","type":"function","z":"e68fbd7c.0431a","name":"Generate query JSON","func":"var payload = {\n    \"layers\": [],\n    \"spatial\": { \"type\": \"point\", \"coordinates\": [ msg.payload.pos.lat, msg.payload.pos.lng]},\n    \"temporal\": { \"intervals\": [{ \"start\": msg.payload.startDay + \"T00:00:00Z\", \"end\": msg.payload.endDay + \"T00:00:00Z\" }] }\n};\n\n\nvar depths = [\"0to5cm\",\"5to15cm\",\"15to30cm\",\"30to60cm\",\"60to100cm\", \"100to200cm\"]\n    \nfor (const layerId in msg.payload.layers) {\n    if ((msg.payload.layers[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.0 secs\") || msg.payload.layers[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.00 secs\") {\n        if (msg.payload.layers[layerId].dimensions_description) {\n            for (var j = 0; j < depths.length; j++) {\n                payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"aggregation\": \"None\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]}, \"dimensions\" : [{\"name\" : \"quantile\", \"value\" : \"mean\"}, {\"name\" : \"depth\", \"value\" : depths[j] }] })\n            }\n        } else {\n            payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"aggregation\": \"None\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]} })\n        }\n    } else {\n        payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"aggregation\": \"Mean\"})\n        payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"aggregation\": \"Max\"})\n        payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"aggregation\": \"Min\"})\n    }\n}\n\nmsg.payload = payload;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":240,"wires":[["3c865690.f7436a"]]},{"id":"5c397cc3.a01284","type":"function","z":"45272af4.690614","name":"Generate query JSON - rectangle","func":"var payload = {\n    \"name\": \"VitXplore_\" + \"_[\" + msg.payload.pos.lat + \";\" + msg.payload.pos.lng + \"]_[\" + msg.payload.startDay + \"/\" + msg.payload.endDay + \"]\",\n    \"layers\": [{\"alias\": \"Overall Scoring\", \"expression\": msg.payload.udf }],\n    \"spatial\": { \"type\": \"square\", \"coordinates\": [ msg.payload.pos.rSouth, msg.payload.pos.rWest, msg.payload.pos.rNorth, msg.payload.pos.rEast]},\n    \"temporal\": { \"intervals\": [{ \"start\": msg.payload.startDay + \"T00:00:00Z\", \"end\": msg.payload.endDay + \"T00:00:00Z\" }] }\n};\n\n\nvar depths = [\"0to5cm\",\"5to15cm\",\"15to30cm\",\"30to60cm\",\"60to100cm\", \"100to200cm\"]\n    \nfor (const i in msg.payload.layers) {\n    var layerId = msg.payload.layers[i].id;\n    \n    if ((msg.payload.layerInfo[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.00 secs\") || (msg.payload.layerInfo[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.0 secs\")) {\n        if (msg.payload.layerInfo[layerId].dimensions_description) {\n            for (var j = 0; j < depths.length; j++) {\n                payload.layers.push({ \"type\": \"raster\", \"id\":layerId, \"alias\": depths[j] + \"_\" + layerId, \"aggregation\": \"Mean\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]}, \"dimensions\" : [{\"name\" : \"quantile\", \"value\" : \"mean\"}, {\"name\" : \"depth\", \"value\" : depths[j] }] })\n            }\n        } else {\n            payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"alias\": \"Mean_\" + layerId, \"aggregation\": \"Mean\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]} })\n        }\n    } else {\n        payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"alias\": \"Mean_\" + layerId, \"aggregation\": \"Mean\"})\n    }\n}\n\nmsg.payload = payload;\nreturn msg;\n\n\n            ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":160,"wires":[["e4b5f6b5.ac7a98","7901606b.79a5e"]]},{"id":"8d584588.626178","type":"debug","z":"45272af4.690614","name":"sucedeed","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":620,"wires":[]},{"id":"23ff7bd5.465224","type":"debug","z":"45272af4.690614","name":"failed","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":440,"y":680,"wires":[]},{"id":"babf9321.715a8","type":"function","z":"45272af4.690614","name":"Generate query JSON - aoi","func":"var payload = {\n    \"name\": \"VitXplore_\" + msg.payload.aoi.name + \"_[\" + msg.payload.pos.lat + \";\" + msg.payload.pos.lng + \"]_[\" + msg.payload.startDay + \"/\" + msg.payload.endDay + \"]\",\n    \"layers\": [{\"alias\": \"Overall Scoring\", \"expression\": msg.payload.udf }],\n    \"spatial\": { \"type\": \"poly\", \"aoi\": msg.payload.aoi.id},\n    \"temporal\": { \"intervals\": [{ \"start\": msg.payload.startDay + \"T00:00:00Z\", \"end\": msg.payload.endDay + \"T00:00:00Z\" }] }\n};\n\nvar depths = [\"0to5cm\",\"5to15cm\",\"15to30cm\",\"30to60cm\",\"60to100cm\", \"100to200cm\"]\n    \nfor (const i in msg.payload.layers) {\n    var layerId = msg.payload.layers[i].id;\n    \n    if ((msg.payload.layerInfo[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.00 secs\") || (msg.payload.layerInfo[layerId].measurement_interval == \"0 years 0 mons 0 days 0 hours 0 mins 0.0 secs\")) {\n        if (msg.payload.layerInfo[layerId].dimensions_description) {\n            for (var j = 0; j < depths.length; j++) {\n                payload.layers.push({ \"type\": \"raster\", \"id\":layerId, \"alias\": depths[j] + \"_\" + layerId, \"aggregation\": \"Mean\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]}, \"dimensions\" : [{\"name\" : \"quantile\", \"value\" : \"mean\"}, {\"name\" : \"depth\", \"value\" : depths[j] }] })\n            }\n        } else {\n            payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"alias\": \"Mean_\" + layerId, \"aggregation\": \"Mean\", \"temporal\" : {\"intervals\" : [{\"snapshot\" : \"2020-09-01T00:00:01Z\"}]} })\n        }\n    } else {\n        payload.layers.push({ \"type\": \"raster\", \"id\": layerId, \"alias\": \"Mean_\" + layerId, \"aggregation\": \"Mean\"})\n    }\n}\n\nmsg.payload = payload;\nreturn msg;\n\n\n            ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":200,"wires":[["e4b5f6b5.ac7a98","180d327b.be6dce"]]},{"id":"ccb94771.a9ec38","type":"change","z":"2d447360.3ff9fc","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":320,"wires":[["febe78b1.95ad68"]]},{"id":"6acd5916.f56e88","type":"subflow:22be0357.6ef6fc","z":"2d447360.3ff9fc","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":210,"y":360,"wires":[["ccb94771.a9ec38"],[],[]]},{"id":"febe78b1.95ad68","type":"subflow:22be0357.6ef6fc","z":"2d447360.3ff9fc","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":620,"y":440,"wires":[["2c19ed19.48d352"],[],[]]},{"id":"f3aea4cf.c7f028","type":"delay","z":"2d447360.3ff9fc","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":440,"wires":[["febe78b1.95ad68"]]},{"id":"3db98662.14ffca","type":"change","z":"2d447360.3ff9fc","name":"setDelay","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":440,"wires":[["f3aea4cf.c7f028"]]},{"id":"db75cc2a.e99d3","type":"template","z":"2d447360.3ff9fc","name":"LayersArray","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"VitXplore_{{payload.aoi.name}}_[{{payload.pos.lat}};{{payload.pos.lng}}]_[{{payload.startDay}}/{{payload.endDay}}]\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \n            \"alias\": \"Mean_{{id}}\",\n            \"type\": \"raster\",\n            \"aggregation\": \"Mean\",\n            {{#lower}}\n            {{#upper}}\n            \"output\":\"false\",\n            {{/upper}}\n            {{/lower}}\n            \"id\": \"{{id}}\",\n            \"type\": \"raster\"\n        },\n    {{/payload.layers}}\n        {\n            \"alias\": \"Overall Scoring\",\n            \"expression\": \"{{payload.udf}}\",\n        }\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": {{payload.aoi.id}}\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":570,"y":160,"wires":[["568c5361.2a489c"]]},{"id":"568c5361.2a489c","type":"function","z":"2d447360.3ff9fc","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":220,"wires":[["f6af98f6.b5d308"]]},{"id":"f6af98f6.b5d308","type":"json","z":"2d447360.3ff9fc","name":"","property":"payload","action":"obj","pretty":false,"x":770,"y":260,"wires":[["9f1fc72.6d0d438"]]},{"id":"2c19ed19.48d352","type":"switch","z":"2d447360.3ff9fc","name":"Test Status","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Initializing","vt":"str"},{"t":"eq","v":"Queued","vt":"str"},{"t":"eq","v":"Running","vt":"str"},{"t":"eq","v":"Writing","vt":"str"},{"t":"eq","v":"Succeeded","vt":"str"},{"t":"eq","v":"Failed","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":210,"y":600,"wires":[["75dd3d5f.606e84"],["75dd3d5f.606e84"],["75dd3d5f.606e84"],["75dd3d5f.606e84"],[],["6f0a2dc0.d25ce4"],["7f19e5a6.09aefc"]]},{"id":"75dd3d5f.606e84","type":"change","z":"2d447360.3ff9fc","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":500,"wires":[["3db98662.14ffca"]]},{"id":"4497a63b.621d58","type":"switch","z":"2d447360.3ff9fc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"id","vt":"str"},{"t":"hask","v":"name","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":190,"y":220,"wires":[["ccb94771.a9ec38"],["6acd5916.f56e88"],["fff12784.8cca78"]]},{"id":"9f1fc72.6d0d438","type":"function","z":"2d447360.3ff9fc","name":"FixHTMLEntities","func":"msg.payload.layers=msg.payload.layers.map(function(layer) {\n    if('expression' in layer) {\n        layer.expression=layer.expression.replace(/&gt;/g,'>')\n        layer.expression=layer.expression.replace(/&lt;/g,'<')\n        layer.expression=layer.expression.replace(/&#x3D;/g,'=')\n        layer.expression=layer.expression.replace(/&amp;/g,'&')\n    }\n    return layer\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":260,"wires":[["6acd5916.f56e88"]]},{"id":"344698f3.0d8178","type":"template","z":"2d447360.3ff9fc","name":"LayersArrayAll - aoi","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"VitXplore_{{payload.aoi.name}}_[{{payload.pos.lat}};{{payload.pos.lng}}]_[{{payload.startDay}}/{{payload.endDay}}]\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \n            \"alias\": \"Mean_{{id}}\",\n            \"type\": \"raster\",\n            \"aggregation\": \"Mean\",\n            \"id\": \"{{id}}\",\n            \"type\": \"raster\"\n        },\n    {{/payload.layers}}\n        {\n            \"alias\": \"Overall Scoring\",\n            \"expression\": \"{{payload.udf}}\",\n        }\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": {{payload.aoi.id}}\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":490,"y":260,"wires":[["568c5361.2a489c"]]},{"id":"fff12784.8cca78","type":"switch","z":"2d447360.3ff9fc","name":"","property":"payload.aoi","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":240,"wires":[[],["344698f3.0d8178"]]},{"id":"4dfd230d.47f60c","type":"template","z":"2d447360.3ff9fc","name":"LayersArrayAll - rectangle","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"VitXplore_{{payload.aoi.name}}_[{{payload.pos.lat}};{{payload.pos.lng}}]_[{{payload.startDay}}/{{payload.endDay}}]\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \n            \"alias\": \"Mean_{{id}}\",\n            \"type\": \"raster\",\n            \"aggregation\": \"Mean\",\n            \"id\": \"{{id}}\",\n            \"type\": \"raster\"\n        },\n    {{/payload.layers}}\n        {\n            \"alias\": \"Overall Scoring\",\n            \"expression\": \"{{payload.udf}}\",\n        }\n   ],\n    \"spatial\": {\n        \"type\": \"square\",\n        \"coordinates\": [{{payload.pos.rSouth}}, {{payload.pos.rWest}}, {{payload.pos.rNorth}}, {{payload.pos.rEast}}]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":510,"y":220,"wires":[["568c5361.2a489c"]]},{"id":"6f0a2dc0.d25ce4","type":"debug","z":"2d447360.3ff9fc","name":"sucedeed","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":680,"wires":[]},{"id":"7f19e5a6.09aefc","type":"debug","z":"2d447360.3ff9fc","name":"failed","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":740,"wires":[]},{"id":"771a35b3.68008c","type":"debug","z":"45272af4.690614","name":"from front","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":350,"y":60,"wires":[]},{"id":"7901606b.79a5e","type":"debug","z":"45272af4.690614","name":"rectangle","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":80,"wires":[]},{"id":"180d327b.be6dce","type":"debug","z":"45272af4.690614","name":"aoi","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":780,"y":140,"wires":[]},{"id":"288e21d8.0ec36e","type":"debug","z":"45272af4.690614","name":"queud","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":680,"y":620,"wires":[]},{"id":"8e96b9c0.ef1d68","type":"debug","z":"45272af4.690614","name":"running","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":630,"y":700,"wires":[]},{"id":"a40ebdd0.de77a","type":"debug","z":"b14a35fc.a33548","name":"layers","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.layers","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":40,"wires":[]},{"id":"82e5589e.f08648","type":"debug","z":"3aa70edc.b22322","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":100,"wires":[]},{"id":"c8312c14.c31e","type":"debug","z":"3aa70edc.b22322","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":600,"y":420,"wires":[]}]