[{"id":"dc853c89.d32cf","type":"tab","label":"Common JS Code","disabled":false,"info":"Here we have the common header code"},{"id":"bd1591bd.1605c","type":"tab","label":"PAIRS Explorer","disabled":false,"info":""},{"id":"84950fca.868f2","type":"tab","label":"PAIRS Viti Map","disabled":false,"info":"PAIRS Map with Viti layers"},{"id":"a09c9932.979aa8","type":"tab","label":"PAIRS Queries tests","disabled":false,"info":"Query PAIRS over REST/HTTP"},{"id":"9976eb7b.656868","type":"tab","label":"Simple PAIRS","disabled":false,"info":""},{"id":"b3c62114.a4d8f","type":"tab","label":"Map widget OSM","disabled":false,"info":"Example of MapWidget with OpenStreetMap background"},{"id":"e10ffd97.9d351","type":"tab","label":"UiBuilder-Vue","disabled":false,"info":""},{"id":"16d1d089.1978cf","type":"tab","label":"Web WorldMap node test","disabled":false,"info":""},{"id":"d2e1164a.aba058","type":"tab","label":"Test BootStrap","disabled":false,"info":""},{"id":"f7a7a0b8.760b3","type":"subflow","name":"PAIRS Request","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"3092a7a3.4373b8"}]}],"out":[{"x":960,"y":40,"wires":[{"id":"c43da069.17258","port":0}]},{"x":960,"y":140,"wires":[{"id":"3771ffd3.e2496","port":0},{"id":"3e05e867.58bb98","port":0},{"id":"951c687e.a57d38","port":0}]},{"x":960,"y":240,"wires":[{"id":"c43da069.17258","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"fac93a33.099aa8","type":"subflow","name":"PAIRS Point Query","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"38f35b82.d1a314"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"9c19a3c6.e0c29","port":0}]},{"x":740,"y":360,"wires":[{"id":"c39e3181.4061","port":1}]},{"x":740,"y":420,"wires":[{"id":"c39e3181.4061","port":2},{"id":"c5bbd50a.eed5e8","port":1}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"6df36e9b.8f203","type":"subflow","name":"PAIRS Query Job","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"f0291164.cf42"}]}],"out":[{"x":780,"y":400,"wires":[{"id":"997a38a1.fb2ec8","port":0}]},{"x":780,"y":460,"wires":[{"id":"b3f5dcd.085522","port":1}]},{"x":760,"y":160,"wires":[{"id":"bdaf8767.c47d98","port":0}]},{"x":780,"y":340,"wires":[{"id":"dacc29d6.b8d258","port":0}]},{"x":760,"y":100,"wires":[{"id":"19e7698f.be4956","port":0},{"id":"6df36e9b.8f203","port":0},{"id":"8d344825.1fd0e8","port":0},{"id":"dc74fde5.e884f","port":1}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#0088EE","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg"]},{"id":"f1fd9488.28e628","type":"subflow","name":"PAIRS Layers Details","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"e29f9bc8.fae6d8"}]}],"out":[{"x":940,"y":40,"wires":[{"id":"4fd04327.b305dc","port":0}]},{"x":940,"y":300,"wires":[{"id":"a287a631.4007d8","port":1},{"id":"9f317e87.5c23","port":0}]},{"x":940,"y":380,"wires":[{"id":"a287a631.4007d8","port":2},{"id":"e29f9bc8.fae6d8","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"f672aa41.a0e548","type":"subflow","name":"PAIRS Request (2)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"76ec1999.68c598"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"8d7fb6ad.e41038","port":0}]},{"x":1060,"y":120,"wires":[{"id":"7363ffeb.948b4","port":0},{"id":"96029e8b.f6e45","port":0},{"id":"3855e065.b4361","port":0}]},{"x":1060,"y":200,"wires":[{"id":"a1760cb0.1867","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"5bd6abcd.e7feb4","type":"subflow","name":"PAIRS Min-Mean-Max","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"398a80b9.6e014"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"5890ea17.dc3844","port":0}]},{"x":740,"y":360,"wires":[{"id":"5890ea17.dc3844","port":1}]},{"x":740,"y":420,"wires":[{"id":"5890ea17.dc3844","port":2}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"a0989afc.3a50e8","type":"subflow","name":"PAIRS Query Job (2)","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"a89918f5.c9ad08"}]}],"out":[{"x":780,"y":400,"wires":[{"id":"b66cb3d3.ae24f","port":0}]},{"x":780,"y":460,"wires":[{"id":"67900531.5342ec","port":1}]},{"x":760,"y":160,"wires":[{"id":"c0ede998.84b008","port":0}]},{"x":780,"y":340,"wires":[{"id":"15f1f19c.23c6de","port":0}]},{"x":760,"y":100,"wires":[{"id":"b15a9189.c3618","port":0},{"id":"a0989afc.3a50e8","port":0},{"id":"21ba9ddf.623872","port":0},{"id":"1fab01bc.0472ae","port":1}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#0088EE","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg"]},{"id":"aeafb445.a67ee8","type":"subflow","name":"PAIRS Layers Details (2)","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"306d6d70.269e52"}]}],"out":[{"x":1000,"y":40,"wires":[{"id":"5a8d087d.702bb8","port":0}]},{"x":940,"y":300,"wires":[{"id":"37c172b8.2b8e1e","port":1},{"id":"d670a259.98141","port":0}]},{"x":940,"y":380,"wires":[{"id":"37c172b8.2b8e1e","port":2},{"id":"306d6d70.269e52","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"11ec3db7.1beab2","type":"subflow","name":"PAIRS Request (3)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"f87a57fc.bb5678"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"cd61e965.359538","port":0}]},{"x":1060,"y":120,"wires":[{"id":"f6fa077e.3dabd8","port":0},{"id":"54a3d8b4.f27ab8","port":0},{"id":"f0d9bbc3.6462a8","port":0}]},{"x":1060,"y":200,"wires":[{"id":"74526457.1261dc","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"848340f0.73ab7","type":"subflow","name":"PAIRS Layers Details (3)","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"27ea7e18.78ff02"}]}],"out":[{"x":1000,"y":40,"wires":[{"id":"7535651e.35423c","port":0}]},{"x":940,"y":300,"wires":[{"id":"1e52eb4f.a422b5","port":1},{"id":"a2ef5ae4.157348","port":0}]},{"x":940,"y":380,"wires":[{"id":"1e52eb4f.a422b5","port":2},{"id":"27ea7e18.78ff02","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"f4cca687.d938c8","type":"subflow","name":"PAIRS Request (4)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"2ab086ea.5d010a"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"f9b5d2d3.02b6","port":0}]},{"x":1060,"y":120,"wires":[{"id":"9c4bdf30.02b63","port":0},{"id":"458e27e7.a4bc78","port":0},{"id":"c238ae11.519ba","port":0}]},{"x":1060,"y":200,"wires":[{"id":"fb03207.06ff7e","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"8a1a5b07.e36c58","type":"subflow","name":"PAIRS Min-Mean-Max (2)","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"c283998.f3ba268"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"3e627991.916276","port":0}]},{"x":740,"y":360,"wires":[{"id":"3e627991.916276","port":1}]},{"x":740,"y":420,"wires":[{"id":"3e627991.916276","port":2}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"c1acda6c.e51908","type":"subflow","name":"PAIRS Request (5)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"93154a02.0cd728"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"4ae59485.01116c","port":0}]},{"x":1060,"y":120,"wires":[{"id":"8066e32e.4574","port":0},{"id":"66f33eeb.9a497","port":0},{"id":"13bc16db.91d729","port":0}]},{"x":1060,"y":200,"wires":[{"id":"27dc2add.3f06c6","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"2efea337.47aa4c","type":"subflow","name":"PAIRS Query Job (3)","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"dc79c951.f43668"}]}],"out":[{"x":780,"y":400,"wires":[{"id":"efcd011e.b54e9","port":0}]},{"x":780,"y":460,"wires":[{"id":"e246b037.8f29","port":1}]},{"x":760,"y":160,"wires":[{"id":"81e5d59c.108d88","port":0}]},{"x":780,"y":340,"wires":[{"id":"7ed4984a.5b78d8","port":0}]},{"x":760,"y":100,"wires":[{"id":"f91bb13d.082f9","port":0},{"id":"2efea337.47aa4c","port":0},{"id":"e17a6920.c8fd68","port":0},{"id":"aa247b9b.5b91a8","port":1}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#0088EE","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg"]},{"id":"433cfd53.54f5b4","type":"subflow","name":"PAIRS Layers Details (4)","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"cea8a4da.fdd398"}]}],"out":[{"x":1000,"y":40,"wires":[{"id":"8877d7a8.4d65b8","port":0}]},{"x":940,"y":300,"wires":[{"id":"143f73d2.6e95bc","port":1},{"id":"70240837.bde258","port":0}]},{"x":940,"y":380,"wires":[{"id":"143f73d2.6e95bc","port":2},{"id":"cea8a4da.fdd398","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"85bc446.b6594b8","type":"subflow","name":"PAIRS Request (6)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"befb7a48.efd2b8"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"576bf6ff.488a08","port":0}]},{"x":1060,"y":120,"wires":[{"id":"d4d8cfa8.ad402","port":0},{"id":"d98bf367.775b8","port":0},{"id":"4e749f9d.13da2","port":0}]},{"x":1060,"y":200,"wires":[{"id":"42cba1e4.1c9ac","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"71d70215.15017c","type":"subflow","name":"PAIRS Min-Mean-Max (3)","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"edf36c67.91ddd"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"89271d39.855aa","port":0}]},{"x":740,"y":360,"wires":[{"id":"89271d39.855aa","port":1}]},{"x":740,"y":420,"wires":[{"id":"89271d39.855aa","port":2}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"91448b6c.d2cb58","type":"subflow","name":"PAIRS Layers Details (5)","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"39268a51.361ad6"}]}],"out":[{"x":1000,"y":40,"wires":[{"id":"5d6e967b.006d88","port":0}]},{"x":940,"y":300,"wires":[{"id":"628e8b66.e14104","port":1},{"id":"2c3ffc5b.0b0fb4","port":0}]},{"x":940,"y":380,"wires":[{"id":"628e8b66.e14104","port":2},{"id":"39268a51.361ad6","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"bd9a9168.054b1","type":"subflow","name":"PAIRS Request (7)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"61c4035c.a31fec"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"71800840.cde058","port":0}]},{"x":1060,"y":120,"wires":[{"id":"880944a1.3f8818","port":0},{"id":"bf4e4aad.47a508","port":0},{"id":"47cf51c3.50a2b","port":0}]},{"x":1060,"y":200,"wires":[{"id":"385bd1de.6b06ae","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"50c0ec6a.97d0f4","type":"subflow","name":"PAIRS Min-Mean-Max (4)","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"bd4ee31d.735a8"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"4256a617.d86048","port":0}]},{"x":740,"y":360,"wires":[{"id":"4256a617.d86048","port":1}]},{"x":740,"y":420,"wires":[{"id":"4256a617.d86048","port":2}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"f75a1866.de1ef8","type":"subflow","name":"PAIRS Request (8)","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"e24e1ee6.2ed03"}]}],"out":[{"x":1060,"y":40,"wires":[{"id":"915125f2.3bdce8","port":0}]},{"x":1060,"y":120,"wires":[{"id":"132cd836.c7d488","port":0},{"id":"56b4df67.5bd3b","port":0},{"id":"9627a571.c671f8","port":0}]},{"x":1060,"y":200,"wires":[{"id":"a61c8ad9.147b58","port":1}]}],"env":[{"name":"method","type":"str","value":""},{"name":"url","type":"str","value":"https://pairs.res.ibm.com/v2/"},{"name":"appendPayloadToURL","type":"bool","value":"true"},{"name":"urlSuffix","type":"str","value":""}],"color":"#0088EE","outputLabels":["result","debug","error"],"icon":"font-awesome/fa-question-circle"},{"id":"d679d351.f64ae","type":"subflow","name":"PAIRS Min-Mean-Max (5)","info":"This subflow requires an input JSON that describes the parameters of the layers, point and temporal span\n\nThe request payload is in the form:\n{\n    \"layers\": [\n        \"16100\",\n        \"49440\",\n        \"49252\",\n        \"49257\",\n        \"49304\",\n        \"49313\",\n        \"50453\",\n        \"49310\",\n        \"49311\",\n        \"49250\",\n        \"49296\"\n    ],\n    \"refPoint\": {\n        \"lat\": \"49.080609\",\n        \"lng\": \"3.961231\"\n    },\n    \"startDay\": \"2018-06-30\",\n    \"endDay\": \"2018-10-31\"\n}","category":"","in":[{"x":40,"y":180,"wires":[{"id":"dd146b09.bf13a8"}]}],"out":[{"x":740,"y":300,"wires":[{"id":"6b8840d7.4abeb","port":0}]},{"x":740,"y":360,"wires":[{"id":"6b8840d7.4abeb","port":1}]},{"x":740,"y":420,"wires":[{"id":"6b8840d7.4abeb","port":2}]}],"env":[],"color":"#0088EE","outputLabels":["response","debug","error"],"icon":"node-red/white-globe.svg"},{"id":"3268bb9d.2b7f84","type":"subflow","name":"PAIRS Query Job (4)","info":"","category":"","in":[{"x":40,"y":20,"wires":[{"id":"2fb67866.40b198"}]}],"out":[{"x":780,"y":400,"wires":[{"id":"acc70ffa.b5bc5","port":0}]},{"x":780,"y":460,"wires":[{"id":"129fc17e.68c9ef","port":1}]},{"x":760,"y":160,"wires":[{"id":"c1e74236.3401b","port":0}]},{"x":780,"y":340,"wires":[{"id":"7b6faa47.97e094","port":0}]},{"x":760,"y":100,"wires":[{"id":"b067a6e5.bf25f8","port":0},{"id":"3268bb9d.2b7f84","port":0},{"id":"efef1f9.39689e","port":0},{"id":"96e52e6b.c51d","port":1}]}],"env":[{"name":"polingDelayMs","type":"num","value":"3000"}],"color":"#0088EE","outputLabels":["querySuccess","queryFailure","queryId","queryProgress","debugMsg"]},{"id":"4d8a8909.a61068","type":"subflow","name":"PAIRS Layers Details (6)","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"33cdc3a2.1b7a4c"}]}],"out":[{"x":1000,"y":40,"wires":[{"id":"5f9921ea.f821","port":0}]},{"x":940,"y":300,"wires":[{"id":"22c33735.2944a8","port":1},{"id":"b5b3f913.5cb0b8","port":0}]},{"x":940,"y":380,"wires":[{"id":"22c33735.2944a8","port":2},{"id":"33cdc3a2.1b7a4c","port":2}]}],"env":[{"name":"layersKey","type":"str","value":"layers"}],"color":"#0088EE","inputLabels":["layers"],"outputLabels":["layersDetails","msg","error"],"icon":"node-red/debug.svg"},{"id":"37b9e0f6.a85f2","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"a2566f80.462b4","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"7847f5a7.c7b48c","order":1,"disp":true,"width":"16","collapse":false},{"id":"a67d045c.bb6038","type":"ui_group","z":0,"name":"Default","tab":"4bc43045.d5d3b","order":1,"disp":false,"width":24,"collapse":false},{"id":"4566001.f5bbd","type":"ui_group","z":0,"name":"Default","tab":"bacb64a8.5fc238","order":2,"disp":false,"width":"18","collapse":false},{"id":"d9f50cf7.e27e6","type":"ui_spacer","z":0,"name":"spacer","group":"2a1bc189.10202e","order":10,"width":1,"height":1},{"id":"5db89700.d97188","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"81eb560b.cb3438","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"9841fac.a5dd308","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"aaff1445.753488","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"54fc0fef.b9af1","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"a88186ad.5d4298","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"254be5b3.46d9da","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":3,"width":6,"height":1},{"id":"31c95578.d517ba","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":4,"width":1,"height":1},{"id":"dfd39396.c27e9","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":7,"width":1,"height":1},{"id":"71072f3e.ca36a","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":8,"width":6,"height":1},{"id":"9a228e6a.52a8d","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":13,"width":2,"height":1},{"id":"a47c069f.0f28e8","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":15,"width":2,"height":1},{"id":"6b611cab.13b594","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":17,"width":6,"height":1},{"id":"53922f39.cb13","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":18,"width":6,"height":1},{"id":"17534c60.2973f4","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":23,"width":6,"height":1},{"id":"f995197a.af1bd8","type":"ui_spacer","z":0,"name":"spacer","group":"4566001.f5bbd","order":25,"width":3,"height":1},{"id":"7847f5a7.c7b48c","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"4bc43045.d5d3b","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"d7f5a3c9.150a5","type":"ui_group","z":"","name":"Entfeuchter Chart","tab":"6e88f5e6.03c78c","order":2,"disp":true,"width":"6","collapse":false},{"id":"6e88f5e6.03c78c","type":"ui_tab","z":"","name":"Entfeuchter","icon":"dashboard","order":4},{"id":"6a6ca1a6.b8e9b","type":"ui_tab","z":"","name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"c2ca8b8c.9af0b8","type":"ui_group","z":"","name":"Default","tab":"6a6ca1a6.b8e9b","order":1,"disp":false,"width":"16","collapse":false},{"id":"4e644bce.3606b4","type":"ui_spacer","name":"spacer","group":"a67d045c.bb6038","order":21,"width":10,"height":1},{"id":"836ae620.055548","type":"ui_spacer","name":"spacer","group":"a67d045c.bb6038","order":23,"width":12,"height":1},{"id":"6f249f44.e583c","type":"ui_spacer","name":"spacer","group":"a67d045c.bb6038","order":24,"width":12,"height":1},{"id":"5c6bb160.ef105","type":"ui_spacer","name":"spacer","group":"a67d045c.bb6038","order":25,"width":12,"height":1},{"id":"6785ceaa.2e6ca","type":"ui_spacer","name":"spacer","group":"a67d045c.bb6038","order":27,"width":10,"height":1},{"id":"7d72c7d6.9fede8","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"61420303.59071c","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"706fca83.cc29e4","order":1,"disp":true,"width":"16","collapse":false},{"id":"2fad93a7.d54fec","type":"ui_group","z":0,"name":"Default","tab":"77936f58.75b1e","order":1,"disp":false,"width":24,"collapse":false},{"id":"82a4e999.141798","type":"ui_group","z":0,"name":"Default","tab":"9dfbf7d8.6582a8","order":2,"disp":false,"width":"18","collapse":false},{"id":"4f1cb7c4.dc19f8","type":"ui_spacer","z":0,"name":"spacer","group":"9d6d906d.3b96f","order":10,"width":1,"height":1},{"id":"1bdb4fad.ab132","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"26a014e5.a8edbc","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"e60b89b6.fb8d08","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"5f4e0940.6c99f8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"93f2ea55.da79e8","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"d6e15e34.e4d4e","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"dabbe73f.7627d8","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":3,"width":6,"height":1},{"id":"97cd2d37.97571","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":4,"width":1,"height":1},{"id":"e8c00f4b.8507a","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":7,"width":1,"height":1},{"id":"8914ddec.aa6b7","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":8,"width":6,"height":1},{"id":"9d4641f9.8800e","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":13,"width":2,"height":1},{"id":"ba8dfb5e.044c88","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":15,"width":2,"height":1},{"id":"b0120330.03428","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":17,"width":6,"height":1},{"id":"d193e10.006cf2","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":18,"width":6,"height":1},{"id":"e8a444ab.75a9c8","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":23,"width":6,"height":1},{"id":"995e34fa.2d1b38","type":"ui_spacer","z":0,"name":"spacer","group":"82a4e999.141798","order":25,"width":3,"height":1},{"id":"706fca83.cc29e4","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"77936f58.75b1e","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"3c9ba877.9180d8","type":"ui_group","z":"","name":"Entfeuchter Chart","tab":"a2af51d3.acb7a","order":2,"disp":true,"width":"6","collapse":false},{"id":"a2af51d3.acb7a","type":"ui_tab","z":"","name":"Entfeuchter","icon":"dashboard","order":4},{"id":"bacdc44a.3817e8","type":"ui_tab","z":"","name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"e5c6c1fb.62ea3","type":"ui_group","z":"","name":"Default","tab":"bacdc44a.3817e8","order":1,"disp":false,"width":"16","collapse":false},{"id":"dc085b06.2ad9b8","type":"ui_spacer","name":"spacer","group":"2fad93a7.d54fec","order":21,"width":10,"height":1},{"id":"85ea6f78.c3e83","type":"ui_spacer","name":"spacer","group":"2fad93a7.d54fec","order":23,"width":12,"height":1},{"id":"10caa693.40b1c9","type":"ui_spacer","name":"spacer","group":"2fad93a7.d54fec","order":24,"width":12,"height":1},{"id":"3ad05f60.a6e7e","type":"ui_spacer","name":"spacer","group":"2fad93a7.d54fec","order":25,"width":12,"height":1},{"id":"787a76a5.48ba58","type":"ui_spacer","name":"spacer","group":"2fad93a7.d54fec","order":27,"width":10,"height":1},{"id":"f06041.f45b7fc","type":"ui_base","z":0,"theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"733061b4.6b0e8","type":"ui_group","z":"b3c62114.a4d8f","name":"Default","tab":"eaeff69d.2fd2f8","order":1,"disp":false,"width":"12","collapse":false},{"id":"d3038d41.b467","type":"ui_group","z":0,"name":"Simple PAIRS","tab":"6fa3d925.d65af8","order":1,"disp":true,"width":"16","collapse":false},{"id":"ee17d09c.5ac0b","type":"ui_group","z":0,"name":"Default","tab":"2ead0958.941b96","order":1,"disp":false,"width":24,"collapse":false},{"id":"8922bb68.e4cd48","type":"ui_group","z":0,"name":"Default","tab":"17eeae6f.037662","order":2,"disp":false,"width":"18","collapse":false},{"id":"4c63c857.60bc68","type":"ui_spacer","z":0,"name":"spacer","group":"733061b4.6b0e8","order":10,"width":1,"height":1},{"id":"23aa63ce.b33a1c","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":1,"width":2,"height":1},{"id":"ae22ef84.28c4f","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":2,"width":6,"height":1},{"id":"c2f9be9f.1feeb","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":3,"width":6,"height":1},{"id":"c7d2c756.4b6d58","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":4,"width":4,"height":1},{"id":"45912c82.2f1ea4","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":5,"width":6,"height":1},{"id":"3e96017a.6cc12e","type":"ui_spacer","z":0,"name":"spacer","group":"d29b8c50.712a7","order":6,"width":6,"height":1},{"id":"f1743114.f4ce9","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":3,"width":6,"height":1},{"id":"76fc3372.c5cd6c","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":4,"width":1,"height":1},{"id":"5eabadb2.e92c64","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":7,"width":1,"height":1},{"id":"606bc891.181908","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":8,"width":6,"height":1},{"id":"e96cbbaf.701728","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":13,"width":2,"height":1},{"id":"e02982d2.7d412","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":15,"width":2,"height":1},{"id":"755940f8.c3a0f","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":17,"width":6,"height":1},{"id":"16320b07.6ed505","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":18,"width":6,"height":1},{"id":"6ee3161b.a1f588","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":23,"width":6,"height":1},{"id":"97bc77df.42f0e8","type":"ui_spacer","z":0,"name":"spacer","group":"8922bb68.e4cd48","order":25,"width":3,"height":1},{"id":"17eeae6f.037662","type":"ui_tab","z":"bd1591bd.1605c","name":"PAIRS Explorer","icon":"fa-search","order":2,"disabled":false,"hidden":false},{"id":"eaeff69d.2fd2f8","type":"ui_tab","z":"b3c62114.a4d8f","name":"Map Widget","icon":"fa-map-o","order":3,"disabled":false,"hidden":false},{"id":"6fa3d925.d65af8","type":"ui_tab","z":0,"name":"Simple PAIRS","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"2ead0958.941b96","type":"ui_tab","z":0,"name":"Viti View","icon":"fa-glass","order":1,"disabled":false,"hidden":false},{"id":"fece357f.82bcc8","type":"ui_group","z":"","name":"Entfeuchter Chart","tab":"b626bacc.d5b718","order":2,"disp":true,"width":"6","collapse":false},{"id":"b626bacc.d5b718","type":"ui_tab","z":"","name":"Entfeuchter","icon":"dashboard","order":4},{"id":"fe08ed6d.c2841","type":"ui_tab","z":"","name":"Test Bootstrap","icon":"dashboard","disabled":false,"hidden":false},{"id":"52fc2436.51b34c","type":"ui_group","z":"","name":"Default","tab":"fe08ed6d.c2841","order":1,"disp":false,"width":"16","collapse":false},{"id":"3bd3c72f.12dc68","type":"ui_spacer","name":"spacer","group":"ee17d09c.5ac0b","order":21,"width":10,"height":1},{"id":"5653407f.a2dcb","type":"ui_spacer","name":"spacer","group":"ee17d09c.5ac0b","order":23,"width":12,"height":1},{"id":"f5c87730.9bc4e8","type":"ui_spacer","name":"spacer","group":"ee17d09c.5ac0b","order":24,"width":12,"height":1},{"id":"fe0996bb.27d668","type":"ui_spacer","name":"spacer","group":"ee17d09c.5ac0b","order":25,"width":12,"height":1},{"id":"8aa6f503.437ba8","type":"ui_spacer","name":"spacer","group":"ee17d09c.5ac0b","order":27,"width":10,"height":1},{"id":"951c687e.a57d38","type":"http request","z":"f7a7a0b8.760b3","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["c43da069.17258"]]},{"id":"19913a0d.121dd6","type":"inject","z":"6df36e9b.8f203","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":160,"y":120,"wires":[["19e7698f.be4956"]]},{"id":"c71a2497.674718","type":"change","z":"6df36e9b.8f203","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":200,"wires":[["c5517a27.0c2fe8"]]},{"id":"19e7698f.be4956","type":"subflow:f7a7a0b8.760b3","z":"6df36e9b.8f203","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":490,"y":80,"wires":[["3ddc29ae.74e026"],[],[]]},{"id":"3771ffd3.e2496","type":"change","z":"f7a7a0b8.760b3","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["951c687e.a57d38"]]},{"id":"dc74fde5.e884f","type":"subflow:f7a7a0b8.760b3","z":"6df36e9b.8f203","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":480,"y":300,"wires":[["29e9b64f.d413da"],[],[]]},{"id":"3ddc29ae.74e026","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":110,"y":180,"wires":[["c71a2497.674718","bdaf8767.c47d98"]]},{"id":"3092a7a3.4373b8","type":"switch","z":"f7a7a0b8.760b3","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["ff3b5ccb.dfca4"],["3771ffd3.e2496"]]},{"id":"3e05e867.58bb98","type":"change","z":"f7a7a0b8.760b3","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["951c687e.a57d38"]]},{"id":"29e9b64f.d413da","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":650,"y":300,"wires":[["dacc29d6.b8d258"]]},{"id":"186c481f.e7cf48","type":"delay","z":"6df36e9b.8f203","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":300,"wires":[["dc74fde5.e884f"]]},{"id":"dacc29d6.b8d258","type":"switch","z":"6df36e9b.8f203","name":"Test not ready","property":"payload.ready","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":140,"y":380,"wires":[["c71a2497.674718"],["b3f5dcd.085522"]],"outputLabels":["not ready","ready"]},{"id":"bcb9c3fa.d9096","type":"inject","z":"6df36e9b.8f203","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":140,"y":80,"wires":[["19e7698f.be4956"]]},{"id":"c39e3181.4061","type":"subflow:f7a7a0b8.760b3","z":"fac93a33.099aa8","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":330,"y":360,"wires":[["c5bbd50a.eed5e8"],[],[]]},{"id":"9c19a3c6.e0c29","type":"json","z":"fac93a33.099aa8","name":"","property":"payload","action":"","pretty":false,"x":630,"y":300,"wires":[[]]},{"id":"ff3b5ccb.dfca4","type":"switch","z":"f7a7a0b8.760b3","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["3e05e867.58bb98"],["3771ffd3.e2496"]]},{"id":"38f35b82.d1a314","type":"template","z":"fac93a33.099aa8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["cd6450aa.c06f6"]]},{"id":"a0d1aece.92c32","type":"json","z":"fac93a33.099aa8","name":"","property":"payload","action":"","pretty":false,"x":310,"y":300,"wires":[["c39e3181.4061"]]},{"id":"cd6450aa.c06f6","type":"function","z":"fac93a33.099aa8","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":240,"wires":[["a0d1aece.92c32"]]},{"id":"c5517a27.0c2fe8","type":"change","z":"6df36e9b.8f203","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":300,"wires":[["186c481f.e7cf48"]]},{"id":"b3f5dcd.085522","type":"switch","z":"6df36e9b.8f203","name":"Test success","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":380,"wires":[["997a38a1.fb2ec8"],[]],"outputLabels":["Succeeded","Failed"]},{"id":"f0291164.cf42","type":"template","z":"6df36e9b.8f203","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"NodeRED_Ref {{payload.pos.lat}}-{{payload.pos.lng}}\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \"alias\": \"{{.}}_Mean\",\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": \"38662\"\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":180,"y":20,"wires":[["6f4b9477.d10bfc"]]},{"id":"6f4b9477.d10bfc","type":"function","z":"6df36e9b.8f203","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":20,"wires":[["8d344825.1fd0e8"]]},{"id":"8d344825.1fd0e8","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":450,"y":20,"wires":[["19e7698f.be4956"]]},{"id":"bdaf8767.c47d98","type":"change","z":"6df36e9b.8f203","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":160,"wires":[[]]},{"id":"997a38a1.fb2ec8","type":"json","z":"6df36e9b.8f203","name":"","property":"payload","action":"","pretty":false,"x":650,"y":380,"wires":[[]]},{"id":"35ebbce9.630e44","type":"comment","z":"fac93a33.099aa8","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"c5bbd50a.eed5e8","type":"switch","z":"fac93a33.099aa8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":320,"wires":[["9c19a3c6.e0c29"],[]],"outputLabels":["ok","error"]},{"id":"c43da069.17258","type":"switch","z":"f7a7a0b8.760b3","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[[],[]],"outputLabels":["ok","error"]},{"id":"a287a631.4007d8","type":"subflow:f7a7a0b8.760b3","z":"f1fd9488.28e628","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["4fd04327.b305dc"],[],[]]},{"id":"9f317e87.5c23","type":"split","z":"f1fd9488.28e628","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["a287a631.4007d8"]]},{"id":"b8139087.08769","type":"change","z":"f1fd9488.28e628","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["9f317e87.5c23"]]},{"id":"4fd04327.b305dc","type":"join","z":"f1fd9488.28e628","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":810,"y":40,"wires":[[]]},{"id":"e29f9bc8.fae6d8","type":"switch","z":"f1fd9488.28e628","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["b8139087.08769"],["9f317e87.5c23"],[]]},{"id":"72f8859b.d2864c","type":"comment","z":"f1fd9488.28e628","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"3855e065.b4361","type":"http request","z":"f672aa41.a0e548","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["a1760cb0.1867"]]},{"id":"425a2fe6.7140d","type":"inject","z":"a0989afc.3a50e8","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":160,"y":120,"wires":[["b15a9189.c3618"]]},{"id":"37bada9c.329536","type":"change","z":"a0989afc.3a50e8","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":200,"wires":[["fc1ecbb2.ee8108"]]},{"id":"b15a9189.c3618","type":"subflow:f672aa41.a0e548","z":"a0989afc.3a50e8","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":490,"y":80,"wires":[["a5289d94.1b82a"],[],[]]},{"id":"7363ffeb.948b4","type":"change","z":"f672aa41.a0e548","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["3855e065.b4361"]]},{"id":"1fab01bc.0472ae","type":"subflow:f672aa41.a0e548","z":"a0989afc.3a50e8","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":480,"y":300,"wires":[["15f1f19c.23c6de"],[],[]]},{"id":"a5289d94.1b82a","type":"json","z":"a0989afc.3a50e8","name":"","property":"payload","action":"","pretty":false,"x":110,"y":180,"wires":[["37bada9c.329536","c0ede998.84b008"]]},{"id":"76ec1999.68c598","type":"switch","z":"f672aa41.a0e548","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["4405267b.4f3d08"],["7363ffeb.948b4"]]},{"id":"96029e8b.f6e45","type":"change","z":"f672aa41.a0e548","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["3855e065.b4361"]]},{"id":"4e6fdf5d.b3e05","type":"delay","z":"a0989afc.3a50e8","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":300,"wires":[["1fab01bc.0472ae"]]},{"id":"15f1f19c.23c6de","type":"switch","z":"a0989afc.3a50e8","name":"Test not ready","property":"payload.ready","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":140,"y":380,"wires":[["37bada9c.329536"],["67900531.5342ec"]],"outputLabels":["not ready","ready"]},{"id":"96be4ad0.0bf508","type":"inject","z":"a0989afc.3a50e8","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":140,"y":80,"wires":[["b15a9189.c3618"]]},{"id":"5890ea17.dc3844","type":"subflow:f672aa41.a0e548","z":"5bd6abcd.e7feb4","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":510,"y":360,"wires":[[],[],[]]},{"id":"4405267b.4f3d08","type":"switch","z":"f672aa41.a0e548","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["96029e8b.f6e45"],["7363ffeb.948b4"]]},{"id":"398a80b9.6e014","type":"template","z":"5bd6abcd.e7feb4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["3c4d5af7.44e246"]]},{"id":"7e876e06.9364a","type":"json","z":"5bd6abcd.e7feb4","name":"","property":"payload","action":"","pretty":false,"x":310,"y":360,"wires":[["5890ea17.dc3844"]]},{"id":"3c4d5af7.44e246","type":"function","z":"5bd6abcd.e7feb4","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":260,"wires":[["7e876e06.9364a"]]},{"id":"fc1ecbb2.ee8108","type":"change","z":"a0989afc.3a50e8","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":300,"wires":[["4e6fdf5d.b3e05"]]},{"id":"67900531.5342ec","type":"switch","z":"a0989afc.3a50e8","name":"Test success","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":380,"wires":[["b66cb3d3.ae24f"],[]],"outputLabels":["Succeeded","Failed"]},{"id":"a89918f5.c9ad08","type":"template","z":"a0989afc.3a50e8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"NodeRED_Ref {{payload.pos.lat}}-{{payload.pos.lng}}\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \"alias\": \"{{.}}_Mean\",\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": \"38662\"\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":180,"y":20,"wires":[["66621bc2.05b9b4"]]},{"id":"66621bc2.05b9b4","type":"function","z":"a0989afc.3a50e8","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":20,"wires":[["21ba9ddf.623872"]]},{"id":"21ba9ddf.623872","type":"json","z":"a0989afc.3a50e8","name":"","property":"payload","action":"","pretty":false,"x":450,"y":20,"wires":[["b15a9189.c3618"]]},{"id":"c0ede998.84b008","type":"change","z":"a0989afc.3a50e8","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":160,"wires":[[]]},{"id":"b66cb3d3.ae24f","type":"json","z":"a0989afc.3a50e8","name":"","property":"payload","action":"","pretty":false,"x":650,"y":380,"wires":[[]]},{"id":"82c2f844.a10468","type":"comment","z":"5bd6abcd.e7feb4","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"a1760cb0.1867","type":"switch","z":"f672aa41.a0e548","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["8d7fb6ad.e41038"],[]],"outputLabels":["ok","error"]},{"id":"37c172b8.2b8e1e","type":"subflow:f672aa41.a0e548","z":"aeafb445.a67ee8","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["5a8d087d.702bb8"],[],[]]},{"id":"d670a259.98141","type":"split","z":"aeafb445.a67ee8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["37c172b8.2b8e1e"]]},{"id":"adb766.308ca898","type":"change","z":"aeafb445.a67ee8","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["d670a259.98141"]]},{"id":"5a8d087d.702bb8","type":"join","z":"aeafb445.a67ee8","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":80,"wires":[[]]},{"id":"306d6d70.269e52","type":"switch","z":"aeafb445.a67ee8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["adb766.308ca898"],["d670a259.98141"],[]]},{"id":"ebaa71e3.de883","type":"comment","z":"aeafb445.a67ee8","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"8d7fb6ad.e41038","type":"json","z":"f672aa41.a0e548","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"f0d9bbc3.6462a8","type":"http request","z":"11ec3db7.1beab2","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["74526457.1261dc"]]},{"id":"f6fa077e.3dabd8","type":"change","z":"11ec3db7.1beab2","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["f0d9bbc3.6462a8"]]},{"id":"f87a57fc.bb5678","type":"switch","z":"11ec3db7.1beab2","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["bb2c94f.ca6e268"],["f6fa077e.3dabd8"]]},{"id":"54a3d8b4.f27ab8","type":"change","z":"11ec3db7.1beab2","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["f0d9bbc3.6462a8"]]},{"id":"bb2c94f.ca6e268","type":"switch","z":"11ec3db7.1beab2","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["54a3d8b4.f27ab8"],["f6fa077e.3dabd8"]]},{"id":"74526457.1261dc","type":"switch","z":"11ec3db7.1beab2","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["cd61e965.359538"],[]],"outputLabels":["ok","error"]},{"id":"cd61e965.359538","type":"json","z":"11ec3db7.1beab2","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"1e52eb4f.a422b5","type":"subflow:11ec3db7.1beab2","z":"848340f0.73ab7","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["7535651e.35423c"],[],[]]},{"id":"a2ef5ae4.157348","type":"split","z":"848340f0.73ab7","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["1e52eb4f.a422b5"]]},{"id":"590f79cc.0c1ca8","type":"change","z":"848340f0.73ab7","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["a2ef5ae4.157348"]]},{"id":"7535651e.35423c","type":"join","z":"848340f0.73ab7","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":80,"wires":[[]]},{"id":"27ea7e18.78ff02","type":"switch","z":"848340f0.73ab7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["590f79cc.0c1ca8"],["a2ef5ae4.157348"],[]]},{"id":"81a969a7.6b0e28","type":"comment","z":"848340f0.73ab7","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"c238ae11.519ba","type":"http request","z":"f4cca687.d938c8","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["fb03207.06ff7e"]]},{"id":"9c4bdf30.02b63","type":"change","z":"f4cca687.d938c8","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["c238ae11.519ba"]]},{"id":"2ab086ea.5d010a","type":"switch","z":"f4cca687.d938c8","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["b6604fb3.07521"],["9c4bdf30.02b63"]]},{"id":"458e27e7.a4bc78","type":"change","z":"f4cca687.d938c8","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["c238ae11.519ba"]]},{"id":"b6604fb3.07521","type":"switch","z":"f4cca687.d938c8","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["458e27e7.a4bc78"],["9c4bdf30.02b63"]]},{"id":"fb03207.06ff7e","type":"switch","z":"f4cca687.d938c8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["f9b5d2d3.02b6"],[]],"outputLabels":["ok","error"]},{"id":"f9b5d2d3.02b6","type":"json","z":"f4cca687.d938c8","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"3e627991.916276","type":"subflow:f4cca687.d938c8","z":"8a1a5b07.e36c58","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":510,"y":360,"wires":[[],[],[]]},{"id":"c283998.f3ba268","type":"template","z":"8a1a5b07.e36c58","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["e92737f.841bec8"]]},{"id":"bdf3451f.b44528","type":"json","z":"8a1a5b07.e36c58","name":"","property":"payload","action":"","pretty":false,"x":310,"y":360,"wires":[["3e627991.916276"]]},{"id":"e92737f.841bec8","type":"function","z":"8a1a5b07.e36c58","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":260,"wires":[["bdf3451f.b44528"]]},{"id":"b6c75e0b.959c5","type":"comment","z":"8a1a5b07.e36c58","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"13bc16db.91d729","type":"http request","z":"c1acda6c.e51908","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["27dc2add.3f06c6"]]},{"id":"8066e32e.4574","type":"change","z":"c1acda6c.e51908","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["13bc16db.91d729"]]},{"id":"93154a02.0cd728","type":"switch","z":"c1acda6c.e51908","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["2f1c41b6.c5831e"],["8066e32e.4574"]]},{"id":"66f33eeb.9a497","type":"change","z":"c1acda6c.e51908","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["13bc16db.91d729"]]},{"id":"2f1c41b6.c5831e","type":"switch","z":"c1acda6c.e51908","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["66f33eeb.9a497"],["8066e32e.4574"]]},{"id":"27dc2add.3f06c6","type":"switch","z":"c1acda6c.e51908","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["4ae59485.01116c"],[]],"outputLabels":["ok","error"]},{"id":"4ae59485.01116c","type":"json","z":"c1acda6c.e51908","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"f9260528.45f5e8","type":"inject","z":"2efea337.47aa4c","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":160,"y":120,"wires":[["f91bb13d.082f9"]]},{"id":"9ebd225b.5f173","type":"change","z":"2efea337.47aa4c","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":200,"wires":[["96d71b0e.bf0018"]]},{"id":"f91bb13d.082f9","type":"subflow:c1acda6c.e51908","z":"2efea337.47aa4c","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":490,"y":80,"wires":[["56b8560b.b8b1d8"],[],[]]},{"id":"aa247b9b.5b91a8","type":"subflow:c1acda6c.e51908","z":"2efea337.47aa4c","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":480,"y":300,"wires":[["7ed4984a.5b78d8"],[],[]]},{"id":"56b8560b.b8b1d8","type":"json","z":"2efea337.47aa4c","name":"","property":"payload","action":"","pretty":false,"x":110,"y":180,"wires":[["9ebd225b.5f173","81e5d59c.108d88"]]},{"id":"c81c5e1.2eaa8a","type":"delay","z":"2efea337.47aa4c","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":300,"wires":[["aa247b9b.5b91a8"]]},{"id":"7ed4984a.5b78d8","type":"switch","z":"2efea337.47aa4c","name":"Test not ready","property":"payload.ready","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":140,"y":380,"wires":[["9ebd225b.5f173"],["e246b037.8f29"]],"outputLabels":["not ready","ready"]},{"id":"6f29603b.88dfe","type":"inject","z":"2efea337.47aa4c","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":140,"y":80,"wires":[["f91bb13d.082f9"]]},{"id":"96d71b0e.bf0018","type":"change","z":"2efea337.47aa4c","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":300,"wires":[["c81c5e1.2eaa8a"]]},{"id":"e246b037.8f29","type":"switch","z":"2efea337.47aa4c","name":"Test success","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":380,"wires":[["efcd011e.b54e9"],[]],"outputLabels":["Succeeded","Failed"]},{"id":"dc79c951.f43668","type":"template","z":"2efea337.47aa4c","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"NodeRED_Ref {{payload.pos.lat}}-{{payload.pos.lng}}\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \"alias\": \"{{.}}_Mean\",\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": \"38662\"\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":180,"y":20,"wires":[["ad56a327.26343"]]},{"id":"ad56a327.26343","type":"function","z":"2efea337.47aa4c","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":20,"wires":[["e17a6920.c8fd68"]]},{"id":"e17a6920.c8fd68","type":"json","z":"2efea337.47aa4c","name":"","property":"payload","action":"","pretty":false,"x":450,"y":20,"wires":[["f91bb13d.082f9"]]},{"id":"81e5d59c.108d88","type":"change","z":"2efea337.47aa4c","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":160,"wires":[[]]},{"id":"efcd011e.b54e9","type":"json","z":"2efea337.47aa4c","name":"","property":"payload","action":"","pretty":false,"x":650,"y":380,"wires":[[]]},{"id":"143f73d2.6e95bc","type":"subflow:85bc446.b6594b8","z":"433cfd53.54f5b4","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["8877d7a8.4d65b8"],[],[]]},{"id":"70240837.bde258","type":"split","z":"433cfd53.54f5b4","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["143f73d2.6e95bc"]]},{"id":"2bb91ca0.18f1b4","type":"change","z":"433cfd53.54f5b4","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["70240837.bde258"]]},{"id":"8877d7a8.4d65b8","type":"join","z":"433cfd53.54f5b4","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":80,"wires":[[]]},{"id":"cea8a4da.fdd398","type":"switch","z":"433cfd53.54f5b4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["2bb91ca0.18f1b4"],["70240837.bde258"],[]]},{"id":"4eed5c11.152b04","type":"comment","z":"433cfd53.54f5b4","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"4e749f9d.13da2","type":"http request","z":"85bc446.b6594b8","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["42cba1e4.1c9ac"]]},{"id":"d4d8cfa8.ad402","type":"change","z":"85bc446.b6594b8","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["4e749f9d.13da2"]]},{"id":"befb7a48.efd2b8","type":"switch","z":"85bc446.b6594b8","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["6aefb81b.d315b8"],["d4d8cfa8.ad402"]]},{"id":"d98bf367.775b8","type":"change","z":"85bc446.b6594b8","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["4e749f9d.13da2"]]},{"id":"6aefb81b.d315b8","type":"switch","z":"85bc446.b6594b8","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["d98bf367.775b8"],["d4d8cfa8.ad402"]]},{"id":"42cba1e4.1c9ac","type":"switch","z":"85bc446.b6594b8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["576bf6ff.488a08"],[]],"outputLabels":["ok","error"]},{"id":"576bf6ff.488a08","type":"json","z":"85bc446.b6594b8","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"89271d39.855aa","type":"subflow:85bc446.b6594b8","z":"71d70215.15017c","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":510,"y":360,"wires":[[],[],[]]},{"id":"edf36c67.91ddd","type":"template","z":"71d70215.15017c","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["9f6d5121.ec11f"]]},{"id":"e25b850d.3d3078","type":"json","z":"71d70215.15017c","name":"","property":"payload","action":"","pretty":false,"x":310,"y":360,"wires":[["89271d39.855aa"]]},{"id":"9f6d5121.ec11f","type":"function","z":"71d70215.15017c","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":260,"wires":[["e25b850d.3d3078"]]},{"id":"f2f25d1f.967cb","type":"comment","z":"71d70215.15017c","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"628e8b66.e14104","type":"subflow:bd9a9168.054b1","z":"91448b6c.d2cb58","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["5d6e967b.006d88"],[],[]]},{"id":"2c3ffc5b.0b0fb4","type":"split","z":"91448b6c.d2cb58","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["628e8b66.e14104"]]},{"id":"4c7fb406.51491c","type":"change","z":"91448b6c.d2cb58","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["2c3ffc5b.0b0fb4"]]},{"id":"5d6e967b.006d88","type":"join","z":"91448b6c.d2cb58","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":80,"wires":[[]]},{"id":"39268a51.361ad6","type":"switch","z":"91448b6c.d2cb58","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["4c7fb406.51491c"],["2c3ffc5b.0b0fb4"],[]]},{"id":"9fa5b1f8.3b9a3","type":"comment","z":"91448b6c.d2cb58","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"47cf51c3.50a2b","type":"http request","z":"bd9a9168.054b1","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["385bd1de.6b06ae"]]},{"id":"880944a1.3f8818","type":"change","z":"bd9a9168.054b1","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["47cf51c3.50a2b"]]},{"id":"61c4035c.a31fec","type":"switch","z":"bd9a9168.054b1","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["69c4416f.330ba"],["880944a1.3f8818"]]},{"id":"bf4e4aad.47a508","type":"change","z":"bd9a9168.054b1","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["47cf51c3.50a2b"]]},{"id":"69c4416f.330ba","type":"switch","z":"bd9a9168.054b1","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["bf4e4aad.47a508"],["880944a1.3f8818"]]},{"id":"385bd1de.6b06ae","type":"switch","z":"bd9a9168.054b1","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["71800840.cde058"],[]],"outputLabels":["ok","error"]},{"id":"71800840.cde058","type":"json","z":"bd9a9168.054b1","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"4256a617.d86048","type":"subflow:bd9a9168.054b1","z":"50c0ec6a.97d0f4","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":510,"y":360,"wires":[[],[],[]]},{"id":"bd4ee31d.735a8","type":"template","z":"50c0ec6a.97d0f4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["7d156728.3dcab8"]]},{"id":"53868359.e9ed5c","type":"json","z":"50c0ec6a.97d0f4","name":"","property":"payload","action":"","pretty":false,"x":310,"y":360,"wires":[["4256a617.d86048"]]},{"id":"7d156728.3dcab8","type":"function","z":"50c0ec6a.97d0f4","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":260,"wires":[["53868359.e9ed5c"]]},{"id":"3e1c5c21.e141b4","type":"comment","z":"50c0ec6a.97d0f4","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"f6e4d504.a034b8","type":"debug","z":"bd1591bd.1605c","name":"","active":false,"console":"false","complete":"true","x":510,"y":40,"wires":[]},{"id":"b3a55fa0.1adda","type":"json","z":"bd1591bd.1605c","name":"","property":"payload","action":"str","pretty":false,"x":330,"y":40,"wires":[["ec0bb961.0994d8","f6e4d504.a034b8"]]},{"id":"fd3bcb70.f78af8","type":"inject","z":"b3c62114.a4d8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"","payloadType":"str","x":160,"y":120,"wires":[["a2f08fd9.3987f"]]},{"id":"a2f08fd9.3987f","type":"function","z":"b3c62114.a4d8f","name":"Generate Mike random movements","func":"// create random position\nvar lat = 51 + Math.random() * 0.2;\nvar lon = -1.45 + Math.random() * 0.2;\nmsg.payload={\n    lat:lat, \n    lon:lon, \n    name:\"Mike\", \n    icon:\"male\", \n    color:\"#000\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":180,"wires":[["e579a286.5a8a9","8c3bb2c3.086a4"]]},{"id":"24c37cf6.eb6ba4","type":"comment","z":"b3c62114.a4d8f","name":"How to embed Map in Dashboard","info":"This example shows how to embed the Worldmap \ninto a template node within the `node-red-dashboard`\n\nThe first flow creates a dashboard button that \ngenerates a randon position, with the required \nicon, and passes that to the worldmap. The\nmap is configured to automatically pan to the\nposition of any point that arrives.\n\nThe second flow initialise the dashboard template\nwith the initial map and sets it to a more square shape\nby adjusting the height.","x":210,"y":60,"wires":[]},{"id":"78b23bfd.8a6544","type":"debug","z":"b3c62114.a4d8f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":720,"y":400,"wires":[]},{"id":"ec0bb961.0994d8","type":"switch","z":"bd1591bd.1605c","name":"","property":"msg","propertyType":"jsonata","rules":[{"t":"hask","v":"mousePos","vt":"str"},{"t":"hask","v":"dimChange","vt":"str"},{"t":"hask","v":"initMap","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":330,"y":100,"wires":[["f21e6dbf.1c8d1","25e9257.2c46bda"],["fa969adc.640da8"],["1cd53eb.0d0abc1"]]},{"id":"fa969adc.640da8","type":"change","z":"bd1591bd.1605c","name":"","rules":[{"t":"set","p":"lastDim","pt":"flow","to":"dimChange","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":260,"wires":[["c0eb8015.7801f","1e8cd204.2ded4e","a715803b.414a4","b83f6091.478f5"]]},{"id":"7bd50adb.146f14","type":"change","z":"bd1591bd.1605c","name":"setDim from flow","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setDim\": $flowContext(\"lastDim\")\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":280,"wires":[["1f4a6a37.d29136","9098bd27.dd312"]]},{"id":"525eefa6.e81f4","type":"debug","z":"bd1591bd.1605c","name":"","active":true,"console":"false","complete":"true","x":250,"y":560,"wires":[]},{"id":"39519a22.7b8576","type":"catch","z":"bd1591bd.1605c","name":"","scope":null,"uncaught":false,"x":100,"y":560,"wires":[["525eefa6.e81f4"]]},{"id":"48bc6448.1d8c2c","type":"change","z":"bd1591bd.1605c","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Nitro\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":320,"wires":[["9098bd27.dd312","2f44ad0b.b502c2"]]},{"id":"d5faa548.58cce8","type":"debug","z":"84950fca.868f2","name":"","active":false,"console":"false","complete":"true","x":450,"y":160,"wires":[]},{"id":"ead7baef.379328","type":"json","z":"84950fca.868f2","name":"","property":"payload","action":"str","pretty":false,"x":290,"y":160,"wires":[["ad5aa325.41ebb","d5faa548.58cce8"]]},{"id":"ad5aa325.41ebb","type":"switch","z":"84950fca.868f2","name":"","property":"msg","propertyType":"jsonata","rules":[{"t":"hask","v":"mousePos","vt":"str"},{"t":"hask","v":"dimChange","vt":"str"},{"t":"hask","v":"initMap","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":220,"wires":[["f5e46c4d.50965","ed959374.30d9","b6ce2c06.d67ee"],["8ad0b19b.3046c"],["80a712d5.86ddd","718d43c8.a1e17c"]]},{"id":"8ad0b19b.3046c","type":"change","z":"84950fca.868f2","name":"","rules":[{"t":"set","p":"lastDim","pt":"flow","to":"dimChange","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":200,"wires":[["1856b78e.aa6e78","e32edc6d.aa0db","3d99662c.69100a"]]},{"id":"e77e2982.00d388","type":"change","z":"84950fca.868f2","name":"setDim from flow","rules":[{"t":"set","p":"payload.setDim","pt":"msg","to":"lastDim","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":440,"wires":[["1ed2c7f4.b4acd8","182d990.f19c767"]]},{"id":"8671b5d8.37c488","type":"debug","z":"84950fca.868f2","name":"","active":false,"console":"false","complete":"true","x":250,"y":780,"wires":[]},{"id":"bac295b7.dfafe8","type":"catch","z":"84950fca.868f2","name":"","scope":null,"uncaught":false,"x":80,"y":780,"wires":[["8671b5d8.37c488"]]},{"id":"bfc3cb07.222658","type":"change","z":"84950fca.868f2","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Nitro\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":380,"wires":[["182d990.f19c767"]]},{"id":"55e76ea2.767e","type":"change","z":"84950fca.868f2","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Popul\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":340,"wires":[["182d990.f19c767"]]},{"id":"80a712d5.86ddd","type":"change","z":"84950fca.868f2","name":"SetRefPoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"setDim\": {\t        \"zoom\": \"14\",\t        \"pos\": $flowContext(\"refData\").pos,\t        \"type\": \"initMap\",\t        \"mapId\": msg.payload.mapId\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":110,"y":80,"wires":[["1ed2c7f4.b4acd8","182d990.f19c767","8f92881.6704278"]]},{"id":"7a26795f.52b8d8","type":"change","z":"84950fca.868f2","name":"En Nitro","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["71a1ac20.9ddfe4"]]},{"id":"5333c154.127b4","type":"change","z":"84950fca.868f2","name":"En Popul","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":340,"wires":[["513c20c3.63ce"]]},{"id":"15c7c87a.8f0208","type":"inject","z":"84950fca.868f2","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0.4","payloadType":"num","x":90,"y":300,"wires":[["513c20c3.63ce","71a1ac20.9ddfe4"]]},{"id":"e956f55f.5c6718","type":"change","z":"bd1591bd.1605c","name":"setOpacity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t\"setOpacity\": {\t    \"layer\":\"Popul\",\t    \"opacity\": payload\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":380,"wires":[["9098bd27.dd312"]]},{"id":"71b8331a.e1285c","type":"change","z":"bd1591bd.1605c","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["41c711de.8f42b"]]},{"id":"db8ee886.e53668","type":"change","z":"bd1591bd.1605c","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["9b4bb378.1113e"]]},{"id":"2f44ad0b.b502c2","type":"debug","z":"bd1591bd.1605c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":440,"wires":[]},{"id":"1cd53eb.0d0abc1","type":"change","z":"bd1591bd.1605c","name":"SetRefPoint","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"setDim\": {\t        \"zoom\": \"13\",\t        \"pos\": {\t            \"lat\": \"48.204550\",\t            \"lng\": \"16.364333\"\t        },\t        \"type\": \"initMap\",\t        \"mapId\": msg.payload.mapId\t    }\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":110,"y":20,"wires":[["9098bd27.dd312"]]},{"id":"9627a571.c671f8","type":"http request","z":"f75a1866.de1ef8","name":"","method":"use","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":100,"wires":[["a61c8ad9.147b58"]]},{"id":"7b76fbd9.bd1624","type":"inject","z":"3268bb9d.2b7f84","name":"Large query-Don't use!","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"51\"}],\"spatial\":{\"type\":\"square\",\"coordinates\":[\"35.6523\",\"-87.62\",\"51.6523\",\"-71.62\"]},\"temporal\":{\"intervals\":[{\"snapshot\":\"2018-05-31T00:00:00Z\"}]}}","payloadType":"json","x":160,"y":120,"wires":[["b067a6e5.bf25f8"]]},{"id":"b9a6faaa.35fe68","type":"change","z":"3268bb9d.2b7f84","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":200,"wires":[["5f616f2e.ed052"]]},{"id":"b067a6e5.bf25f8","type":"subflow:f75a1866.de1ef8","z":"3268bb9d.2b7f84","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"}],"x":490,"y":80,"wires":[["7a3f705.cce339"],[],[]]},{"id":"132cd836.c7d488","type":"change","z":"f75a1866.de1ef8","name":"Payload as data","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"url","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":100,"wires":[["9627a571.c671f8"]]},{"id":"96e52e6b.c51d","type":"subflow:f75a1866.de1ef8","z":"3268bb9d.2b7f84","name":"GET queryjobs","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"}],"x":480,"y":300,"wires":[["7b6faa47.97e094"],[],[]]},{"id":"7a3f705.cce339","type":"json","z":"3268bb9d.2b7f84","name":"","property":"payload","action":"","pretty":false,"x":110,"y":180,"wires":[["b9a6faaa.35fe68","c1e74236.3401b"]]},{"id":"e24e1ee6.2ed03","type":"switch","z":"f75a1866.de1ef8","name":"","property":"method","propertyType":"env","rules":[{"t":"eq","v":"GET","vt":"str"},{"t":"eq","v":"POST","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":80,"wires":[["7728cc65.2d3a54"],["132cd836.c7d488"]]},{"id":"56b4df67.5bd3b","type":"change","z":"f75a1866.de1ef8","name":"Payload appended to URL","rules":[{"t":"set","p":"method","pt":"msg","to":"method","tot":"env"},{"t":"set","p":"url","pt":"msg","to":"$join([$env(\"url\"),payload,$env(\"urlSuffix\")])\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":20,"wires":[["9627a571.c671f8"]]},{"id":"e52f176.42823e8","type":"delay","z":"3268bb9d.2b7f84","name":"","pauseType":"delayv","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":300,"wires":[["96e52e6b.c51d"]]},{"id":"7b6faa47.97e094","type":"switch","z":"3268bb9d.2b7f84","name":"Test not ready","property":"payload.ready","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":140,"y":380,"wires":[["b9a6faaa.35fe68"],["129fc17e.68c9ef"]],"outputLabels":["not ready","ready"]},{"id":"11f57aca.7e4175","type":"subflow:f75a1866.de1ef8","z":"a09c9932.979aa8","name":"GET queryjobs/download/","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/download/","type":"str"}],"x":390,"y":600,"wires":[["2ef29f93.f608f"],["9929b9eb.0bad58"],["1ef9e26d.110e5e"]]},{"id":"7bb0c822.d8aaf8","type":"switch","z":"a09c9932.979aa8","name":"","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":20,"wires":[[],[]],"outputLabels":["Succeeded","Failed"]},{"id":"b1d39db7.7a612","type":"change","z":"a09c9932.979aa8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":100,"y":560,"wires":[["11f57aca.7e4175"]]},{"id":"854d969e.d7fe88","type":"inject","z":"a09c9932.979aa8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"lastQuery","payloadType":"flow","x":110,"y":620,"wires":[["11f57aca.7e4175"]]},{"id":"20be4e29.200082","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":5,"width":6,"height":1,"passthru":false,"label":"Move Mike","tooltip":"","color":"","bgcolor":"","icon":"fa-male","payload":"","payloadType":"str","topic":"","x":160,"y":180,"wires":[["a2f08fd9.3987f"]]},{"id":"26b5ab07.658cd4","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":4,"width":2,"height":1,"passthru":false,"label":"Hide all","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"layer\":\"none\"}}","payloadType":"json","topic":"","x":170,"y":320,"wires":[["e579a286.5a8a9"]]},{"id":"e27225c9.1115a8","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":3,"width":2,"height":1,"passthru":false,"label":"Delete","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"delete\":[\"Watercolor\",\"ship nav\",\"heatmap\",\"Terrain\",\"UK OS 1900\",\"UK OS 1919-47\"]}}}","payloadType":"json","topic":"","x":180,"y":420,"wires":[["e579a286.5a8a9"]]},{"id":"25efafc3.2a96f","type":"ui_button","z":"bd1591bd.1605c","name":"","group":"8922bb68.e4cd48","order":14,"width":2,"height":1,"passthru":false,"label":"Align coords","tooltip":"","color":"","bgcolor":"","icon":"","payload":"lastDim","payloadType":"flow","topic":"","x":730,"y":280,"wires":[["7bd50adb.146f14"]]},{"id":"263d2fc4.1b4ee","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":7,"width":3,"height":1,"passthru":false,"label":"NowCoast","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"NowCoast\",\"url\":\"https://nowcoast.noaa.gov/arcgis/services/nowcoast/radar_meteo_imagery_nexrad_time/MapServer/WmsServer?\",\"opt\":{\"layers\":\"1\",\"format\":\"image/png\",\"transparent\":true,\"attribution\":\"NOAA/NWS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":160,"y":500,"wires":[["e579a286.5a8a9"]]},{"id":"984bd937.9a65c8","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":8,"width":3,"height":1,"passthru":false,"label":"PAIRS Population","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"Population\",\"url\":\"https://pairs.res.ibm.com:8080/geoserver06/pairs/wms?styles=&sld=https%3A%2F%2Fpairs.res.ibm.com%3A443%2Fmap%2Fsld%3Ftype%3Draster%26min%3D0%26max%3D655350%26colorTableId%3D92%26no_data%3D-1%26property%3Dvalue%26layer%3Dpairs%3A1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000&authorization=jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I\",\"opt\":{\"layers\":\"1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000\",\"format\":\"image/png\",\"transparent\":true,\"transitionEffect\":\"resize\",\"attribution\":\"PAIRS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":190,"y":540,"wires":[["e579a286.5a8a9"]]},{"id":"cb3d87c.55b1478","type":"ui_button","z":"b3c62114.a4d8f","name":"","group":"733061b4.6b0e8","order":9,"width":3,"height":1,"passthru":false,"label":"PAIRS Nitro","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"command\":{\"map\":{\"overlay\":\"Nitro\",\"url\":\"https://pairs.res.ibm.com:8080/geoserver1/pairs/wms?styles=&sld=https%3A%2F%2Fpairs.res.ibm.com%3A443%2Fmap%2Fsld%3Ftype%3Draster%26min%3D0%26max%3D0.0001%26colorTableId%3D4%26no_data%3D-1%26property%3Dvalue%26layer%3Dpairs%3A1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean&authorization=jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I\",\"opt\":{\"layers\":\"1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean\",\"format\":\"image/png\",\"transparent\":true,\"transitionEffect\":\"resize\",\"attribution\":\"PAIRS\"},\"wms\":true}}}","payloadType":"json","topic":"","x":170,"y":580,"wires":[["e579a286.5a8a9"]]},{"id":"ab92f1fa.9c85a","type":"ui_button","z":"84950fca.868f2","name":"","group":"ee17d09c.5ac0b","order":14,"width":2,"height":1,"passthru":false,"label":"Align coords","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":90,"y":440,"wires":[["e77e2982.00d388"]]},{"id":"a4a81407.6e3458","type":"ui_button","z":"bd1591bd.1605c","name":"","group":"8922bb68.e4cd48","order":24,"width":3,"height":1,"passthru":false,"label":"Test","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"test\":true}","payloadType":"json","topic":"","x":100,"y":460,"wires":[["9098bd27.dd312"]]},{"id":"737a10f9.0e6b5","type":"ui_switch","z":"84950fca.868f2","name":"Show Popul","label":"Show","tooltip":"","group":"ee17d09c.5ac0b","order":19,"width":1,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":510,"y":340,"wires":[["5333c154.127b4"]]},{"id":"54d0f306.b0671c","type":"ui_switch","z":"84950fca.868f2","name":"Show Nitro","label":"Show","tooltip":"","group":"ee17d09c.5ac0b","order":17,"width":1,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":510,"y":380,"wires":[["7a26795f.52b8d8"]]},{"id":"8f4e8f52.39b04","type":"ui_switch","z":"bd1591bd.1605c","name":"Switch Nitro","label":"","tooltip":"","group":"8922bb68.e4cd48","order":20,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":490,"y":320,"wires":[["71b8331a.e1285c"]]},{"id":"20614df8.de5742","type":"ui_switch","z":"bd1591bd.1605c","name":"Switch popul","label":"","tooltip":"","group":"8922bb68.e4cd48","order":22,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":490,"y":380,"wires":[["db8ee886.e53668"]]},{"id":"41c711de.8f42b","type":"ui_slider","z":"bd1591bd.1605c","name":"","label":"Nitro Opacity","tooltip":"","group":"8922bb68.e4cd48","order":19,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":110,"y":320,"wires":[["48bc6448.1d8c2c"]]},{"id":"71a1ac20.9ddfe4","type":"ui_slider","z":"84950fca.868f2","name":"","label":"Nitro Opacity","tooltip":"","group":"ee17d09c.5ac0b","order":18,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":130,"y":380,"wires":[["bfc3cb07.222658"]]},{"id":"513c20c3.63ce","type":"ui_slider","z":"84950fca.868f2","name":"","label":"Popul Opacity","tooltip":"","group":"ee17d09c.5ac0b","order":16,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":140,"y":340,"wires":[["55e76ea2.767e"]]},{"id":"9b4bb378.1113e","type":"ui_slider","z":"bd1591bd.1605c","name":"","label":"Popul Opacity","tooltip":"","group":"8922bb68.e4cd48","order":21,"width":4,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"1","step":"0.1","x":120,"y":380,"wires":[["e956f55f.5c6718"]]},{"id":"c0eb8015.7801f","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":9,"width":6,"height":1,"name":"","label":"Last Dimensions","format":"","layout":"col-center","x":740,"y":140,"wires":[]},{"id":"f6ce975a.e64518","type":"ui_text","z":"b3c62114.a4d8f","group":"733061b4.6b0e8","order":2,"width":2,"height":1,"name":"","label":"Layers","format":"","layout":"row-left","x":710,"y":100,"wires":[]},{"id":"db57b9db.0a13b8","type":"ui_text","z":"b3c62114.a4d8f","group":"733061b4.6b0e8","order":6,"width":2,"height":1,"name":"","label":"Add","format":"","layout":"row-spread","x":710,"y":140,"wires":[]},{"id":"f21e6dbf.1c8d1","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":11,"width":2,"height":1,"name":"Map Lat","label":"Lat","format":"{{msg.mousePos.lat | number:3}}","layout":"row-left","x":840,"y":200,"wires":[]},{"id":"25e9257.2c46bda","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":12,"width":2,"height":1,"name":"Map Lng","label":"Lng","format":"{{msg.mousePos.lng | number:3}}","layout":"row-left","x":980,"y":200,"wires":[]},{"id":"b83f6091.478f5","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":6,"width":2,"height":1,"name":"Point Lng","label":"Lng","format":"{{msg.dimChange.pos.lng | number:5}}","layout":"row-left","x":880,"y":60,"wires":[]},{"id":"a715803b.414a4","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":5,"width":2,"height":1,"name":"Point Lat","label":"Lat","format":" {{msg.dimChange.pos.lat | number:5}}","layout":"row-left","x":720,"y":60,"wires":[]},{"id":"1e8cd204.2ded4e","type":"ui_text","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","order":10,"width":2,"height":1,"name":"","label":"zoom","format":"{{msg.dimChange.z | number:0}}","layout":"row-left","x":710,"y":200,"wires":[]},{"id":"cb64fae6.308328","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":10,"width":4,"height":1,"name":"","label":"Map Center","format":"","layout":"row-right","x":870,"y":120,"wires":[]},{"id":"e32edc6d.aa0db","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":12,"width":2,"height":1,"name":"","label":"Lng","format":"{{msg.dimChange.pos.lng | number:5}}","layout":"row-left","x":850,"y":240,"wires":[]},{"id":"3d99662c.69100a","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":11,"width":2,"height":1,"name":"","label":"Lat","format":" {{msg.dimChange.pos.lat | number:5}}","layout":"row-left","x":850,"y":200,"wires":[]},{"id":"1856b78e.aa6e78","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":13,"width":2,"height":1,"name":"","label":"Zoom","format":"{{msg.dimChange.z | number:0}}","layout":"row-left","x":850,"y":160,"wires":[]},{"id":"1c643274.3b7e2e","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":1,"width":1,"height":1,"name":"Ref Point","label":"Ref Point","format":"","layout":"row-right","x":740,"y":40,"wires":[]},{"id":"1f4a6a37.d29136","type":"ui_template","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","name":"OpenStreetMap","order":2,"width":12,"height":6,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n    (function() {\n\n        const cScope = this.scope;\n        setTimeout(function () {\n            const mapid='osmapid'\n\n        \tconst map = L.map(mapid).setView([48.204550, 16.364333], 13);\n\n            //const urlPattern='https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png'\n            const urlPattern='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n            \n        \tosmLayer=L.tileLayer(urlPattern,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]})\n        \tosmLayer.addTo(map);\n        \t\n        \taddMapClick(cScope,map,mapid,{OSM:osmLayer})\n        \t\n        \taddMapWatch(cScope,map,mapid)\n\n            setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n        }, 300);\n    })();\n</script>\n\n<div id=\"osmapid\" style=\"width: 100%; height: 400px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":120,"y":80,"wires":[["b3a55fa0.1adda"]]},{"id":"9098bd27.dd312","type":"ui_template","z":"bd1591bd.1605c","group":"8922bb68.e4cd48","name":"PAIRS","order":16,"width":12,"height":6,"format":"<script>\n(function() {\n    const cScope = this.scope;\n    \n    setTimeout(function () {\n        const mapid='pairsmapid'\n        \n        initPAIRS(L)\n        \n        nitroLayer=newPAIRSLayer(L,'geoserver1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n\n        populLayer=newPAIRSLayer(L,'geoserver06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n        \n        var overlayMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n\n        const map=createOSMMap(L,mapid,overlayMaps)\n\n    \taddMapClick(cScope,map,mapid)\n    \t\n        addMapWatch(cScope,map,mapid,overlayMaps,function(msg){\n            if(\"test\" in msg.payload) {\n                console.log(\"Test called: \",msg.payload.test)\n                console.log(\"Opacity: \",osmLayer.opacity)\n            }\n        })\n\n        setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"pairsmapid\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":110,"y":140,"wires":[["b3a55fa0.1adda"]]},{"id":"3f92f961.414076","type":"ui_template","z":"b3c62114.a4d8f","group":"733061b4.6b0e8","name":"MapWidget","order":1,"width":12,"height":6,"format":"<!--\n<div ng-bind-html=\"msg.payload | trusted\"></div>\n-->\n<iframe src=\"../osmbase\" height=300px ></iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":730,"y":60,"wires":[[]]},{"id":"d8a9f2ef.6f185","type":"ui_template","z":"9976eb7b.656868","group":"d3038d41.b467","name":"PAIRS","order":0,"width":"16","height":"7","format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n(function() {\n    const cScope = this.scope;\n\n    const PAIRS_HOST='pairs.res.ibm.com'\n    const PAIRS_PORT=8080\n    const auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\n    const EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\n\n\n    setTimeout(function () {\n        pairsFuncs= {\n            setPairsData: function(seqId,minColor,maxColor,colorTableId,layerName) {\n                console.log('Setting pairs data to ',seqId,minColor,maxColor,colorTableId,layerName)\n                this.seqId=seqId\n                this.minColor=minColor\n                this.maxColor=maxColor\n                this.colorTableId=colorTableId\n                this.layerName=layerName\n            },\n            makePairsURL: function(z,x,y,seqId,minColor,maxColor,colorTableId,layerName) {\n                const proj='EPSG:3857'\n                const imageFormat='png'\n                const wpels=256\n                const hpels=256\n                \n                //console.log('Get PAIRS tile for coords zoom=',z,' x=',x,' y=',y)\n                    \n                EPSG_3857=[20026376.39,20048966.10]\n                \n                zpow=2**z/2\n                \n                bbox_l=(x-zpow)*EPSG_3857[0]/zpow\n                bbox_t=(zpow-y-1)*EPSG_3857[1]/zpow\n                bbox_r=(x-zpow+1)*EPSG_3857[0]/zpow\n                bbox_b=(zpow-y)*EPSG_3857[1]/zpow\n                var baseURL=`https://${PAIRS_HOST}:${PAIRS_PORT}/geoserver${seqId}/pairs/wms?service=WMS&version=1.3.0&request=GetMap&format=image/${imageFormat}&transparent=true&transitionEffect=resize&width=${wpels}&height=${hpels}&crs=${proj}&styles=&bbox=${bbox_l},${bbox_t},${bbox_r},${bbox_b}`\n                \n                var sld=`https://${PAIRS_HOST}:443/map/sld?type=raster&min=${minColor}&max=${maxColor}&colorTableId=${colorTableId}&no_data=-1&property=value&layer=pairs:${layerName}`\n                \n                sldEnc=encodeURIComponent(sld)\n                var fullURL=`${baseURL}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`\n                \n                //var fullURL=`${baseURL}&layers=${layerName}&authorization=${auth}`\n        \n                return fullURL\n            },\n            getTileUrl: function(coords) {\n                //console.log('Get PAIRS tile for coords ',coords)\n\n                return this.makePairsURL(coords['z'],coords['x'],coords['y'],this.seqId,this.minColor,this.maxColor,this.colorTableId,this.layerName)\n            }\n        }\n        \n        L.TileLayer.Pairs = L.TileLayer.extend(pairsFuncs)\n        \n        nitroLayer=new L.TileLayer.Pairs()\n        nitroLayer.setPairsData('1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n        //nitroLayer.addTo(map)\n        \n        populLayer=new L.TileLayer.Pairs()\n        populLayer.setPairsData('06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n        //populLayer.addTo(map)\n        \n    \tconst map = L.map('pairsmapid2',{\n    \t    center: [48.204550, 16.364333],\n    \t    zoom: 4,\n    \t    layers: [nitroLayer,populLayer]\n    \t})\n    \t\n    \tvar baseMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n\n        var overlayMaps = {\n            //\"Cities\": cities\n        }\n    \tL.control.layers(baseMaps, overlayMaps).addTo(map);\n    \t\n        let marker\n    \tmap.on('click', function(e) {\n            cScope.send(e.latlng);\n            if (marker) {\n                map.removeLayer(marker);\n            };\n            marker = L.circleMarker(e.latlng).addTo(map);\n        });\n            \n        setTimeout(function () {\n            map.invalidateSize();\n        }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"pairsmapid2\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":320,"y":240,"wires":[[]]},{"id":"1ed2c7f4.b4acd8","type":"ui_template","z":"84950fca.868f2","group":"ee17d09c.5ac0b","name":"OpenStreetMap","order":8,"width":12,"height":8,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\"></script>\n\n<script>\n    (function() {\n\n        const cScope = this.scope;\n        setTimeout(function () {\n            const mapid='osmapid'\n\n        \t//const map = L.map(mapid).setView([48.204550, 16.364333], 13);\n        \tconst map = L.map(mapid)\n\n            //const urlPattern='https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png'\n            const urlPattern='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n            \n        \tosmLayer=L.tileLayer(urlPattern,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]})\n        \tosmLayer.addTo(map);\n\n        \taddMapClick(cScope,map,mapid,{OSM:osmLayer})\n        \t\n        \taddMapWatch(cScope,map,mapid)\n\n            setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n        }, 300);\n    })();\n</script>\n\n<div id=\"osmapid\" style=\"width: 100%; height: 400px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":120,"y":140,"wires":[["ead7baef.379328"]]},{"id":"182d990.f19c767","type":"ui_template","z":"84950fca.868f2","group":"ee17d09c.5ac0b","name":"PAIRS Map","order":15,"width":12,"height":7,"format":"<script>\n(function() {\n    const cScope = this.scope;\n    \n    const PAIRS_HOST='pairs.res.ibm.com'\n    const PAIRS_PORT=8080\n    const auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\n    // ESPG bounding box coordinates\n    const EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\n\n    setTimeout(function () {\n        const mapid='vitimapid'\n\n        initPAIRS(L)\n\n        nitroLayer=newPAIRSLayer(L,'geoserver1',0.000000,0.0001000,4,'1588089600_03312498ESASentinel5PL2-NitrogendioxideTropospheric5042415856992000001588291200000-Mean')\n        populLayer=newPAIRSLayer(L,'geoserver06',0,655350,92,'1588046400_35972570GlobalpopulationSEDAC-Globalpopulationdensity-01_01_2020T000000')\n\n        var overlayMaps = {\n            \"Nitro\": nitroLayer,\n            \"Popul\": populLayer\n        }\n        \n        const map=createOSMMap(L,mapid,overlayMaps)\n        \n    \taddMapClick(cScope,map,mapid)\n    \t\n        addMapWatch(cScope,map,mapid,overlayMaps,function(payload){\n            if('addLayers' in payload) {\n                wmsLayers=payload.addLayers\n                console.log('Adding WMS layers from ',wmsLayers)\n                wmsOverlays={}\n                \n                wmsLayers.forEach(function(layer) {\n                    wmsOverlays[layer.datalayer]=newPAIRSLayer(L,layer.geoserverUrl,layer.min,layer.max,layer.colorTableId,layer.name)\n                })\n                \n                console.log(\"Adding WMS overlays \",wmsOverlays)\n                L.control.layers(null, wmsOverlays).addTo(map);\n                \n            } else {\n                console.log('Unhandled message payload',payload)\n            }\n        })\n\n        setTimeout(function () {\n                       map.invalidateSize();\n                    }, 100);\n    }, 300);\n})();\n</script>\n\n<div id=\"vitimapid\" style=\"width: 100%; height: 600px;\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":110,"y":200,"wires":[["ead7baef.379328"]]},{"id":"dbf18f89.674b2","type":"ui_template","z":"dc853c89.d32cf","group":"8922bb68.e4cd48","name":"Common Map JS","order":1,"width":0,"height":0,"format":"\n<script>\n// Common functions used to deal with leaflet maps\n\n/* Set up the map watching to communicate with Node-RED */    \nfunction addMapWatch(cScope,map,mapid,layers,fallBack) {\n    sendMapDimensions=function(evt) {\n        cScope.send({\"dimChange\" : {'type': evt.type, 'fromMapId': mapid, 'zoom': map.getZoom(), 'pos': map.getCenter()}})\n    }\n    \n    map.on('moveend',sendMapDimensions)\n    map.on('zoomend',sendMapDimensions)\n    map.on('move',sendMapDimensions)\n    \n    // Debug layers names\n    if(layers) {\n        for (const [key, value] of Object.entries(layers)) {\n            console.log(\"layer key \",key,\" val=\", value);\n        }\n        \n        for (var key in layers) {\n            // check if the property/key is defined in the object itself, not in parent\n            if (layers.hasOwnProperty(key)) {\n                console.log(\"layer key \",key,\" val=\", layers[key]);\n            }\n        }\n    }\n    \n    cScope.$watch('msg',function(msg) {\n        let refPointMarker\n        \n        function setRefPointMarker(pos) {\n            if (refPointMarker) {\n                map.removeLayer(refPointMarker);\n            }\n\n            let svgPin = '<svg width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><metadata id=\"metadata1\">image/svg+xml</metadata><circle fill=\"#fe2244\" cx=\"10\" cy=\"10\" r=\"9\"/><circle fill=\"#ffffbf\" cx=\"10\" cy=\"10\" r=\"5\"/></svg>'\n            refPointMarker=L.marker([pos.lat,pos.lng], {icon: L.icon({iconUrl: encodeURI(`data:image/svg+xml,${svgPin}`).replace(/\\#/g,'%23'), iconSize: 20})}).bindPopup(\"Ref Point\").addTo(map);\n        }\n        \n        if(msg) {\n            if(\"payload\" in msg) {\n                if(\"setDim\" in msg.payload) {\n                    console.log('setDim',msg.payload.setDim)\n                    if(map.getZoom()!=msg.payload.setDim.zoom || map.getCenter()!=msg.payload.setDim.pos) {\n                        map.setView(msg.payload.setDim.pos,msg.payload.setDim.zoom)\n                    }\n                    if(\"type\" in msg.payload.setDim && msg.payload.setDim.type=='initMap') {\n                        setRefPointMarker(msg.payload.setDim.pos)\n                    }\n                } else if(\"setOpacity\" in msg.payload) {\n                    console.log(\"Setting opcacity\",msg.payload.setOpacity)\n                    for (var name in layers) {\n                        if (layers.hasOwnProperty(name)) {\n                            if(name==msg.payload.setOpacity.layer) {\n                                console.log(\"Setting layer \",name,\" opacity to  \",msg.payload.setOpacity.opacity)\n                                layers[name].setOpacity(msg.payload.setOpacity.opacity)\n                            }\n                        }\n                    }\n                } else if(\"setRefPoint\" in msg.payload) {\n                    // Set the reference point with a marker    \n                    setRefPointMarker(msg.payload.setRefPoint.pos)\n                    map.setView(msg.payload.setRefPoint.pos,map.getZoom())\n                } else if(fallBack) {\n                    fallBack(msg.payload,cScope,map,mapid,layers)\n                }\n            } else {\n                console.log(`${mapid} unhandled msg, no payload: `,msg)\n            }\n        }\n    });\n    \n    // Notify of init complete\n    cScope.send({\"initMap\":mapid});\n}\n\n/* Function added to generate an event when the map is clicked\n    This will also add a marker\n*/\nfunction addMapClick(cScope,map,mapid) {\n    let marker\n\tmap.on('click', function(evt) {\n        cScope.send({\"mousePos\" :evt.latlng, \"fromMapId\":mapid});\n        if (marker) {\n            map.removeLayer(marker);\n        };\n        marker = L.circleMarker(evt.latlng).addTo(map);\n    });\n}\n\nfunction createOSMMap(L,mapid,overlayMaps) {\n    var map=L.map(mapid)\n\n\tconst osmURL='https://tile.openstreetmap.org/{z}/{x}/{y}.png' \n    osmLayer=L.tileLayer(osmURL,{maxZoom: 18,subdomains: [\"maps1\", \"maps2\", \"maps3\", \"maps4\"]}).addTo(map);\n\n    L.control.layers({\"OSM\": osmLayer}, overlayMaps,{\"hideSingleBase\":true}).addTo(map);\n    \n    return map\n}\n\n/* Function to setup opacity on a map layer \n*/\nfunction defineOpacity() {\n    console.log(\"Start define Opacity\")\n    \n    L.Control.Opacity = L.Control.extend({\n        options: {\n            collapsed: !1,\n            position: \"topright\",\n            label: null\n        },\n        initialize: function(t, e) {\n            for (var i in L.Util.setOptions(this, e),\n            this._layerControlInputs = [],\n            this._layers = [],\n            this._lastZIndex = 0,\n            this._handlingClick = !1,\n            t)\n                this._addLayer(t[i], i, !0)\n        },\n        onAdd: function(t) {\n            return this._initLayout(),\n            this._update(),\n            this._container\n        },\n        expand: function() {\n            L.DomUtil.addClass(this._container, \"leaflet-control-layers-expanded\"),\n            this._form.style.height = null;\n            var t = this._map.getSize().y - (this._container.offsetTop + 50);\n            return t < this._form.clientHeight ? (L.DomUtil.addClass(this._form, \"leaflet-control-layers-scrollbar\"),\n            this._form.style.height = t + \"px\") : L.DomUtil.removeClass(this._form, \"leaflet-control-layers-scrollbar\"),\n            this\n        },\n        collapse: function() {\n            return L.DomUtil.removeClass(this._container, \"leaflet-control-layers-expanded\"),\n            this\n        },\n        _initLayout: function() {\n            var t = \"leaflet-control-layers\"\n              , e = this._container = L.DomUtil.create(\"div\", t)\n              , i = this.options.collapsed;\n            if (e.setAttribute(\"aria-haspopup\", !0),\n            L.DomEvent.disableClickPropagation(e),\n            L.DomEvent.disableScrollPropagation(e),\n            this.options.label) {\n                var a = L.DomUtil.create(\"p\", t + \"-label\");\n                a.innerHTML = this.options.label,\n                e.appendChild(a)\n            }\n            var s = this._form = L.DomUtil.create(\"form\", t + \"-list\");\n            i && (this._map.on(\"click\", this.collapse, this),\n            L.Browser.android || L.DomEvent.on(e, {\n                mouseenter: this.expand,\n                mouseleave: this.collapse\n            }, this));\n            var l = this._layersLink = L.DomUtil.create(\"a\", t + \"-toggle\", e);\n            l.href = \"#\",\n            l.title = \"Layers\",\n            L.Browser.touch ? (L.DomEvent.on(l, \"click\", L.DomEvent.stop),\n            L.DomEvent.on(l, \"click\", this.expand, this)) : L.DomEvent.on(l, \"focus\", this.expand, this),\n            i || this.expand(),\n            this._baseLayersList = L.DomUtil.create(\"div\", t + \"-base\", s),\n            this._separator = L.DomUtil.create(\"div\", t + \"-separator\", s),\n            this._overlaysList = L.DomUtil.create(\"div\", t + \"-overlays\", s),\n            e.appendChild(s)\n        },\n        _getLayer: function(t) {\n            for (var e = 0; e < this._layers.length; e++)\n                if (this._layers[e] && L.Util.stamp(this._layers[e].layer) === t)\n                    return this._layers[e]\n        },\n        _addLayer: function(t, e, i) {\n            this._layers.push({\n                layer: t,\n                name: e,\n                overlay: i\n            })\n        },\n        _update: function() {\n            if (!this._container)\n                return this;\n            L.DomUtil.empty(this._baseLayersList),\n            L.DomUtil.empty(this._overlaysList),\n            this._layerControlInputs = [];\n            var t, e, i, a, s = 0;\n            for (i = 0; i < this._layers.length; i++)\n                a = this._layers[i],\n                this._addItem(a),\n                e = e || a.overlay,\n                t = t || !a.overlay,\n                s += a.overlay ? 0 : 1;\n            return this.options.hideSingleBase && (t = t && s > 1,\n            this._baseLayersList.style.display = t ? \"\" : \"none\"),\n            this._separator.style.display = e && t ? \"\" : \"none\",\n            this\n        },\n        _addItem: function(t) {\n            var e, i = document.createElement(\"label\");\n            t.overlay ? ((e = document.createElement(\"input\")).type = \"range\",\n            e.className = \"leaflet-control-layers-range\",\n            e.min = 0,\n            e.max = 100,\n            e.value = 100) : e = this._createRadioElement(\"leaflet-base-layers\", checked),\n            this._layerControlInputs.push(e),\n            e.layerId = L.Util.stamp(t.layer),\n            L.DomEvent.on(e, \"click\", this._onInputClick, this),\n            L.DomEvent.on(e, \"touchend\", this._onInputClick, this);\n            var a = document.createElement(\"span\");\n            a.innerHTML = \" \" + t.name;\n            var s = document.createElement(\"div\")\n              , l = document.createElement(\"div\");\n            return i.appendChild(s),\n            s.appendChild(a),\n            i.appendChild(l),\n            l.appendChild(e),\n            (t.overlay ? this._overlaysList : this._baseLayersList).appendChild(i),\n            i\n        },\n        _onInputClick: function() {\n            var t, e, i = this._layerControlInputs;\n            this._handlingClick = !0;\n            for (var a = i.length - 1; a >= 0; a--)\n                t = i[a],\n                void 0 === (e = this._getLayer(t.layerId).layer)._url || e.setOpacity(t.value / 100);\n            this._handlingClick = !1,\n            this._refocusOnMap()\n        }\n    })\n\n    L.control.opacity = function(t, e) {\n        return new L.Control.Opacity(t,e)\n    }\n    \n    console.log(\"End defined opacity\")\n}\n</script>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","x":110,"y":40,"wires":[[]]},{"id":"660ed979.95b608","type":"ui_template","z":"dc853c89.d32cf","group":"ee17d09c.5ac0b","name":"Common PAIRS","order":26,"width":2,"height":1,"format":"<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.css\"\n   integrity=\"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==\"\n   crossorigin=\"\"/>\n<script src=\"https://unpkg.com/leaflet@1.6.0/dist/leaflet.js\"\n   integrity=\"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==\"\n   crossorigin=\"\">\n</script>\n   \n<script>\n\nconst PAIRS_HOST='pairs.res.ibm.com'\nconst PAIRS_PORT=8080\nconst auth='jGn23qJeqcCVeFaRot2duWirS6bl052bxLjdSisZWVjlSadbmAWAfc30SUd9L-GxPBIZ-TulkhNL1LAl-J_Sjmf-j7TUEqpIHj4kZ1flCBHmOs6aNmw_qkT1YrtYhYLDmmJktFoRfpfW9GeCaD41Ed21bVw2XOWyBLHVn4kf43rMqI326lp7vxJGGjmZlXjtBFfUFvhoh7gYEZgnWB-mk-506RyWVqQ3rc4J0AusaRRbh6xg_D4DXbjSqqO4q9ft1SY8xNjiqAQO4Nde0QcEHdY_DU54WheQP_vmw8a_C4Q5KSNlQ4oA_X4A3XXcHiMjtLszKAi3hCa0jvj3MmLAm0xyhA1OhNgKWCkUHG53wIee7FqRKSeMfjQEHDpLVxUVWL2L99ZYxO-vt8gL2UA6y68yExwlVnVQMOe3yL-nfflwM_Jo8QPK46gC5ogbmEhr9xJFswwGG7BcUNdnXMAFADBmVoCfl6KpEW4wvXjBfYy7fWED93Tmsq1SdPMX_gIPEfkvT2ZTG_iL-4i_eCa91OffwkQlu0FON0hioVTtdgtZ-fHFfxn9A7lL0NOqV2yTRel1ZFue93HYI3ZWYSRZSdZJjt3mSX7lLDXtzD2iCSraSI3gG8wZyRO8gBu4ttA7wF3qrbneBbxWnpMwX1EHv2n9N4h9DglgfwZZob54U4I'\nconst EPSG={'EPSG:3857':{'dx':20026376.39,'dy':20048966.10}}\nconst INIT_OPACITY=0.4\n\npairsFuncs= {\n    setPairsData: function(geoServerURLOrID,minColor,maxColor,colorTableId,layerName) {\n        // console.log('Setting pairs data to ',geoServerId,minColor,maxColor,colorTableId,layerName)\n        this.geoServerURL=geoServerURLOrID.startsWith('http')?geoServerURLOrID:`https://${PAIRS_HOST}:${PAIRS_PORT}/${geoServerURLOrID}`\n        this.minColor=minColor\n        this.maxColor=maxColor\n        this.colorTableId=colorTableId\n        this.layerName=layerName\n    },\n    makePairsURL: function(z,x,y,geoServerURL,minColor,maxColor,colorTableId,layerName) {\n        const proj='EPSG:3857'\n        const imageFormat='png'\n        const wpels=256\n        const hpels=256\n\n        // So, this should be the main WMS URL base\n        var baseURL=`${geoServerURL}/pairs/wms?service=WMS&version=1.3.0&request=GetMap&format=image/${imageFormat}&transparent=true&transitionEffect=resize&width=${wpels}&height=${hpels}&crs=${proj}&styles=`\n\n        zpow=2**z/2\n        bbox_l=(x-zpow)*EPSG[proj]['dx']/zpow\n        bbox_t=(zpow-y-1)*EPSG[proj]['dy']/zpow\n        bbox_r=(x-zpow+1)*EPSG[proj]['dx']/zpow\n        bbox_b=(zpow-y)*EPSG[proj]['dy']/zpow\n        \n        // Make-up the style layer descriptor and encode it    \n        var sld=`https://${PAIRS_HOST}:443/map/sld?type=raster&min=${minColor}&max=${maxColor}&colorTableId=${colorTableId}&no_data=-1&property=value&layer=pairs:${layerName}`\n        sldEnc=encodeURIComponent(sld)\n        \n        // Finally build the full URL\n        var fullURL=`${baseURL}&bbox=${bbox_l},${bbox_t},${bbox_r},${bbox_b}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`\n\n        console.log(`WMS URL without bbox: ${baseURL}&layers=${layerName}&authorization=${auth}&sld=${sldEnc}`)                \n        return fullURL\n    },\n    getTileUrl: function(coords) {\n        //console.log('Get PAIRS tile for coords ',coords)\n        return this.makePairsURL(coords['z'],coords['x'],coords['y'],this.geoServerURL,this.minColor,this.maxColor,this.colorTableId,this.layerName)\n    }\n}\n\nfunction initPAIRS(L) {\n    L.TileLayer.Pairs = L.TileLayer.extend(pairsFuncs)\n}\n\nfunction newPAIRSLayer(L,geoServerURLOrId,minColor,maxColor,colorTableId,layerName,opacity) {\n    newLayer=new L.TileLayer.Pairs()\n    newLayer.setPairsData(geoServerURLOrId,minColor,maxColor,colorTableId,layerName)\n    newLayer.setOpacity(opacity?opacity:INIT_OPACITY)\n    \n    return newLayer\n}\n\n</script>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","x":100,"y":80,"wires":[[]]},{"id":"c0572afb.8feea8","type":"worldmap","z":"16d1d089.1978cf","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":380,"y":160,"wires":[]},{"id":"e579a286.5a8a9","type":"worldmap","z":"b3c62114.a4d8f","name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"hide","layers":"show","panit":"true","hiderightclick":"false","coords":"deg","showgrid":"true","path":"osmbase","x":620,"y":320,"wires":[]},{"id":"7e43bab7.5bfd04","type":"worldmap in","z":"16d1d089.1978cf","name":"","path":"/worldmap","events":"all","x":660,"y":160,"wires":[[]]},{"id":"93322c10.7dc11","type":"worldmap in","z":"b3c62114.a4d8f","name":"","path":"/osmbase","events":"all","x":530,"y":460,"wires":[["78b23bfd.8a6544"]]},{"id":"8c3bb2c3.086a4","type":"worldmap-tracks","z":"b3c62114.a4d8f","name":"","depth":"5","layer":"combined","x":530,"y":80,"wires":[["e579a286.5a8a9"]]},{"id":"8ce8d128.3597d","type":"inject","z":"3268bb9d.2b7f84","name":"Viti Layers UDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"fichierRef 02_09_2020 Hackaton01\",\"layers\":[{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Mean\",\"alias\":\"49250_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Max\",\"alias\":\"49250_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49250\",\"aggregation\":\"Min\",\"alias\":\"49250_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Mean\",\"alias\":\"49257_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Max\",\"alias\":\"49257_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49257\",\"aggregation\":\"Min\",\"alias\":\"49257_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Mean\",\"alias\":\"49304_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Max\",\"alias\":\"49304_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49304\",\"aggregation\":\"Min\",\"alias\":\"49304_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Mean\",\"alias\":\"49311_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Max\",\"alias\":\"49311_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49311\",\"aggregation\":\"Min\",\"alias\":\"49311_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Mean\",\"alias\":\"49423_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Max\",\"alias\":\"49423_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49423\",\"aggregation\":\"Min\",\"alias\":\"49423_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Mean\",\"alias\":\"49432_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Max\",\"alias\":\"49432_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49432\",\"aggregation\":\"Min\",\"alias\":\"49432_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Mean\",\"alias\":\"49433_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Max\",\"alias\":\"49433_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49433\",\"aggregation\":\"Min\",\"alias\":\"49433_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Mean\",\"alias\":\"49441_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Max\",\"alias\":\"49441_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49441\",\"aggregation\":\"Min\",\"alias\":\"49441_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Mean\",\"alias\":\"49454_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Max\",\"alias\":\"49454_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49454\",\"aggregation\":\"Min\",\"alias\":\"49454_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Mean\",\"alias\":\"49459_Mean\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Max\",\"alias\":\"49459_Max\"},{\"type\":\"raster\",\"output\":false,\"id\":\"49459\",\"aggregation\":\"Min\",\"alias\":\"49459_Min\"},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Mean\",\"alias\":\"50509_Mean\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Max\",\"alias\":\"50509_Max\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"type\":\"raster\",\"output\":false,\"id\":\"50509\",\"aggregation\":\"Min\",\"alias\":\"50509_Min\",\"temporal\":{\"intervals\":[{\"snapshot\":\"2019-12-05T00:00:01Z\"}]},\"dimensions\":[{\"name\":\"quantile\",\"value\":\"mean\"},{\"name\":\"depth\",\"value\":\"0to5cm\"}]},{\"alias\":\"result_01_01\",\"expression\":\"( (( $49250_Mean >= 2.321849897949975 && $49250_Mean <= 2.368755956494419) ? 1 : 0 ) + (( $49250_Max >= 77.41799697875976 && $49250_Max <= 78.98199691772462) ? 1 : 0 ) + (( $49250_Min >= 0.0 && $49250_Min <= 0.0) ? 1 : 0 ) + (( $49257_Mean >= 284.1551711524563 && $49257_Mean <= 289.8956796605868) ? 1 : 0 ) + (( $49257_Max >= 310.66198791503905 && $49257_Max <= 316.93798767089845) ? 1 : 0 ) + (( $49257_Min >= 265.4190060424804 && $49257_Min <= 270.7810061645507) ? 1 : 0 ) + (( $49304_Mean >= 279.1707334716049 && $49304_Mean <= 284.81054626901107) ? 1 : 0 ) + (( $49304_Max >= 290.86198791503904 && $49304_Max <= 296.73798767089846) ? 1 : 0 ) + (( $49304_Min >= 264.825 && $49304_Min <= 270.175) ? 1 : 0 ) + (( $49311_Mean >= 0.99 && $49311_Mean <= 1.01) ? 1 : 0 ) + (( $49311_Max >= 7.92 && $49311_Max <= 8.08) ? 1 : 0 ) + (( $49311_Min >= 0.0 && $49311_Min <= 0.0) ? 1 : 0 ) + (( $49423_Mean >= 284.5703098782602 && $49423_Mean <= 290.319205027316) ? 1 : 0 ) + (( $49423_Max >= 312.1891644287109 && $49423_Max <= 318.4960162353516) ? 1 : 0 ) + (( $49423_Min >= 266.8143054199219 && $49423_Min <= 272.2044934082031) ? 1 : 0 ) + (( $49432_Mean >= 1.4711724457070526e-05 && $49432_Mean <= 1.500893101175882e-05) ? 1 : 0 ) + (( $49432_Max >= 0.0012394013861194253 && $49432_Max <= 0.0012644397979602218) ? 1 : 0 ) + (( $49432_Min >= 0.0 && $49432_Min <= 0.0) ? 1 : 0 ) + (( $49433_Mean >= 5.619700130714136e-05 && $49433_Mean <= 5.7332294262841185e-05) ? 1 : 0 ) + (( $49433_Max >= 0.004692061319947243 && $49433_Max <= 0.004786850437521936) ? 1 : 0 ) + (( $49433_Min >= 0.0 && $49433_Min <= 0.0) ? 1 : 0 ) + (( $49441_Mean >= 763428.8643517453 && $49441_Mean <= 778851.6696921847) ? 1 : 0 ) + (( $49441_Max >= 3230569.7325 && $49441_Max <= 3295833.7675) ? 1 : 0 ) + (( $49441_Min >= 0.0 && $49441_Min <= 0.0) ? 1 : 0 ) + (( $49454_Mean >= 0.6154233965255467 && $49454_Mean <= 0.6278561924149517) ? 1 : 0 ) + (( $49454_Max >= 0.99 && $49454_Max <= 1.01) ? 1 : 0 ) + (( $49454_Min >= 0.0 && $49454_Min <= 0.0) ? 1 : 0 ) + (( $49459_Mean >= 0.00010613992575907212 && $49459_Mean <= 0.00010828416668349784) ? 1 : 0 ) + (( $49459_Max >= 0.004916948159225286 && $49459_Max <= 0.005016280445270241) ? 1 : 0 ) + (( $49459_Min >= 0.0 && $49459_Min <= 0.0) ? 1 : 0 ) + (( $50509_Mean >= 7.1379 && $50509_Mean <= 7.2821) ? 1 : 0 ) + (( $50509_Max >= 7.1379 && $50509_Max <= 7.2821) ? 1 : 0 ) + (( $50509_Min >= 7.1379 && $50509_Min <= 7.2821) ? 1 : 0 ) / 33 )\"}],\"spatial\":{\"type\":\"poly\",\"aoi\":\"38662\"},\"temporal\":{\"intervals\":[{\"start\":\"2019-05-01T00:00:00Z\",\"end\":\"2019-12-31T23:59:59Z\"}]}}","payloadType":"json","x":140,"y":80,"wires":[["b067a6e5.bf25f8"]]},{"id":"6b8840d7.4abeb","type":"subflow:f75a1866.de1ef8","z":"d679d351.f64ae","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":510,"y":360,"wires":[[],[],[]]},{"id":"2ef29f93.f608f","type":"debug","z":"a09c9932.979aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":850,"y":300,"wires":[]},{"id":"7728cc65.2d3a54","type":"switch","z":"f75a1866.de1ef8","name":"","property":"appendPayloadToURL","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":250,"y":40,"wires":[["56b4df67.5bd3b"],["132cd836.c7d488"]]},{"id":"dd146b09.bf13a8","type":"template","z":"d679d351.f64ae","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"layers\": [\n    {{#payload.layers}}\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Min\"\n        },\n        {\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Max\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"point\",\n        \"coordinates\": [\n            \"{{payload.pos.lat}}\",\n            \"{{payload.pos.lng}}\"\n        ]\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":320,"y":180,"wires":[["da81b4e6.897f68"]]},{"id":"74a78bbd.c24c64","type":"json","z":"d679d351.f64ae","name":"","property":"payload","action":"","pretty":false,"x":310,"y":360,"wires":[["6b8840d7.4abeb"]]},{"id":"da81b4e6.897f68","type":"function","z":"d679d351.f64ae","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":260,"wires":[["74a78bbd.c24c64"]]},{"id":"b070b83c.fd2fc8","type":"subflow:d679d351.f64ae","z":"a09c9932.979aa8","name":"","env":[],"x":450,"y":300,"wires":[["2ef29f93.f608f"],["9929b9eb.0bad58"],["1ef9e26d.110e5e"]]},{"id":"8d1d5dd0.4bab2","type":"inject","z":"a09c9932.979aa8","name":"Test Layer 49058","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"49058\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":120,"y":260,"wires":[["b070b83c.fd2fc8"]]},{"id":"8afb7d6f.a2109","type":"inject","z":"84950fca.868f2","name":"SetRefData","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49432\",\"49433\",\"49441\",\"49454\"],\"layers_old\":[\"50450\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":100,"y":40,"wires":[["66d472c2.fdceec"]]},{"id":"66d472c2.fdceec","type":"change","z":"84950fca.868f2","name":"set flow.refData","rules":[{"t":"set","p":"refData","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"mousePos","pt":"msg","to":"payload.pos","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":40,"wires":[["f5e46c4d.50965","ed959374.30d9","b38c6bbd.b0f328","936f6701.c48158"]]},{"id":"a4cb0892.241758","type":"subflow:d679d351.f64ae","z":"84950fca.868f2","name":"","env":[],"x":670,"y":260,"wires":[["133647a3.3f8358","5a573ac6.7148b4"],["da472e60.bd22a"],["da472e60.bd22a"]]},{"id":"133647a3.3f8358","type":"ui_template","z":"84950fca.868f2","group":"ee17d09c.5ac0b","name":"LayersList","order":9,"width":12,"height":7,"format":"<!--\n<svg viewBox=\"0 0 200 200\"><path d=\"M100 100 L100 0 A100 100 0 0 1 187 50 Z\" style=\"fill: rgba(255, 0, 0, 0); background: rgba(255, 0, 0, 0);\"></path><path d=\"M100 100 L187 50 A100 100 0 0 1 187 150 Z\" style=\"fill: rgba(255, 0, 0, 0.168627); background: rgba(255, 0, 0, 0.168627);\"></path><path d=\"M100 100 L187 150 A100 100 0 0 1 100 200 Z\" style=\"fill: rgba(255, 0, 0, 0.329412); background: rgba(255, 0, 0, 0.329412);\"></path><path d=\"M100 100 L100 200 A100 100 0 0 1 14 150 Z\" style=\"fill: rgba(255, 0, 0, 0.498039); background: rgba(255, 0, 0, 0.498039);\"></path><path d=\"M100 100 L14 150 A100 100 0 0 1 14 50 Z\" style=\"fill: rgba(255, 0, 0, 0.670588); background: rgba(255, 0, 0, 0.670588);\"></path><path d=\"M100 100 L14 50 A100 100 0 0 1 100 0 Z\" style=\"fill: rgba(255, 0, 0, 0.831373); background: rgba(255, 0, 0, 0.831373);\"></path></svg>\n-->\n<div id=\"{{'my_'+$id}}\" style=\"{{'color:'+theme.base_color}}\"></div>\n\n<script>\n/* Generate HTML code to display layers list or text\n*/\nfunction genLayersHTML(layers) {\n    var lat\n    var lng\n    \n    // first group all the layers by layer ID and flatten Min-Mean-Max\n    let layersFlat=layers.reduce(function(acc,layer) {\n      if(!(layer.layerId in acc)) {\n      \tacc[layer.layerId]={name: layer.layerName, id:layer.layerId, dataset: layer.dataset}\n      }\n      lat=layer.latitude\n      lng=layer.longitude\n      acc[layer.layerId][layer.aggregation]=parseFloat(layer.value)\n      return acc\n    },{})\n    \n    console.log(layersFlat)\n    console.log(Object.keys(layersFlat))\n    \n    return `Lat: ${lat} Lng: ${lng}<BR>`+Object.keys(layersFlat).map(function(layerId) {\n        layer=layersFlat[layerId]\n        console.log(layer)\n        return `<tr><td>${layer.name}</td><td>${layer.Min.toFixed(2)}</td><td>${layer.Mean.toFixed(2)}</td><td>${layer.Max.toFixed(2)}</td><td> <input type=\"range\" min=\"${layer.Min}\" value=\"${layer.Mean}\" max=\"${layer.Max}\" class=\"slider\" id=\"layer_${layer.layerId}\"></td></tr>`\n    }).join('')\n}\n\n/* Just sets the div's HTML content*/\nfunction setHTML(scope,html) {\n    $(\"#my_\"+scope.$id).html(html)\n}\n\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    if (msg && 'payload' in msg) {\n      // Do something when msg arrives\n      if('data' in msg.payload) {\n        layerList=genLayersHTML(msg.payload.data)\n        setHTML(scope,`<table style=\"color:green;line-height: 80%;\">${layerList}</table>`);\n      } else if('text' in msg.payload) {\n        setHTML(scope,`${msg.payload.text}`)\n      } else if('progress' in msg.payload) {\n        setHTML(scope,'...')\n      } else {\n        setHTML(scope,`Unknown payload keys=${Object.keys(msg.payload)}`)\n      }\n    } else {\n        setHTML(scope,`No payload in msg keys=${Object.keys(msg)}`)\n    }\n  });\n})(scope);\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":910,"y":300,"wires":[[]]},{"id":"606783af.d4c73c","type":"subflow:f75a1866.de1ef8","z":"a09c9932.979aa8","name":"GET queryjobs/{payload}/layers","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"},{"name":"urlSuffix","value":"/layers","type":"str"}],"x":410,"y":420,"wires":[["2ef29f93.f608f"],["9929b9eb.0bad58"],["1ef9e26d.110e5e"]]},{"id":"ffa36919.e585d8","type":"inject","z":"a09c9932.979aa8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"lastQuery","payloadType":"flow","x":110,"y":420,"wires":[["606783af.d4c73c"]]},{"id":"37e45151.0a041e","type":"subflow:3268bb9d.2b7f84","z":"a09c9932.979aa8","name":"","env":[],"x":150,"y":40,"wires":[["7bb0c822.d8aaf8"],[],["5c9baa68.e0a4d4"],[],["f0b989e6.95e108"]]},{"id":"5f616f2e.ed052","type":"change","z":"3268bb9d.2b7f84","name":"","rules":[{"t":"set","p":"delay","pt":"msg","to":"polingDelayMs","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":300,"wires":[["e52f176.42823e8"]]},{"id":"5c9baa68.e0a4d4","type":"change","z":"a09c9932.979aa8","name":"","rules":[{"t":"set","p":"lastQuery","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":60,"wires":[[]]},{"id":"f0b989e6.95e108","type":"debug","z":"a09c9932.979aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":530,"y":100,"wires":[]},{"id":"129fc17e.68c9ef","type":"switch","z":"3268bb9d.2b7f84","name":"Test success","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"Succeeded","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":380,"wires":[["acc70ffa.b5bc5"],[]],"outputLabels":["Succeeded","Failed"]},{"id":"7139db26.ce8b74","type":"ui_button","z":"84950fca.868f2","name":"","group":"ee17d09c.5ac0b","order":7,"width":2,"height":1,"passthru":false,"label":"Get Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"","x":890,"y":40,"wires":[["32d8c290.1048ce"]]},{"id":"a27ee384.0f114","type":"ui_text_input","z":"84950fca.868f2","name":"Ref Lat","label":"Lat","tooltip":"","group":"ee17d09c.5ac0b","order":5,"width":2,"height":1,"passthru":false,"mode":"text","delay":300,"topic":"","x":580,"y":40,"wires":[[]]},{"id":"f5e46c4d.50965","type":"change","z":"84950fca.868f2","name":"Set Lat","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.pos.lat","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"mousePos.lat","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":40,"wires":[["a27ee384.0f114"]]},{"id":"ed959374.30d9","type":"change","z":"84950fca.868f2","name":"Set Lng","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.pos.lng","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"mousePos.lng","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":80,"wires":[["fe5105cc.439cd8"]]},{"id":"fe5105cc.439cd8","type":"ui_text_input","z":"84950fca.868f2","name":"Ref Lng","label":"Lng","tooltip":"","group":"ee17d09c.5ac0b","order":6,"width":2,"height":1,"passthru":false,"mode":"text","delay":300,"topic":"","x":580,"y":80,"wires":[[]]},{"id":"936f6701.c48158","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":3,"width":2,"height":1,"name":"Ref Lng","label":"Lng","format":"{{msg.mousePos.lng | number:5}}","layout":"col-center","x":880,"y":80,"wires":[]},{"id":"b38c6bbd.b0f328","type":"ui_text","z":"84950fca.868f2","group":"ee17d09c.5ac0b","order":2,"width":2,"height":1,"name":"Ref Lat","label":"Lat","format":"{{msg.mousePos.lat | number:5}}","layout":"col-center","x":740,"y":80,"wires":[]},{"id":"c3b744d3.0c0dd8","type":"ui_button","z":"84950fca.868f2","name":"","group":"ee17d09c.5ac0b","order":4,"width":1,"height":1,"passthru":false,"label":"Center","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":470,"y":440,"wires":[["f32a117.38e88f"]]},{"id":"b6ce2c06.d67ee","type":"change","z":"84950fca.868f2","name":"","rules":[{"t":"set","p":"lastPos","pt":"flow","to":"mousePos","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":120,"wires":[[]]},{"id":"32d8c290.1048ce","type":"change","z":"84950fca.868f2","name":"init lastPos","rules":[{"t":"set","p":"payload","pt":"msg","to":"refData","tot":"flow"},{"t":"set","p":"payload.text","pt":"msg","to":"Loading Layers","tot":"str"},{"t":"set","p":"payload.pos","pt":"msg","to":"lastPos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":280,"wires":[["a4cb0892.241758","133647a3.3f8358","e2f5c737.202bb8"]]},{"id":"f32a117.38e88f","type":"change","z":"84950fca.868f2","name":"setDim from flow","rules":[{"t":"set","p":"payload.setDim","pt":"msg","to":"lastDim","tot":"flow"},{"t":"set","p":"payload.setDim.pos","pt":"msg","to":"refData.pos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":440,"wires":[["1ed2c7f4.b4acd8"]]},{"id":"cd686fe1.36bca","type":"ui_button","z":"84950fca.868f2","name":"","group":"ee17d09c.5ac0b","order":20,"width":2,"height":1,"passthru":false,"label":"Gen Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":90,"y":500,"wires":[["7693c5a1.56691c"]]},{"id":"6b9d8754.22b3e8","type":"subflow:3268bb9d.2b7f84","z":"84950fca.868f2","name":"","env":[],"x":500,"y":500,"wires":[["d5e32a0d.0cff38","fca57da7.686ea"],["d5e32a0d.0cff38"],[],["d5e32a0d.0cff38"],["d5e32a0d.0cff38"]]},{"id":"7693c5a1.56691c","type":"change","z":"84950fca.868f2","name":"Set refData&lastPos","rules":[{"t":"set","p":"payload","pt":"msg","to":"refData","tot":"flow"},{"t":"set","p":"payload.pos","pt":"msg","to":"lastPos","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":500,"wires":[["6b9d8754.22b3e8"]]},{"id":"2fb67866.40b198","type":"template","z":"3268bb9d.2b7f84","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{  \"name\": \"NodeRED_Ref {{payload.pos.lat}}-{{payload.pos.lng}}\",\n    \"layers\": [\n    {{#payload.layers}}\n        {   \"alias\": \"{{.}}_Mean\",\n            \"type\": \"raster\",\n            \"id\": \"{{.}}\",\n            \"aggregation\": \"Mean\"\n        },\n    {{/payload.layers}}\n   ],\n    \"spatial\": {\n        \"type\": \"poly\",\n        \"aoi\": \"38662\"\n    },\n    \"temporal\": {\n        \"intervals\": [\n            {\n                \"start\": \"{{payload.startDay}}T00:00:00Z\",\n                \"end\": \"{{payload.endDay}}T00:00:00Z\"\n            }\n        ]\n    }\n}","output":"str","x":180,"y":20,"wires":[["dd6cc308.b537e"]]},{"id":"dd6cc308.b537e","type":"function","z":"3268bb9d.2b7f84","name":"FixJSON","func":"msg.payload=msg.payload.replace(/,(?=\\s*[}\\]])/mig,'');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":20,"wires":[["efef1f9.39689e"]]},{"id":"efef1f9.39689e","type":"json","z":"3268bb9d.2b7f84","name":"","property":"payload","action":"","pretty":false,"x":450,"y":20,"wires":[["b067a6e5.bf25f8"]]},{"id":"d5e32a0d.0cff38","type":"debug","z":"84950fca.868f2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":870,"y":500,"wires":[]},{"id":"c1e74236.3401b","type":"change","z":"3268bb9d.2b7f84","name":"Extract query ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":160,"wires":[[]]},{"id":"ff244dd6.413b6","type":"debug","z":"84950fca.868f2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":580,"wires":[]},{"id":"d033adde.11471","type":"subflow:f75a1866.de1ef8","z":"84950fca.868f2","name":"GET queryjobs/{payload}/layers","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/queryjobs/","type":"str"},{"name":"urlSuffix","value":"/layers","type":"str"}],"x":530,"y":600,"wires":[["ff244dd6.413b6","3943b19d.9610ce"],["ff244dd6.413b6"],[]]},{"id":"fca57da7.686ea","type":"change","z":"84950fca.868f2","name":"Extract QueryID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":560,"wires":[["d033adde.11471"]]},{"id":"91d21d7a.f7e4c","type":"ui_template","z":"d2e1164a.aba058","group":"52fc2436.51b34c","name":"Bootstrap Page","order":0,"width":0,"height":0,"format":"<!--<div ng-bind-html=\"msg.payload\"></div>-->\n<style type=\"text/css\">\n\ndiv#colonne1 {\n\tfloat: left;\n\twidth: 160px;\n\tmargin-right: 10px;\n\tpadding: 1px 0;\n\tbackground: lightblue;\n}\ndiv#colonne2 {\n\tfloat: left;\n\twidth: 220px;\n\tmargin-left: 0px;\n\tpadding: 0px 0;\n\tbackground: lightblue;\n}\ndiv#map {\n\toverflow: hidden;\n\tpadding: 1px 20px;\n\tmargin-left: 10px;\n\tbackground: burlywood;\n}\n#ex16c .slider-selection {\n\tbackground: red;\n}\n</style>\n\n\n<div>\n\t<h2>Slider test page</h2>\n\t<p>Code from <a href=\"http://seiyria.com/bootstrap-slider\" target=\"_blank\">http://seiyria.com/bootstrap-slider</a></p>\n\t\n\t<div id=\"colonne1\">\n    \t<h4>Criteria</h4>\n    \t<input type=\"checkbox\" id=\"humidity\" checked=\"checked\" />&nbsp;&nbsp;Ground humidity <br><br>\n        <input type=\"checkbox\" id=\"temperature\" checked=\"checked\" />&nbsp;&nbsp;Temp&eacute;rature <br><br>\n        <input type=\"checkbox\" id=\"sunshine\" checked=\"checked\" />&nbsp;&nbsp;Sunshine (%)<br><br>\n        <input type=\"checkbox\" id=\"Soil\" checked=\"checked\" />&nbsp;&nbsp;Soil quality<br><br>\n\t</div><!-- fin de div#colonne1 -->\n\t\n\t<div id=\"colonne2\">\n    \t<h4>Adjustment</h4>\n    \t<input id=\"ex16a\" type=\"text\"/><br/><br/>\n        <input id=\"ex16b\" type=\"text\"/><br/><br/>\n     \t<input id=\"ex16c\" type=\"text\"/><br/><br/>\n      \t<input id=\"ex16d\" type=\"text\"\n            data-provide=\"slider\"\n            data-slider-ticks=\"[1, 2, 3]\"\n            data-slider-ticks-labels='[\"Low\", \"medium\", \"Intense\"]'\n            data-slider-min=\"1\"\n            data-slider-max=\"3\"\n            data-slider-step=\"1\"\n            data-slider-value=\"3\"\n            data-slider-tooltip=\"hide\" /><br/><br/>\n        <input id=\"ex16e\" type=\"text\" /><br/><br/>\n\t</div><!-- fin de div#colonne2 -->\n\t\n\t<div id=\"map\" style='margin-left:2rem;'>\n\t\t<h4>result map</h4>\n\t\t <img src=\"data:image/jpeg;base64,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\">\n\t</div><!-- fin de div#centre -->\n\t\n    <script src=\"https://code.jquery.com/jquery-3.2.1.slim.min.js\" integrity=\"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js\" integrity=\"sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js\" integrity=\"sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js\" integrity=\"sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA==\" crossorigin=\"anonymous\"></script>\n    <script type=\"text/javascript\">\n        var sliderA = new Slider(\"#ex16a\", { min: 0, max: 10, value: 5, focus: true });\n        var sliderB = new Slider(\"#ex16b\", { min: 0, max: 10, value: [4, 6], focus: true });\n        var sliderC = new Slider(\"#ex16c\", { min: 0, max: 100, value: 70, focus: true });\n        var sliderE = new Slider(\"#ex16e\", { min: 1, max: 3, step:1, value: 3, focus: true, ticks: [1,2,3], ticks_labels: [\"Low\", \"medium\", \"Intense\"]});\n    </script>\n\n</div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":180,"y":280,"wires":[[]]},{"id":"6e1c9407.6967ec","type":"inject","z":"84950fca.868f2","name":"SampleQueryResult","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"id\":\"1599796800_20179116\",\"status\":\"Succeeded\",\"start\":1599816979116,\"folder\":\"1599816979104\",\"swLat\":47.576553,\"swLon\":3.3840909,\"neLat\":50.16917,\"neLon\":5.8905783,\"nickname\":\"NodeRED_Ref 49.087126542584954-3.9402723312377934\",\"exPercent\":0,\"flag\":false,\"hadoopId\":\"1591579541500_1159378\",\"ready\":true,\"rtStatus\":\"Succeeded\",\"statusCode\":20}","payloadType":"json","x":130,"y":600,"wires":[["fca57da7.686ea"]]},{"id":"73e9dd18.da6d54","type":"ui_button","z":"84950fca.868f2","name":"","group":"ee17d09c.5ac0b","order":22,"width":2,"height":1,"passthru":false,"label":"Add Layers","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"id\":\"1599796800_20179116\",\"status\":\"Succeeded\",\"start\":1599816979116,\"folder\":\"1599816979104\",\"swLat\":47.576553,\"swLon\":3.3840909,\"neLat\":50.16917,\"neLon\":5.8905783,\"nickname\":\"NodeRED_Ref 49.087126542584954-3.9402723312377934\",\"exPercent\":0,\"flag\":false,\"hadoopId\":\"1591579541500_1159378\",\"ready\":true,\"rtStatus\":\"Succeeded\",\"statusCode\":20}","payloadType":"json","topic":"","x":90,"y":540,"wires":[["fca57da7.686ea"]]},{"id":"c61eebb8.1139a8","type":"change","z":"84950fca.868f2","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"addLayers\" : payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":660,"wires":[["182d990.f19c767"]]},{"id":"62b32faf.25d46","type":"http in","z":"dc853c89.d32cf","name":"plugin","url":"/leaflet/plugin/:filename","method":"get","upload":false,"swaggerDoc":"","x":110,"y":460,"wires":[["9ea7918d.bc209"]]},{"id":"50c549e9.80fa28","type":"http response","z":"dc853c89.d32cf","name":"","statusCode":"","headers":{"content-type":"text/css"},"x":510,"y":460,"wires":[]},{"id":"8cf9076.6b0e9f8","type":"change","z":"dc853c89.d32cf","name":"css","rules":[{"t":"set","p":"payload","pt":"msg","to":"input[type=range]{-webkit-appearance:none;-webkit-tap-highlight-color:rgba(255,255,255,0);width:110px;height:10px;margin:0;border:none;padding:1px 2px;border-radius:30px;background:#F1F0EE;outline:0}input[type=range]::-ms-track{border:inherit;color:transparent;background:0 0}input[type=range]::-ms-fill-lower,input[type=range]::-ms-fill-upper{background:0 0}input[type=range]::-ms-tooltip{display:none}input[type=range]::-ms-thumb{width:15px;height:18px;border-radius:12px;border:0;background-image:linear-gradient(to bottom,#1253A4 0,#1253A4 100%)}.leaflet-control-layers-label{margin:0 0 8px 1px}","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":460,"wires":[["50c549e9.80fa28"]]},{"id":"9ea7918d.bc209","type":"switch","z":"dc853c89.d32cf","name":"","property":"req.params.filename","propertyType":"msg","rules":[{"t":"eq","v":"L.Control.Opacity.css","vt":"str"},{"t":"eq","v":"L.Control.Opacity.js","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":500,"wires":[["8cf9076.6b0e9f8"],["a150939.f07297"]],"inputLabels":["filename"],"outputLabels":["css","js"]},{"id":"a150939.f07297","type":"change","z":"dc853c89.d32cf","name":"js","rules":[{"t":"set","p":"payload","pt":"msg","to":"L.Control.Opacity=L.Control.extend({options:{collapsed:!1,position:\"topright\",label:null},initialize:function(t,e){for(var i in L.Util.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._container},expand:function(){L.DomUtil.addClass(this._container,\"leaflet-control-layers-expanded\"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(L.DomUtil.addClass(this._form,\"leaflet-control-layers-scrollbar\"),this._form.style.height=t+\"px\"):L.DomUtil.removeClass(this._form,\"leaflet-control-layers-scrollbar\"),this},collapse:function(){return L.DomUtil.removeClass(this._container,\"leaflet-control-layers-expanded\"),this},_initLayout:function(){var t=\"leaflet-control-layers\",e=this._container=L.DomUtil.create(\"div\",t),i=this.options.collapsed;if(e.setAttribute(\"aria-haspopup\",!0),L.DomEvent.disableClickPropagation(e),L.DomEvent.disableScrollPropagation(e),this.options.label){var a=L.DomUtil.create(\"p\",t+\"-label\");a.innerHTML=this.options.label,e.appendChild(a)}var s=this._form=L.DomUtil.create(\"form\",t+\"-list\");i&&(this._map.on(\"click\",this.collapse,this),L.Browser.android||L.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var l=this._layersLink=L.DomUtil.create(\"a\",t+\"-toggle\",e);l.href=\"#\",l.title=\"Layers\",L.Browser.touch?(L.DomEvent.on(l,\"click\",L.DomEvent.stop),L.DomEvent.on(l,\"click\",this.expand,this)):L.DomEvent.on(l,\"focus\",this.expand,this),i||this.expand(),this._baseLayersList=L.DomUtil.create(\"div\",t+\"-base\",s),this._separator=L.DomUtil.create(\"div\",t+\"-separator\",s),this._overlaysList=L.DomUtil.create(\"div\",t+\"-overlays\",s),e.appendChild(s)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&L.Util.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._layers.push({layer:t,name:e,overlay:i})},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList),this._layerControlInputs=[];var t,e,i,a,s=0;for(i=0;i<this._layers.length;i++)a=this._layers[i],this._addItem(a),e=e||a.overlay,t=t||!a.overlay,s+=a.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?\"\":\"none\"),this._separator.style.display=e&&t?\"\":\"none\",this},_addItem:function(t){var e,i=document.createElement(\"label\");t.overlay?((e=document.createElement(\"input\")).type=\"range\",e.className=\"leaflet-control-layers-range\",e.min=0,e.max=100,e.value=100):e=this._createRadioElement(\"leaflet-base-layers\",checked),this._layerControlInputs.push(e),e.layerId=L.Util.stamp(t.layer),L.DomEvent.on(e,\"click\",this._onInputClick,this),L.DomEvent.on(e,\"touchend\",this._onInputClick,this);var a=document.createElement(\"span\");a.innerHTML=\" \"+t.name;var s=document.createElement(\"div\"),l=document.createElement(\"div\");return i.appendChild(s),s.appendChild(a),i.appendChild(l),l.appendChild(e),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),i},_onInputClick:function(){var t,e,i=this._layerControlInputs;this._handlingClick=!0;for(var a=i.length-1;a>=0;a--)t=i[a],void 0===(e=this._getLayer(t.layerId).layer)._url||e.setOpacity(t.value/100);this._handlingClick=!1,this._refocusOnMap()}}),L.control.opacity=function(t,e){return new L.Control.Opacity(t,e)};","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":500,"wires":[["5be36f9f.47977"]]},{"id":"5be36f9f.47977","type":"http response","z":"dc853c89.d32cf","name":"","statusCode":"","headers":{"content-type":"text/javascript"},"x":510,"y":500,"wires":[]},{"id":"acc70ffa.b5bc5","type":"json","z":"3268bb9d.2b7f84","name":"","property":"payload","action":"","pretty":false,"x":650,"y":380,"wires":[[]]},{"id":"3943b19d.9610ce","type":"json","z":"84950fca.868f2","name":"","property":"payload","action":"","pretty":false,"x":450,"y":660,"wires":[["c61eebb8.1139a8"]]},{"id":"718d43c8.a1e17c","type":"debug","z":"84950fca.868f2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":140,"wires":[]},{"id":"8f92881.6704278","type":"debug","z":"84950fca.868f2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":310,"y":80,"wires":[]},{"id":"e2f5c737.202bb8","type":"debug","z":"84950fca.868f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":420,"wires":[]},{"id":"da472e60.bd22a","type":"debug","z":"84950fca.868f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":380,"wires":[]},{"id":"5a573ac6.7148b4","type":"debug","z":"84950fca.868f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":340,"wires":[]},{"id":"878e660f.b4d6f8","type":"inject","z":"a09c9932.979aa8","name":"Test 11 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\",\"49252\",\"49257\",\"49304\",\"49313\",\"50453\",\"49310\",\"49311\",\"49250\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":300,"wires":[["b070b83c.fd2fc8"]]},{"id":"ebf5826c.6d6b5","type":"inject","z":"a09c9932.979aa8","name":"Test 2 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":340,"wires":[["b070b83c.fd2fc8"]]},{"id":"9929b9eb.0bad58","type":"debug","z":"a09c9932.979aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":850,"y":400,"wires":[]},{"id":"af7a1dbb.9cc4c","type":"inject","z":"a09c9932.979aa8","name":"Test Point Query","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"16100\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49440\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49252\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49257\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49304\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49313\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"50453\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49310\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49311\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49250\",\"aggregation\":\"Max\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Mean\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Min\"},{\"type\":\"raster\",\"id\":\"49296\",\"aggregation\":\"Max\"}],\"spatial\":{\"type\":\"point\",\"coordinates\":[\"49.080609\",\"3.961231\"]},\"temporal\":{\"intervals\":[{\"start\":\"2018-06-30T00:00:00Z\",\"end\":\"2018-10-31T00:00:00Z\"}]}}","payloadType":"json","x":120,"y":500,"wires":[["44bcdce6.9a0a84"]]},{"id":"44bcdce6.9a0a84","type":"subflow:f75a1866.de1ef8","z":"a09c9932.979aa8","name":"POST query","env":[{"name":"method","value":"POST","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/query","type":"str"},{"name":"appendPayloadToURL","value":"false","type":"bool"}],"x":350,"y":500,"wires":[["2ef29f93.f608f"],["9929b9eb.0bad58"],["1ef9e26d.110e5e"]]},{"id":"8efd78ca.e89b48","type":"comment","z":"d679d351.f64ae","name":"Generate Min-Mean-Max query for mutiple layers","info":"Generate","x":250,"y":80,"wires":[]},{"id":"a61c8ad9.147b58","type":"switch","z":"f75a1866.de1ef8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":60,"wires":[["915125f2.3bdce8"],[]],"outputLabels":["ok","error"]},{"id":"1ef9e26d.110e5e","type":"debug","z":"a09c9932.979aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":500,"wires":[]},{"id":"22c33735.2944a8","type":"subflow:f75a1866.de1ef8","z":"4d8a8909.a61068","name":"","env":[{"name":"method","value":"GET","type":"str"},{"name":"url","value":"https://pairs.res.ibm.com/v2/datalayers/","type":"str"}],"x":640,"y":60,"wires":[["5f9921ea.f821"],[],[]]},{"id":"b5b3f913.5cb0b8","type":"split","z":"4d8a8909.a61068","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":60,"wires":[["22c33735.2944a8"]]},{"id":"44dde7a8.15e638","type":"inject","z":"a09c9932.979aa8","name":"Test 2 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":160,"wires":[["a3ea8bb7.6fccc8"]]},{"id":"ee6f4e3e.13e1","type":"change","z":"4d8a8909.a61068","name":"set layers","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":60,"wires":[["b5b3f913.5cb0b8"]]},{"id":"5f9921ea.f821","type":"join","z":"4d8a8909.a61068","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":80,"wires":[[]]},{"id":"b8d2a812.906ba8","type":"inject","z":"a09c9932.979aa8","name":"Test 11 layers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49440\",\"49252\",\"49257\",\"49304\",\"49313\",\"50453\",\"49310\",\"49311\",\"49250\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":110,"y":200,"wires":[["a3ea8bb7.6fccc8"]]},{"id":"38e3f1c0.17339e","type":"inject","z":"a09c9932.979aa8","name":"Test Layer 16100,49058,49296","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"49058\",\"49296\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","payloadType":"json","x":170,"y":120,"wires":[["a3ea8bb7.6fccc8"]]},{"id":"40809d82.2287d4","type":"ui_template","z":"d2e1164a.aba058","group":"52fc2436.51b34c","name":"Bootstrap HEAD","order":1,"width":0,"height":0,"format":"<!-- Load bootstrap CSS -->\n<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\" integrity=\"sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm\" crossorigin=\"anonymous\">\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css\" integrity=\"sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ==\" crossorigin=\"anonymous\" />\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"global","x":180,"y":220,"wires":[[]]},{"id":"a3ea8bb7.6fccc8","type":"subflow:4d8a8909.a61068","z":"a09c9932.979aa8","x":460,"y":160,"wires":[["2ef29f93.f608f"],["9929b9eb.0bad58"],["1ef9e26d.110e5e"]]},{"id":"33cdc3a2.1b7a4c","type":"switch","z":"4d8a8909.a61068","name":"","property":"payload","propertyType":"msg","rules":[{"t":"hask","v":"layersKey","vt":"env"},{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":170,"y":180,"wires":[["ee6f4e3e.13e1"],["b5b3f913.5cb0b8"],[]]},{"id":"5a7a4595.6010ec","type":"comment","z":"4d8a8909.a61068","name":"This subflow gets full layers details","info":"Input can be either a array of layerIDs, or a member which is itself an array or layerIDs","x":230,"y":380,"wires":[]},{"id":"915125f2.3bdce8","type":"json","z":"f75a1866.de1ef8","name":"","property":"payload","action":"","pretty":false,"x":950,"y":40,"wires":[[]]},{"id":"a03286d6.92d378","type":"uibuilder","z":"e10ffd97.9d351","name":"","topic":"","url":"uibuilder","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"showfolder":false,"x":240,"y":180,"wires":[["430b50e5.8ecb6","9e0ba846.0a4fd8"],["ac6fd414.a9e3b8"]]},{"id":"430b50e5.8ecb6","type":"debug","z":"e10ffd97.9d351","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":100,"wires":[]},{"id":"c0404a47.339ba8","type":"debug","z":"e10ffd97.9d351","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":140,"wires":[]},{"id":"1e64593b.3f9fb7","type":"comment","z":"e10ffd97.9d351","name":"README!! WinSCP","info":"This flow uses the `uibuilder` from `node-red-contrib-uibuilder` package\n\nTo use with IBMCloud, keep in mind that the filesystem on the cloud is *NOT* persistent. So edits done here are not retained across restarts/restages of the IBMCloud application.\n\nTo remediate this, the idea is to edit the files in the gitlab repository associated with this Node-RED app, and to facilitate developments, to sunchronize the local git clone and the current instance file system using WinSCP over CloudFoundry SSH connection.\n\nTo do this, get WinSCP, get the ibmcloud commandline, and use the following commands:\n - `ibmcloud cf -q curl /v2/info` to get the host and port for the remote app\n - `ibmcloud cf -q app %APP_NAME% --guid` to get the APP_GUID\n - `ibmcloud cf -q ssh-code` to get a password.\nThe WinSCP command will then be:\n```\nwinscp scp://cf%%3A%APP_GUID%%%2F0:%SSH_CODE%@%SSH_HOST%:%SSH_PORT%/home/vcap/app/.node-red/uibuilder/uibuilder/src/\n```\nIf the authentication fails, use `ibmcloud cf -q ssh-code` to get a renewed password","x":650,"y":60,"wires":[]},{"id":"a2bb82f9.9d41a","type":"change","z":"e10ffd97.9d351","name":"RefData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49440\",\"49432\",\"49433\",\"49441\",\"49454\",\"50450\"],\"pos\":{\"lat\":\"49.080609\",\"lng\":\"3.961231\"},\"startDay\":\"2018-06-30\",\"endDay\":\"2018-10-31\"}","tot":"json"},{"t":"set","p":"payload.zoom","pt":"msg","to":"12","tot":"num"},{"t":"set","p":"payload.duration","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":80,"y":120,"wires":[["a03286d6.92d378"]]},{"id":"9e0ba846.0a4fd8","type":"switch","z":"e10ffd97.9d351","name":"switch topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"initLayers","vt":"str"},{"t":"eq","v":"loadLayers","vt":"str"},{"t":"eq","v":"mapClick","vt":"str"},{"t":"eq","v":"mapMove","vt":"str"},{"t":"eq","v":"mapMoveend","vt":"str"},{"t":"eq","v":"mapZoomend","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":7,"x":90,"y":380,"wires":[["2b8a5f38.b1a44"],["6b07fcea.c5fa54"],["2375255b.58db9a"],[],[],[],["8dcef1ee.93de4"]]},{"id":"1040e25a.d16c4e","type":"debug","z":"e10ffd97.9d351","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":240,"wires":[]},{"id":"2375255b.58db9a","type":"change","z":"e10ffd97.9d351","name":"setRefPointMarker","rules":[{"t":"set","p":"topic","pt":"msg","to":"setRefPointMarker","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":400,"wires":[["7b03d27b.59e56c"]]},{"id":"651ca0ac.eddfd","type":"link in","z":"e10ffd97.9d351","name":"toFront","links":["7b03d27b.59e56c"],"x":45,"y":180,"wires":[["a03286d6.92d378"]]},{"id":"7b03d27b.59e56c","type":"link out","z":"e10ffd97.9d351","name":"msg","links":["651ca0ac.eddfd"],"x":875,"y":320,"wires":[]},{"id":"6b07fcea.c5fa54","type":"subflow:d679d351.f64ae","z":"e10ffd97.9d351","name":"","env":[],"x":480,"y":340,"wires":[["7b03d27b.59e56c","1040e25a.d16c4e"],["430b50e5.8ecb6"],["8dcef1ee.93de4"]]},{"id":"5a050e94.a84b2","type":"inject","z":"e10ffd97.9d351","name":"initLayers","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"layers\":[\"16100\",\"16200\",\"16700\",\"49250\",\"49310\",\"49257\",\"49313\",\"49311\",\"49432\",\"49433\",\"49441\",\"49454\",\"50450\"]}","payloadType":"json","x":100,"y":60,"wires":[["e130d561.1570e8"]]},{"id":"e130d561.1570e8","type":"change","z":"e10ffd97.9d351","name":"","rules":[{"t":"set","p":"layers","pt":"flow","to":"payload.layers","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":60,"wires":[[]]},{"id":"51544520.e6d90c","type":"subflow:4d8a8909.a61068","z":"e10ffd97.9d351","name":"","env":[],"x":480,"y":280,"wires":[["1040e25a.d16c4e","7b03d27b.59e56c"],[],["8dcef1ee.93de4"]]},{"id":"2b8a5f38.b1a44","type":"change","z":"e10ffd97.9d351","name":"set Layers","rules":[{"t":"set","p":"payload.layers","pt":"msg","to":"layers","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":280,"wires":[["51544520.e6d90c"]]},{"id":"8dcef1ee.93de4","type":"change","z":"e10ffd97.9d351","name":"Set pairsError","rules":[{"t":"set","p":"pairsError","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":500,"wires":[["7b03d27b.59e56c"]]},{"id":"ac6fd414.a9e3b8","type":"switch","z":"e10ffd97.9d351","name":"","property":"uibuilderCtrl","propertyType":"msg","rules":[{"t":"eq","v":"ready for content","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":180,"wires":[["c0404a47.339ba8","768770ae.d603e"],[]]},{"id":"768770ae.d603e","type":"change","z":"e10ffd97.9d351","name":"","rules":[{"t":"delete","p":"uibuilderCtrl","pt":"msg"},{"t":"delete","p":"from","pt":"msg"},{"t":"delete","p":"cacheControl","pt":"msg"},{"t":"set","p":"topic","pt":"msg","to":"init","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":200,"wires":[["c0404a47.339ba8","7b03d27b.59e56c"]]}]